{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///pic-tune.min.js","webpack:///webpack/bootstrap eddeb352e4db65974b62","webpack:///./src/main.js","webpack:///./src/main.css?db72","webpack:///./src/main.css","webpack:///./node_modules/_css-loader@0.28.11@css-loader/lib/css-base.js","webpack:///./node_modules/_vue-style-loader@3.1.2@vue-style-loader/lib/addStylesClient.js","webpack:///./node_modules/_vue-style-loader@3.1.2@vue-style-loader/lib/listToStyles.js","webpack:///./src/scale.js","webpack:///./src/glfx.js","webpack:///./src/utils.js"],"names":["root","factory","exports","module","define","amd","self","this","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","_classCallCheck","instance","Constructor","TypeError","bindEvents","editorObj","moveEnd","isMove","isResize","clearTimeout","moveTimer","adjustSize","pWidth","picture","width","pHeight","height","pRate","parseFloat","toFixed","sStyle","source","style","cStyle","crop","BORDER_PIX","sWidth","clientWidth","sHeight","clientHeight","sRate","display","cropRate","left","top","__WEBPACK_IMPORTED_MODULE_3__utils__","onMovingCrop","wrapper","canvas","showImage","maxPos","curPoint","movePoints","getElementsByTagName","pointDirection","onmousedown","e","toElement","offsetWidth","offsetHeight","len","length","setTimeout","onmousemove","cropStyle","movementX","movementY","offsetLeft","offsetTop","newLeft","newTop","newWidth","newHeight","sign","indexOf","isNaN","onmouseup","onload","draw","texture","update","error","console","log","window","onresize","value","__WEBPACK_IMPORTED_MODULE_0__main_css__","__WEBPACK_IMPORTED_MODULE_1__scale_js__","__WEBPACK_IMPORTED_MODULE_2__glfx_js__","_createClass","defineProperties","target","props","descriptor","writable","key","protoProps","staticProps","PicTune","options","arguments","undefined","assign","id","element","url","output","file","document","getElementById","createElement","originImage","Image","className","innerText","innerHTML","appendChild","loadAsUrl","_this","type","then","data","loadAsFile","_this2","fr","FileReader","Promise","resolve","reject","confirm","result","readAsDataURL","dataurl","toDataURL","src","toggle","rate","isShow","cWidth","cHeight","curRate","getContext","drawImage","parseInt","postion","getCropPosition","get2dCanvas","angle","isTurnOver","c2","pW","pH","cX","cY","A","Math","PI","sinA","abs","sin","cosA","cos","rotate","brightness","contrast","saturation","radius","brightnesscontrastSaturationBur","hue","greenRed","purpleGreen","yellowBlue","hueColor","isBlob","aLink","evt","createEvent","split","href","getData","download","initMouseEvent","dispatchEvent","params","formData","FormData","formKey","isOrigin","append","post","Vue","content","locals","push","cssWithMappingToString","item","useSourceMap","cssMapping","btoa","sourceMapping","toComment","concat","sources","map","sourceRoot","join","sourceMap","unescape","encodeURIComponent","JSON","stringify","list","toString","mediaQuery","alreadyImportedModules","addStylesToDom","styles","domStyle","stylesInDom","refs","j","parts","addStyle","createStyleElement","styleElement","head","obj","remove","querySelector","ssrIdKey","isProduction","noop","parentNode","removeChild","isOldIE","styleIndex","singletonCounter","singletonElement","applyToSingletonTag","bind","applyToTag","newObj","css","media","index","styleSheet","cssText","replaceText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","firstChild","hasDocument","DEBUG","Error","listToStyles","navigator","test","userAgent","toLowerCase","parentId","_isProduction","_options","newList","mayRemove","textStore","replacement","filter","Boolean","newStyles","part","scale","input","inputRemovable","setNewCanvas","newCanvas","_typeof","dw","dh","newCtx","getImageData","tmpBuffer","dindex","imageData","byteBuffer","dwh4","TIMES","HAS_ALPHA","ctx","naturalWidth","naturalHeight","runtimeStyle","mw","mh","removeAttribute","sw","sh","sourceBuffer","clearRect","scaleX","scaleY","sx","sy","dx","dy","dyindex","idx","idy","isx","isy","w","wx","nwx","wy","nwy","crossX","crossY","r","g","b","a","dsy","dsx","row0","row1","row2","row3","col0","col1","col2","col3","dw4","sw4","sindex","scaleXY","bicubic","t","Float32Array","putImageData","img","Symbol","iterator","constructor","fx","clamp","lo","hi","max","min","wrapTexture","_","loadContentsOf","gl","destroy","Texture","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader","getDefaultShader","drawRect","use","simpleShader","shader","textureIn","uniforms","textureOut","replace","node","swapWith","contents","getPixelArray","array","h","Uint8Array","wrap","readPixels","func","getSquareToQuad","x0","args","randomShaderFunc","getOESTextureFloatLinear","$OES_texture_float_linear$","delta","points","activeTexture","ya","u","sort","format","y2","bindTexture","TEXTURE_2D","texImage2D","sig","ddydx","xa","bindFramebuffer","FRAMEBUFFER","framebuffer","OESTextureFloatLinear","defaultFragmentSource","vertexSource","fragmentSource","oldGetExtension","linkProgram","extensions","getProgramParameter","LINK_STATUS","program","createFramebuffer","byteTexture","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","getSupportedExtensions","CLAMP_TO_EDGE","TEXTURE_WRAP_T","framebufferTexture2D","COLOR_ATTACHMENT0","oldGetSupportedExtensions","WebGLRenderingContext","LINEAR","TEXTURE_WRAP_S","rgba","createProgram","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","vertexShader","compileShader","attachShader","buffer","bindBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","vertexAttribPointer","pixel","compileSource","useProgram","floatTexture","drawArrays","getShaderParameter","getShaderInfoLog","location","uniform4fv","preserveDrawingBuffer","isInitialized","uniform1f","textures","right","viewport","createBuffer","texCoordBuffer","COMPILE_STATUS","vertexAttribute","defaultVertexSource","getProgramInfoLog","defaultShader","deleteProgram","isArray","uniform2fv","uniform3fv","uniformMatrix3fv","uniformMatrix4fv","klo","isNumber","x","bottom","getParameter","VIEWPORT","STATIC_DRAW","getAttribLocation","texCoordAttribute","vertexBuffer","TRIANGLE_STRIP","SplineInterpolator","interpolate","khi","k","toImage","image","size","temp","other","getCanvas","turnOver","oImg","newImg","oGC","createImageData","pixels","videoWidth","videoHeight","initFromBytes","deleteTexture","unit","TEXTURE0","unuse","Query","ensureFormat","search","queryString","query","prefix","callback","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","ajaxFactory","fillUsingCanvas","color","getXY","setXY","runFunction","fn","argus","argsl","apply","req","XMLHttpRequest","oC","y","thisObj","Array","convertDataurlToBlob","urlData","bytes","atob","ab","ArrayBuffer","ia","charCodeAt","Blob","method","body","addEventListener","res","getResponseHeader","responseType","response","responseText","open","setRequestHeader","send","http","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","next","done","err","contentType","substring","queryStr","_queryStr$split","_queryStr$split2","keys"],"mappings":"CAAA,SAAAA,EAAAC,GACA,gBAAAC,UAAA,gBAAAC,QACAA,OAAAD,QAAAD,IACA,kBAAAG,gBAAAC,IACAD,OAAA,aAAAH,GACA,gBAAAC,SACAA,QAAA,QAAAD,IAEAD,EAAA,QAAAC,KACC,mBAAAK,WAAAC,KAAA,WACD,MCAgB,UAAUC,GCN1B,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAR,OAGA,IAAAC,GAAAQ,EAAAD,IACAE,EAAAF,EACAG,GAAA,EACAX,WAUA,OANAM,GAAAE,GAAAI,KAAAX,EAAAD,QAAAC,IAAAD,QAAAO,GAGAN,EAAAU,GAAA,EAGAV,EAAAD,QAvBA,GAAAS,KA4DA,OAhCAF,GAAAM,EAAAP,EAGAC,EAAAO,EAAAL,EAGAF,EAAAQ,EAAA,SAAAf,EAAAgB,EAAAC,GACAV,EAAAW,EAAAlB,EAAAgB,IACAG,OAAAC,eAAApB,EAAAgB,GACAK,cAAA,EACAC,YAAA,EACAC,IAAAN,KAMAV,EAAAiB,EAAA,SAAAvB,GACA,GAAAgB,GAAAhB,KAAAwB,WACA,WAA2B,MAAAxB,GAAA,SAC3B,WAAiC,MAAAA,GAEjC,OADAM,GAAAQ,EAAAE,EAAA,IAAAA,GACAA,GAIAV,EAAAW,EAAA,SAAAQ,EAAAC,GAAsD,MAAAR,QAAAS,UAAAC,eAAAjB,KAAAc,EAAAC,IAGtDpB,EAAAuB,EAAA,GAGAvB,IAAAwB,EAAA,KDgBM,SAAU9B,EAAQ+B,EAAqBzB,GAE7C,YASA,SAAS0B,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCE3EhH,QAASC,GAAYC,GA2JjB,QAASC,KACLC,GAAS,EACTC,GAAW,EAEXC,aAAaC,GAmBjB,QAASC,KACL,GAAIC,GAASC,EAAQC,MACjBC,EAAUF,EAAQG,OAClBC,EAAQC,YAAYN,EAASG,GAASI,QAAQ,IAE9CC,EAASC,EAAOC,MAChBC,EAASC,EAAKF,KAElBF,GAAON,MAAQF,EAASa,EAAa,KACrCL,EAAOJ,OAASD,EAAUU,EAAa,IAEvC,IAAIC,GAASL,EAAOM,YAAcF,EAC9BG,EAAUP,EAAOQ,aAAeJ,EAChCK,EAAQZ,YAAYQ,EAASE,GAAST,QAAQ,GAWlD,IARKF,GAASa,IACLA,EAAQb,EACTG,EAAON,MAAQc,EAAUX,EAAQQ,EAAa,KAE9CL,EAAOJ,OAASU,EAAST,EAAQQ,EAAa,MAI/B,SAAlBF,EAAOQ,QAAqB,CAC7B,GAAMC,GAAW3B,EAAU2B,QAE3BT,GAAOU,KAAOV,EAAOW,IAAM,EAC3BX,EAAOT,MAAQS,EAAOP,OAAS,OAE1BgB,GAAYf,GAASe,IACjBf,EAAQe,EACTT,EAAOT,MAAQU,EAAKK,aAAeG,EAAWP,EAAa,KAE3DF,EAAOP,OAASQ,EAAKG,YAAcK,EAAWP,EAAa,MAInEvC,OAAAiD,EAAA,GAAY9B,EAAU+B,aAAc/B,OAvN5C,GAAMgC,GAAUhC,EAAUgC,QACpBhB,EAAShB,EAAUgB,OACnBR,EAAUR,EAAUQ,QAEpByB,GADYjC,EAAUkC,UACblC,EAAUiC,QACnBd,EAAOnB,EAAUmB,KAEnBjB,GAAS,EACTC,GAAW,EACXgC,GACIP,KAAM,EACNC,IAAK,EACLpB,MAAO,EACPE,OAAQ,GAEZyB,EAAW,GACX/B,EAAY,EAEVgC,EAAalB,EAAKmB,qBAAqB,OACvCC,GAAkB,KAAM,KAAM,KAAM,KAE1CpB,GAAKqB,YAAc,SAAUC,GACzB,GAAIC,GAAYD,EAAEC,SAElBP,GAAOP,KAAOZ,EAAOM,YAAeH,EAAKwB,YACzCR,EAAON,IAAMb,EAAOQ,aAAgBL,EAAKyB,aACzCT,EAAO1B,MAAQO,EAAOM,YACtBa,EAAOxB,OAASK,EAAOQ,aACvBtB,GAAS,CAET,KAAM,GAAI9B,GAAI,EAAGyE,EAAMR,EAAWS,OAAQ1E,EAAIyE,IAAOzE,EACjD,GAAKiE,EAAWjE,KAAOsE,EAAY,CAC/BN,EAAWG,EAAenE,GAC1B8B,GAAS,EACTC,GAAW,CACX,OAIRC,aAAaC,GACbA,EAAY0C,WAAW9C,EAAS,MAGpC+B,EAAQgB,YAAc,SAAUP,GAC5B,GAAIQ,GAAY9B,EAAKF,MACjBiC,EAAYT,EAAES,UACdC,EAAYV,EAAEU,UACdC,EAAajC,EAAKiC,WAClBC,EAAYlC,EAAKkC,UACjBC,SAASC,SAAQC,SAAUC,SAEzB9B,EAAW3B,EAAU2B,QAE3B,IAAKzB,EACDoD,EAAUF,EAAaF,EACvBK,EAASF,EAAYF,EAErBG,EAAUA,EAAU,EAAI,EAAKA,EAAUnB,EAAOP,KAAOO,EAAOP,KAAO0B,EACnEC,EAASA,EAAS,EAAI,EAAKA,EAASpB,EAAON,IAAMM,EAAON,IAAM0B,EAEzDD,GAAWF,IAAaH,EAAUrB,KAAO0B,EAAU,MACnDC,GAAUF,IAAYJ,EAAUpB,IAAM0B,EAAS,MAEpD1E,OAAAiD,EAAA,GAAY9B,EAAU+B,aAAc/B,UACjC,IAAKG,EAAW,CACnB,GAAIwC,GAAcxB,EAAKwB,YACnBC,EAAezB,EAAKyB,YAExB,IAAKjB,EAAW,CACZ,GAAI+B,GAAoB,MAAZtB,GAAgC,MAAZA,EAAoB,GAAK,CAEpDT,GAAW,EACZuB,EAAYQ,EAAOP,EAAYxB,EAE/BwB,EAAYO,EAAOR,EAAYvB,GAKR,GAA1BS,EAASuB,QAAQ,MAClBL,EAAUF,EAAaF,EACvBM,EAAWb,EAAcO,EAEpBI,EAAU,IACXE,GAAsBF,EACtBA,EAAU,EAEL3B,IACD8B,GAAaD,EAAWpC,GAAcO,EAAWP,MAKzDoC,EAAWb,EAAcO,GAETE,EAAajB,EAAO1B,QAChC+C,EAAWrB,EAAO1B,MAAQ2C,EAErBzB,IACD8B,GAAaD,EAAWpC,GAAcO,EAAWP,KAM9B,GAA1BgB,EAASuB,QAAQ,MAAeF,EAYxBA,IACTA,EAAYb,EAAeO,GAEVE,EAAYlB,EAAOxB,SAChC8C,EAAYtB,EAAOxB,OAAS0C,EAEvB1B,IACD6B,GAAYC,EAAYrC,GAAcO,EAAWP,KAlBzDmC,EAASF,EAAYF,EACrBM,EAAYb,EAAeO,EAEtBI,EAAS,IACVE,GAAwBF,EACxBA,EAAS,EAEJ5B,IACD6B,GAAYC,EAAYrC,GAAcO,EAAWP,KAexDwC,MAAMN,KAAWA,EAAWF,GAC5BQ,MAAML,KAAUA,EAASF,GAEzB1B,IACI2B,EAAUE,EAAWrB,EAAO1B,MAC7BgD,GAAaD,EAAWpC,GAAcO,EAAWP,EACzCmC,EAASE,EAAYtB,EAAOxB,SACpC6C,GAAYC,EAAYrC,GAAcO,EAAWP,IAIpDkC,GAAWF,IAAaH,EAAUrB,KAAO0B,EAAU,MACnDC,GAAUF,IAAYJ,EAAUpB,IAAM0B,EAAS,MAC/CC,GAAYb,IAAcM,EAAUxC,MAAQ+C,EAAW,MACvDC,GAAab,IAAeK,EAAUtC,OAAS8C,EAAY,MAEhE5E,OAAAiD,EAAA,GAAY9B,EAAU+B,aAAc/B,MAGxCI,aAAaC,GACbA,EAAY0C,WAAW9C,EAAS,MAGpC+B,EAAQ6B,UAAY5D,EASpBO,EAAQsD,OAAS,SAAWrB,GACxBnC,IAEAa,EAAKF,MAAMS,QAAU,OAErBO,EAAO8B,KAAK9B,EAAO+B,QAAQjG,OAAOkG,UAGtCzD,EAAQ0D,MAAQ,SAAWzB,GACvB0B,QAAQC,IAAI3B,IAGhB4B,OAAOC,SAAW,SAAW7B,GACzBnC,KF5GRzB,OAAOC,eAAeY,EAAqB,cAAgB6E,OAAO,GAC7C,IAAIC,GAA0CvG,EAAoB,GAE9DwG,GADkDxG,EAAoBiB,EAAEsF,GAC9BvG,EAAoB,IAC9DyG,EAAyCzG,EAAoB,GAC7D6D,EAAuC7D,EAAoB,GAChF0G,EAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAI1G,GAAI,EAAGA,EAAI0G,EAAMhC,OAAQ1E,IAAK,CAAE,GAAI2G,GAAaD,EAAM1G,EAAI2G,GAAW/F,WAAa+F,EAAW/F,aAAc,EAAO+F,EAAWhG,cAAe,EAAU,SAAWgG,KAAYA,EAAWC,UAAW,GAAMnG,OAAOC,eAAe+F,EAAQE,EAAWE,IAAKF,IAAiB,MAAO,UAAUlF,EAAaqF,EAAYC,GAAiJ,MAA9HD,IAAYN,EAAiB/E,EAAYP,UAAW4F,GAAiBC,GAAaP,EAAiB/E,EAAasF,GAAqBtF,MEhF1hBuB,EAAa,EAoOEgE,EF6FP,WE5FV,QAAAA,KAA0B,GAAdC,GAAcC,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,KAAA3F,GAAA5B,KAAAqH,GACtBvG,OAAO2G,OAAOzH,MACV0H,GAAI,GACJC,QAAS,GACTjF,MAAO,GACPE,OAAQ,QACRgF,IAAK,GACLC,OAAQ,GACRC,QACA9D,aARgB,cASjBsD,EAEH,IAAMrD,GAAUjE,KAAK2H,SAAWI,SAASC,eAAehI,KAAK0H,IACvDzE,EAAS8E,SAASE,cAAc,OAChCxF,EAAUsF,SAASE,cAAc,OACjC9D,EAAY4D,SAASE,cAAc,OACnC/D,EAASyC,EAAA,EAAGzC,SACZd,EAAO2E,SAASE,cAAc,OAC9BC,EAAc,GAAIC,MAExBnI,MAAKiE,QAAUA,EACfjE,KAAKiD,OAASA,EACdjD,KAAKyC,QAAUA,EACfzC,KAAKmE,UAAYA,EACjBnE,KAAKkE,OAASA,EACdlE,KAAKoD,KAAOA,EACZpD,KAAKkI,YAAcA,EAEnBjE,EAAQmE,UAAY,uBAEpBnF,EAAOmF,UAAY,sBAEnB3F,EAAQ2F,UAAY,uBAEpBjE,EAAUiE,UAAY,oBACtBjE,EAAUjB,MAAMS,QAAU,OAE1BO,EAAOkE,UAAY,sBACnBlE,EAAOmE,UAAY,iBAEnBjF,EAAKF,MAAMS,QAAU,OAErBP,EAAKgF,UAAY,oBACjBhF,EAAKkF,UACD,2NAKJrF,EAAOsF,YAAY9F,GACnBQ,EAAOsF,YAAYrE,GACnBjB,EAAOsF,YAAYpE,GACnBlB,EAAOsF,YAAYnF,GAEnBa,EAAQsE,YAAYtF,GAEfjD,KAAK0C,QAAQuB,EAAQf,MAAMR,MAAQ1C,KAAK0C,OACxC1C,KAAK4C,SACNqB,EAAQf,MAAMN,OAAS5C,KAAK4C,OAC5BqB,EAAQf,MAAM,eAAiBlD,KAAK4C,QAEnC0E,EAAQM,KAAM5H,KAAKwI,UAAWlB,EAAQM,KAE3C5F,EAAWhC,MFmef,MA5XA4G,GAAaS,IACTH,IAAK,YACLV,MAAO,SEjGCoB,GAAM,GAAAa,GAAAzI,IACd,OAAO+D,GAAA,EAAK7C,KACJ0G,IAAKA,EACLc,KAAM,SAETC,KAAK,SAAAC,GAAA,MAAQH,GAAKI,WAAWD,QF8GlC1B,IAAK,aACLV,MAAO,SEtGEsB,GAAO,GAAAgB,GAAA9I,KACV+I,EAAK,GAAIC,YACTvH,EAAI,GAAIwH,SAAQ,SAACC,EAASC,GAC5BJ,EAAGhD,OAAS,SAAErB,GACVoE,EAAKM,QAAQL,EAAGM,QAChBP,EAAKhB,KAAOA,EAEZgB,EAAK3E,UAAUjB,MAAMS,QAAuB,aAAbmE,EAAKY,KAAsB,QAAU,OAEpEQ,MAOR,OAFAH,GAAGO,cAAcxB,GAEVrG,KFiHPyF,IAAK,UACLV,MAAO,SE1GD+C,GACNA,EAAUA,GAAWvJ,KAAKkE,OAAOsF,UAAUxJ,KAAK6H,QAAU7H,KAAK8H,KAAKY,MAEpE1I,KAAKyC,QAAQgH,IAAMF,EACnBvJ,KAAKkI,YAAYuB,IAAMF,EACvBvJ,KAAKmE,UAAUsF,IAAMF,KFmHrBrC,IAAK,QACLV,MAAO,WE5GPxG,KAAKyC,QAAQgH,IAAMzJ,KAAKkI,YAAYuB,OFsHpCvC,IAAK,UACLV,MAAO,WE/GP,GAAMtC,GAASlE,KAAKkE,MAEpB,QACIxB,MAAOwB,EAAOxB,MACdE,OAAQsB,EAAOtB,WF4HnBsE,IAAK,aACLV,MAAO,SEnHEkD,EAAQC,GACjB,GAAMvG,GAAOpD,KAAKoD,KACZQ,EAAW5D,KAAK4D,SAAWd,YAAY6G,GAAQ,GAAG5G,QAAQ,IAE5DI,EAASC,EAAKF,MACd0G,EAA2B,SAAlBzG,EAAOQ,OAYpB,QAVsB,KAAV+F,IACRA,GAAUE,GAGTF,IAAS1J,KAAKmE,UAAUjB,MAAMS,QAAU,QAE7CR,EAAOQ,QAAU+F,EAAS,QAAU,OACpCvG,EAAOU,KAAOV,EAAOW,IAAM,EAC3BX,EAAOT,MAAQS,EAAOP,OAAS,OAE1B8G,GAAU9F,EAAW,CACtB,GAAIiG,GAASzG,EAAKG,YACduG,EAAU1G,EAAKK,aACfsG,EAAUjH,YAAY+G,EAASC,GAAS/G,QAAQ,GAE/CgH,IAAWnG,IACPmG,EAAUnG,EACXT,EAAOT,MAAQoH,EAAUlG,EAAWP,EAAa,KAEjDF,EAAOP,OAASiH,EAASjG,EAAWP,EAAa,MAK7D,MAAOqG,MFgIPxC,IAAK,cACLV,MAAO,WEtHmC,GAAlC3C,GAAkC0D,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAA3B,EAAGzD,EAAwByD,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAAlB,EAAG7E,EAAe6E,UAAA,GAAR3E,EAAQ2E,UAAA,GACpC9G,EAAIsH,SAASE,cAAc,UAC3BxF,EAAUzC,KAAKyC,OAUrB,OARAC,GAAQA,GAASD,EAAQC,MACzBE,EAASA,GAAUH,EAAQG,OAE3BnC,EAAEiC,MAAQA,EACVjC,EAAEmC,OAASA,EAEXnC,EAAEuJ,WAAW,MAAMC,UAAUxH,EAASoB,EAAMC,EAAKpB,EAAOE,EAAQ,EAAG,EAAGF,EAAOE,GAEtEnC,KFmIPyG,IAAK,kBACLV,MAAO,WE7HP,GAAMpD,GAAOpD,KAAKoD,KACZuG,EAAO3J,KAAKyC,QAAQG,OAAS5C,KAAKkE,OAAOT,YAE/C,OAA2B,QAAtBL,EAAKF,MAAMS,SAERG,IAAK,EACLD,KAAM,EACNjB,OAAQ5C,KAAKyC,QAAQG,OACrBF,MAAO1C,KAAKyC,QAAQC,QAIpBoB,IAAKoG,SAAS9G,EAAKkC,UAAYqE,GAC/B9F,KAAMqG,SAAS9G,EAAKiC,WAAasE,GACjC/G,OAAQsH,UAAU9G,EAAKyB,aAAexB,GAAcsG,GACpDjH,MAAOwH,UAAU9G,EAAKwB,YAAcvB,GAAcsG,OFuI1DzC,IAAK,UACLV,MAAO,WEhIP,GAAM2D,GAAUnK,KAAKoK,iBAErBpK,MAAKoJ,QAAQpJ,KAAKqK,YAAYF,EAAQtG,KAAMsG,EAAQrG,IAAKqG,EAAQzH,MAAOyH,EAAQvH,QAAQ4G,UAAUxJ,KAAK6H,QAAU7H,KAAK8H,KAAKY,UF0I3HxB,IAAK,SACLV,MAAO,SEpIF8D,EAAOC,GACZ,GAAM9H,GAAUzC,KAAKyC,OAErBzC,MAAKmE,UAAUjB,MAAMS,QAAU,MAE/B,IAAIlD,GAAIT,KAAKqK,cACTG,EAAK/J,EAAEuJ,WAAW,MAClBS,EAAKhI,EAAQC,MACbgI,EAAKjI,EAAQG,OACb+H,EAAK,EACLC,EAAK,CAKT,KAFAN,EAAQA,EAAQ,KAAQA,EAAQ,EAAI,IAAM,IAE7B,EAAI,CACb,GAAIO,GAAIP,EAAQQ,KAAKC,GAAK,IACtBC,EAAOF,KAAKG,IAAIH,KAAKI,IAAIL,GAAG9H,QAAQ,IACpCoI,EAAOL,KAAKG,IAAIH,KAAKM,IAAIP,GAAG9H,QAAQ,GAExCtC,GAAEiC,MAAQgI,EAAKM,EAAOP,EAAKU,EAC3B1K,EAAEmC,OAAS8H,EAAKS,EAAOV,EAAKO,EAEvBV,GAAS,IACVK,EAAKD,EAAKM,EAAOG,EACjBP,GAAOF,EAAKM,EAAOA,GACXV,EAAQ,IAAMA,GAAS,KAC/BK,GAAOF,EAAKU,EAAOA,EACnBP,IAAOH,EAAKU,EAAOH,EAAON,IAClBJ,EAAQ,KAAOA,GAAS,KAChCK,IAAOD,EAAKS,EAAOH,EAAOP,GAC1BG,GAAOF,EAAKS,EAAOA,IAEnBR,GAAOF,EAAKO,EAAOA,EACnBJ,GAAOH,EAAKO,EAAOG,GAIvBX,EAAGa,OAAOR,GAGdL,EAAGP,UAAUxH,EAASkI,EAAIC,GAErBL,GAAazJ,OAAAiD,EAAA,GAAStD,EAAG8J,GAE9BvK,KAAKyC,QAAQgH,IAAMhJ,EAAE+I,UAAUxJ,KAAK6H,QAAU7H,KAAK8H,KAAKY,SF+IxDxB,IAAK,OACLV,MAAO,WEtIuD,GAA3D8E,GAA2D/D,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAA9C,EAAGgE,EAA2ChE,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAAhC,EAAGiE,EAA6BjE,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAAhB,EAAGkE,EAAalE,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAAJ,EACpDrD,EAASlE,KAAKkE,MAEpBlE,MAAKmE,UAAUjB,MAAMS,QAAU,OAE/BO,EAAO8B,KAAK9B,EAAO+B,QAAQjG,KAAKkI,cAAcwD,iCAAiCJ,EAAYC,EAAUC,EAAYC,IAASvF,YFsJ1HgB,IAAK,WACLV,MAAO,WE9IyD,GAAzDmF,GAAyDpE,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAAnD,EAAGqE,EAAgDrE,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAArC,EAAGsE,EAAkCtE,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAApB,EAAGuE,EAAiBvE,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,GAAJ,EACtDrD,EAASlE,KAAKkE,MAEpBlE,MAAKmE,UAAUjB,MAAMS,QAAU,OAE/BO,EAAO8B,KAAK9B,EAAO+B,QAAQjG,KAAKkI,cAAc6D,UAAUJ,EAAKC,EAAUC,EAAaC,IAAa5F,YF8JjGgB,IAAK,UACLV,MAAO,SEtJD9D,EAAOE,EAAQoJ,GACrB,GAAMvJ,GAAUzC,KAAKyC,QACf0H,EAAUnK,KAAKoK,kBAEjB1B,EAAO1I,KAAK6H,QAAU7H,KAAK8H,KAAKY,KAChCjI,EAAIT,KAAKqK,YAAYF,EAAQtG,KAAMsG,EAAQrG,IAAKqG,EAAQzH,MAAOyH,EAAQvH,QACvEgG,EAAO,IAgBX,OAdAlG,GAAQA,GAASD,EAAQC,MACzBE,EAASA,GAAUH,EAAQG,OAGvBgG,EADClG,GAASyH,EAAQzH,OAASE,GAAUuH,EAAQvH,OACtC9B,OAAA4F,EAAA,IACHhE,MAAOwH,SAASxH,GAChBE,OAAQsH,SAAStH,IAClBnC,GAAG+I,UAAUd,GAETjI,EAAE+I,UAAUd,GAGlBsD,IAASpD,EAAO9H,OAAAiD,EAAA,GAAqB6E,EAAMF,IAEzCE,KF+JP1B,IAAK,WACLV,MAAO,SEzJA9D,EAAOE,GACd,GAAMsF,GAAclI,KAAKkI,YAErB+D,EAAQlE,SAASE,cAAc,KAC/BiE,EAAMnE,SAASoE,YAAY,eAC3BzD,GAAQ1I,KAAK6H,QAAU7H,KAAK8H,KAAKY,MAAM0D,MAAM,KAAK,IAAM,KAE5D1J,GAAQA,GAASwF,EAAYxF,MAC7BE,EAASA,GAAUsF,EAAYtF,OAE/BqJ,EAAMI,KAAOrM,KAAKsM,QAAQ5J,EAAOE,GACjCqJ,EAAMM,SAAc7J,EAApB,IAA6BE,EAA7B,IAAuC8F,EAEvCwD,EAAIM,eAAe,SAAS,GAAM,EAAOlG,OAAQ,EAAG,EAAG,EAAG,EAAG,GAAG,GAAO,GAAO,GAAO,EAAO,GAE5F2F,EAAMQ,cAAcP,MFkKpBhF,IAAK,SACLV,MAAO,SE5JFkG,GACL,GAAIC,GAAW,GAAIC,UACfC,EAAUH,EAAOG,SAAW,eAC5BvF,GACAM,IAAK8E,EAAO9E,IACZc,KAAM,OACNE,KAAM+D,EASV,OANKD,GAAOI,SACRH,EAASI,OAAOF,EAAS7M,KAAK8H,MAE9B6E,EAASI,OAAOF,EAAS7M,KAAKsM,QAAQI,EAAOhK,MAAOgK,EAAO9J,QAAQ,IAGhEmB,EAAA,EAAKiJ,KAAK1F,OFgKdD,IAMkB1F,GAA6B,QAAI,EEjKxC,mBAAX2E,SAA0BA,OAAO2G,MACxC3G,OAAOe,QAAUA,IFuKf,SAAUzH,EAAQD,EAASO,GGvxBjC,GAAAgN,GAAAhN,EAAA,EACA,iBAAAgN,SAAAtN,EAAAS,EAAA6M,EAAA,MACAA,EAAAC,SAAAvN,EAAAD,QAAAuN,EAAAC,OAEAjN,GAAA,cAAAgN,GAAA,OHgyBM,SAAUtN,EAAQD,EAASO,GIvyBjCP,EAAAC,EAAAD,QAAAO,EAAA,OAKAP,EAAAyN,MAAAxN,EAAAS,EAAA,yvCAAoxC,MJgzB9wC,SAAUT,EAAQD,GKpwBxB,QAAA0N,GAAAC,EAAAC,GACA,GAAAL,GAAAI,EAAA,OACAE,EAAAF,EAAA,EACA,KAAAE,EACA,MAAAN,EAGA,IAAAK,GAAA,kBAAAE,MAAA,CACA,GAAAC,GAAAC,EAAAH,EAKA,QAAAN,GAAAU,OAJAJ,EAAAK,QAAAC,IAAA,SAAA7K,GACA,uBAAAuK,EAAAO,WAAA9K,EAAA,SAGA2K,QAAAF,IAAAM,KAAA,MAGA,OAAAd,GAAAc,KAAA,MAIA,QAAAL,GAAAM,GAKA,yEAHAR,KAAAS,SAAAC,mBAAAC,KAAAC,UAAAJ,MAGA,MArEArO,EAAAD,QAAA,SAAA4N,GACA,GAAAe,KAwCA,OArCAA,GAAAC,SAAA,WACA,MAAAvO,MAAA8N,IAAA,SAAAR,GACA,GAAAJ,GAAAG,EAAAC,EAAAC,EACA,OAAAD,GAAA,GACA,UAAAA,EAAA,OAAmCJ,EAAA,IAEnCA,IAEGc,KAAA,KAIHM,EAAAjO,EAAA,SAAAJ,EAAAuO,GACA,gBAAAvO,KACAA,IAAA,KAAAA,EAAA,KAEA,QADAwO,MACApO,EAAA,EAAgBA,EAAAL,KAAA+E,OAAiB1E,IAAA,CACjC,GAAAqH,GAAA1H,KAAAK,GAAA,EACA,iBAAAqH,KACA+G,EAAA/G,IAAA,GAEA,IAAArH,EAAA,EAAYA,EAAAJ,EAAA8E,OAAoB1E,IAAA,CAChC,GAAAiN,GAAArN,EAAAI,EAKA,iBAAAiN,GAAA,IAAAmB,EAAAnB,EAAA,MACAkB,IAAAlB,EAAA,GACAA,EAAA,GAAAkB,EACKA,IACLlB,EAAA,OAAAA,EAAA,aAAAkB,EAAA,KAEAF,EAAAlB,KAAAE,MAIAgB,ILy1BM,SAAU1O,EAAQD,EAASO,GMlzBjC,QAAAwO,GAAAC,GACA,OAAAtO,GAAA,EAAiBA,EAAAsO,EAAA5J,OAAmB1E,IAAA,CACpC,GAAAiN,GAAAqB,EAAAtO,GACAuO,EAAAC,EAAAvB,EAAA5F,GACA,IAAAkH,EAAA,CACAA,EAAAE,MACA,QAAAC,GAAA,EAAqBA,EAAAH,EAAAI,MAAAjK,OAA2BgK,IAChDH,EAAAI,MAAAD,GAAAzB,EAAA0B,MAAAD,GAEA,MAAYA,EAAAzB,EAAA0B,MAAAjK,OAAuBgK,IACnCH,EAAAI,MAAA5B,KAAA6B,EAAA3B,EAAA0B,MAAAD,IAEAH,GAAAI,MAAAjK,OAAAuI,EAAA0B,MAAAjK,SACA6J,EAAAI,MAAAjK,OAAAuI,EAAA0B,MAAAjK,YAEK,CAEL,OADAiK,MACAD,EAAA,EAAqBA,EAAAzB,EAAA0B,MAAAjK,OAAuBgK,IAC5CC,EAAA5B,KAAA6B,EAAA3B,EAAA0B,MAAAD,IAEAF,GAAAvB,EAAA5F,KAA8BA,GAAA4F,EAAA5F,GAAAoH,KAAA,EAAAE,WAK9B,QAAAE,KACA,GAAAC,GAAApH,SAAAE,cAAA,QAGA,OAFAkH,GAAAzG,KAAA,WACA0G,EAAA7G,YAAA4G,GACAA,EAGA,QAAAF,GAAAI,GACA,GAAAnJ,GAAAoJ,EACAH,EAAApH,SAAAwH,cAAA,SAAAC,EAAA,MAAAH,EAAA3H,GAAA,KAEA,IAAAyH,EAAA,CACA,GAAAM,EAGA,MAAAC,EAOAP,GAAAQ,WAAAC,YAAAT,GAIA,GAAAU,EAAA,CAEA,GAAAC,GAAAC,GACAZ,GAAAa,MAAAd,KACAhJ,EAAA+J,EAAAC,KAAA,KAAAf,EAAAW,GAAA,GACAR,EAAAW,EAAAC,KAAA,KAAAf,EAAAW,GAAA,OAGAX,GAAAD,IACAhJ,EAAAiK,EAAAD,KAAA,KAAAf,GACAG,EAAA,WACAH,EAAAQ,WAAAC,YAAAT,GAMA,OAFAjJ,GAAAmJ,GAEA,SAAAe,GACA,GAAAA,EAAA,CACA,GAAAA,EAAAC,MAAAhB,EAAAgB,KACAD,EAAAE,QAAAjB,EAAAiB,OACAF,EAAAnC,YAAAoB,EAAApB,UACA,MAEA/H,GAAAmJ,EAAAe,OAEAd,MAcA,QAAAW,GAAAd,EAAAoB,EAAAjB,EAAAD,GACA,GAAAgB,GAAAf,EAAA,GAAAD,EAAAgB,GAEA,IAAAlB,EAAAqB,WACArB,EAAAqB,WAAAC,QAAAC,EAAAH,EAAAF,OACG,CACH,GAAAM,GAAA5I,SAAA6I,eAAAP,GACAQ,EAAA1B,EAAA0B,UACAA,GAAAN,IAAApB,EAAAS,YAAAiB,EAAAN,IACAM,EAAA9L,OACAoK,EAAA2B,aAAAH,EAAAE,EAAAN,IAEApB,EAAA5G,YAAAoI,IAKA,QAAAR,GAAAhB,EAAAE,GACA,GAAAgB,GAAAhB,EAAAgB,IACAC,EAAAjB,EAAAiB,MACArC,EAAAoB,EAAApB,SAiBA,IAfAqC,GACAnB,EAAA4B,aAAA,QAAAT,GAEAhJ,EAAA0J,OACA7B,EAAA4B,aAAAvB,EAAAH,EAAA3H,IAGAuG,IAGAoC,GAAA,mBAAApC,EAAAJ,QAAA,SAEAwC,GAAA,uDAAyD5C,KAAAS,SAAAC,mBAAAC,KAAAC,UAAAJ,MAAA,OAGzDkB,EAAAqB,WACArB,EAAAqB,WAAAC,QAAAJ,MACG,CACH,KAAAlB,EAAA8B,YACA9B,EAAAS,YAAAT,EAAA8B,WAEA9B,GAAA5G,YAAAR,SAAA6I,eAAAP,KArNA,GAAAa,GAAA,mBAAAnJ,SAEA,uBAAAoJ,gBACAD,EACA,SAAAE,OACA,0JAKA,IAAAC,GAAAnR,EAAA,GAeA2O,KAQAO,EAAA8B,IAAAnJ,SAAAqH,MAAArH,SAAAxD,qBAAA,YACAyL,EAAA,KACAD,EAAA,EACAN,GAAA,EACAC,EAAA,aACApI,EAAA,KACAkI,EAAA,kBAIAK,EAAA,mBAAAyB,YAAA,eAAAC,KAAAD,UAAAE,UAAAC,cAEA7R,GAAAD,QAAA,SAAA+R,EAAApD,EAAAqD,EAAAC,GACAnC,EAAAkC,EAEArK,EAAAsK,KAEA,IAAAjD,GAAA0C,EAAAK,EAAApD,EAGA,OAFAI,GAAAC,GAEA,SAAAkD,GAEA,OADAC,MACAzR,EAAA,EAAmBA,EAAAsO,EAAA5J,OAAmB1E,IAAA,CACtC,GAAAiN,GAAAqB,EAAAtO,GACAuO,EAAAC,EAAAvB,EAAA5F,GACAkH,GAAAE,OACAgD,EAAA1E,KAAAwB,GAEAiD,GACAlD,EAAA0C,EAAAK,EAAAG,GACAnD,EAAAC,IAEAA,IAEA,QAAAtO,GAAA,EAAmBA,EAAAyR,EAAA/M,OAAsB1E,IAAA,CACzC,GAAAuO,GAAAkD,EAAAzR,EACA,QAAAuO,EAAAE,KAAA,CACA,OAAAC,GAAA,EAAuBA,EAAAH,EAAAI,MAAAjK,OAA2BgK,IAClDH,EAAAI,MAAAD,WAEAF,GAAAD,EAAAlH,OAwFA,IAAAgJ,GAAA,WACA,GAAAqB,KAEA,iBAAAxB,EAAAyB,GAEA,MADAD,GAAAxB,GAAAyB,EACAD,EAAAE,OAAAC,SAAAlE,KAAA,WN+7BM,SAAUpO,EAAQD,GOvmCxBC,EAAAD,QAAA,SAAA+R,EAAApD,GAGA,OAFAK,MACAwD,KACA9R,EAAA,EAAiBA,EAAAiO,EAAAvJ,OAAiB1E,IAAA,CAClC,GAAAiN,GAAAgB,EAAAjO,GACAqH,EAAA4F,EAAA,GACA+C,EAAA/C,EAAA,GACAgD,EAAAhD,EAAA,GACAW,EAAAX,EAAA,GACA8E,GACA1K,GAAAgK,EAAA,IAAArR,EACAgQ,MACAC,QACArC,YAEAkE,GAAAzK,GAGAyK,EAAAzK,GAAAsH,MAAA5B,KAAAgF,GAFAzD,EAAAvB,KAAA+E,EAAAzK,IAAmCA,KAAAsH,OAAAoD,KAKnC,MAAAzD,KPmnCM,SAAU/O,EAAQ+B,EAAqBzB,GAE7C,YQ9nCO,SAASmS,GAAOA,EAAOC,EAAOzK,EAAQ0K,GA+E5C,QAASC,KAGPC,EADqB,gBAAlB,KAAO5K,EAAP,YAAA6K,EAAO7K,IACEA,EACFyK,EAAM7I,KAAO8I,EACXrO,EAEA6D,SAASE,cAAc,UAEpCwK,EAAU/P,MAAQiQ,EAClBF,EAAU7P,OAASgQ,EACnBC,EAASJ,EAAUzI,WAAW,MAE/B,QAAS8I,GAAaC,GACrB,GAAKA,EAEE,CACN,GAEGC,GAFCC,EAAYJ,EAAOC,aAAa,EAAG,EAAGH,EAAIC,GAC3CM,EAAaD,EAAUrK,IAE1B,KAAKoK,EAAS,EAAGA,EAASG,GAAMH,GAAU,EACzCE,EAAWF,GAAcD,EAAUC,GAAcI,GAAQ,EACzDF,EAAWF,EAAS,GAAKD,EAAUC,EAAS,GAAKI,GAAQ,EACzDF,EAAWF,EAAS,GAAKD,EAAUC,EAAS,GAAKI,GAAQ,EACzDF,EAAWF,EAAS,GAAKK,EAAYN,EAAUC,EAAS,GAAKI,GAAQ,EAAI,GAG1E,OAAOH,GAZP,MAAOJ,GAAOC,aAAa,EAAG,EAAGH,EAAIC,GA7FlCN,IACJA,EAAQD,EAAMC,MACdzK,EAASwK,EAAMxK,OACf0K,EAAiBF,EAAME,eACnBF,EAAMA,QAAOA,EAAQA,EAAMA,OAGhC,IACInO,GAAQoP,EADRD,GAAY,CAEhB,IAAIf,EAAM7I,IAET,GADAvF,EAAS6D,SAASE,cAAc,UACN,MAAtBqK,EAAMiB,aACTrP,EAAOxB,MAAQ4P,EAAMiB,aACrBrP,EAAOtB,OAAS0P,EAAMkB,kBAChB,IAA0B,MAAtBlB,EAAMmB,aAAsB,CACtC,GAAIA,GAAenB,EAAMmB,aACrBC,EAAKD,EAAa/Q,MAAOiR,EAAKF,EAAa7Q,MAC/C6Q,GAAa/Q,MAAQ,OACrB+Q,EAAa7Q,OAAS,OACtBsB,EAAOxB,MAAQ4P,EAAM5P,MACrBwB,EAAOtB,OAAS0P,EAAM1P,OACtB6Q,EAAa/Q,MAAQgR,EACrBD,EAAa7Q,OAAS+Q,MAChB,CACN,GAAID,GAAKpB,EAAM5P,MAAOiR,EAAKrB,EAAM1P,MAC7B0P,GAAMsB,kBACTtB,EAAMsB,gBAAgB,SACtBtB,EAAMsB,gBAAgB,WAEvB1P,EAAOxB,MAAQ4P,EAAM5P,MACrBwB,EAAOtB,OAAS0P,EAAM1P,OACtB0P,EAAM5P,MAAQgR,EACdpB,EAAM1P,OAAS+Q,MAGhBzP,GAASoO,CAEVgB,GAAMpP,EAAO8F,WAAW,MACpBsI,EAAM7I,KAAK6J,EAAIrJ,UAAUqI,EAAO,EAAG,EACvC,IACGK,GAAIC,EADHiB,EAAK3P,EAAOxB,MAAOoR,EAAK5P,EAAOtB,OAEhCmR,EAAeT,EAAIR,aAAa,EAAG,EAAGe,EAAIC,GAAIlL,IAEjD,KAAKiL,IAAOC,EAAK,OAAO,GACpBxB,EAAM7I,KAAO8I,IAChBrO,EAAO8P,UAAU,EAAG,EAAGH,EAAIC,GAEP,gBAAjB,KAAOzB,EAAP,YAAAK,EAAOL,IACNA,EAAM3P,OACTiQ,EAAKN,EAAM3P,MAAQ,GAAM,EACzBkQ,EAAKP,EAAMzP,OAAS,GAAM,IAE1B+P,EAAKkB,EAAKxB,EAAM4B,OAAS,GAAM,EAC/BrB,EAAKkB,EAAKzB,EAAM6B,OAAS,GAAM,IAGhCvB,EAAKN,EAAQwB,EAAK,GAAM,EACxBjB,EAAKP,EAAQyB,EAAK,GAAM,EAEzB,IAEGK,GAAIC,EACJC,EAAIC,EAAIC,EACRC,EAAKC,EAAKC,EAAKC,EACfC,EAAGC,EAAIC,EAAKC,EAAIC,EAChBC,EAAQC,EAERnC,EACAoC,EAAGC,EAAGC,EAAGC,EACTC,EAAKC,EACL/C,EAAWI,EAAQI,EAAWC,EAE9BuC,EAAMC,EAAMC,EAAMC,EAClBC,EAAMC,EAAMC,EAAMC,EAdjBC,EAAMtD,GAAM,EACbuD,GAAMrC,GAAM,EACJsC,GAAS,EACAnD,GAAS,EAI1BG,GAAO8C,EAAMrD,EAKbQ,GAAQ,OAAS,IAGjBa,GAAStB,EAAKkB,EACdK,GAAStB,EAAKkB,EACdsC,GAAUnC,GAASC,EAiCtB,IAAID,GAAS,GAAKC,GAAS,EAAG,IAEpBmC,IAAT,SAAkBC,EAAGhB,EAAGD,EAAG5U,EAAGC,GAC7B,MAAO,IAAOD,EAAI6U,GAAK,EAAIA,EAAI,EAAID,EAAI,EAAI5U,EAAIC,GAAK,GAAK2U,EAAI5U,GAAKC,EAAI4U,GAAKgB,GAAKA,GAAKA,EAAIjB,EAK1F,KAHA7C,IACAS,EAAYH,IACZI,EAAaD,EAAUrK,KAClB0L,EAAK,EAAGA,EAAK1B,EAAI0B,IAarB,IAZAF,EAAKE,EAAKJ,GACVS,EAAW,EAALP,EACNmB,EAAMnB,EAAKO,EACXe,EAAOf,EAAMuB,GACbT,EAAOd,EAAM,EAAIe,EAAOA,EAAOQ,GAC3BvB,EAAMb,EAAK,GACd6B,EAAOD,EAAOQ,GACdN,GAAQjB,EAAM,GAAKuB,IAEnBP,EAAOC,EAAOjB,EAAMb,EAAK,EAAI4B,EAAOA,EAAOQ,GAGvC7B,EAAK,EAAGA,EAAK1B,EAAI0B,IAAMrB,IAAU,EACrCmB,EAAKE,EAAKJ,GACVS,EAAW,EAALP,EACNqB,EAAMrB,EAAKO,EACXoB,EAAOpB,GAAO,EACdmB,EAAOnB,EAAM,EAAIoB,EAAOA,EAAO,EAC3BpB,EAAMb,EAAK,GACdkC,EAAOD,EAAO,EACdE,EAAOF,EAAO,GAEdC,EAAOC,EAAOtB,EAAMb,EAAK,EAAIiC,EAAOA,EAAO,EAI5CX,EAAIkB,GAAQd,EACTc,GAAQb,EACNzB,EAAa0B,EAAOI,GACpB9B,EAAa0B,EAAOK,GACpB/B,EAAa0B,EAAOM,GACpBhC,EAAa0B,EAAOO,IAErBK,GAAQb,EACPzB,EAAa2B,EAAOG,GACpB9B,EAAa2B,EAAOI,GACpB/B,EAAa2B,EAAOK,GACpBhC,EAAa2B,EAAOM,IAErBK,GAAQb,EACPzB,EAAa4B,EAAOE,GACpB9B,EAAa4B,EAAOG,GACpB/B,EAAa4B,EAAOI,GACpBhC,EAAa4B,EAAOK,IAErBK,GAAQb,EACPzB,EAAa6B,EAAOC,GACpB9B,EAAa6B,EAAOE,GACpB/B,EAAa6B,EAAOG,GACpBhC,EAAa6B,EAAOI,KAEnB5C,GAAQ,IAGZyC,IAAQC,IAAQC,IAAQC,EAC1BZ,EAAIiB,GAAQd,EACTc,GAAQb,EACNzB,EAAa0B,EAAOI,GACpB9B,EAAa0B,EAAOK,GACpB/B,EAAa0B,EAAOM,GACpBhC,EAAa0B,EAAOO,IAErBK,GAAQb,EACPzB,EAAa2B,EAAOG,GACpB9B,EAAa2B,EAAOI,GACpB/B,EAAa2B,EAAOK,GACpBhC,EAAa2B,EAAOM,IAErBK,GAAQb,EACPzB,EAAa4B,EAAOE,GACpB9B,EAAa4B,EAAOG,GACpB/B,EAAa4B,EAAOI,GACpBhC,EAAa4B,EAAOK,IAErBK,GAAQb,EACPzB,EAAa6B,EAAOC,GACpB9B,EAAa6B,EAAOE,GACpB/B,EAAa6B,EAAOG,GACpBhC,EAAa6B,EAAOI,KAEnB5C,GAAQ,IAGZyC,IAAQC,IAAQC,IAAQC,EAC1BX,EAAIgB,GAAQd,EACTc,GAAQb,EACNzB,EAAa0B,EAAOI,GACpB9B,EAAa0B,EAAOK,GACpB/B,EAAa0B,EAAOM,GACpBhC,EAAa0B,EAAOO,IAErBK,GAAQb,EACPzB,EAAa2B,EAAOG,GACpB9B,EAAa2B,EAAOI,GACpB/B,EAAa2B,EAAOK,GACpBhC,EAAa2B,EAAOM,IAErBK,GAAQb,EACPzB,EAAa4B,EAAOE,GACpB9B,EAAa4B,EAAOG,GACpB/B,EAAa4B,EAAOI,GACpBhC,EAAa4B,EAAOK,IAErBK,GAAQb,EACPzB,EAAa6B,EAAOC,GACpB9B,EAAa6B,EAAOE,GACpB/B,EAAa6B,EAAOG,GACpBhC,EAAa6B,EAAOI,KAEnB5C,GAAQ,EAEdF,EAAWF,IAAcmC,GAAK,EAAIA,EAAI,IAAMA,EAAI,IAAM,EACtDjC,EAAWF,GAAS,GAAKoC,GAAK,EAAIA,EAAI,IAAMA,EAAI,IAAM,EACtDlC,EAAWF,GAAS,GAAKqC,GAAK,EAAIA,EAAI,IAAMA,EAAI,IAAM,EAElDhC,KAEDwC,IAAQC,IAAQC,IAAQC,EAC1BV,EAAIe,GAAQd,EACTc,GAAQb,EACNzB,EAAa0B,EAAOI,GACpB9B,EAAa0B,EAAOK,GACpB/B,EAAa0B,EAAOM,GACpBhC,EAAa0B,EAAOO,IAErBK,GAAQb,EACPzB,EAAa2B,EAAOG,GACpB9B,EAAa2B,EAAOI,GACpB/B,EAAa2B,EAAOK,GACpBhC,EAAa2B,EAAOM,IAErBK,GAAQb,EACPzB,EAAa4B,EAAOE,GACpB9B,EAAa4B,EAAOG,GACpB/B,EAAa4B,EAAOI,GACpBhC,EAAa4B,EAAOK,IAErBK,GAAQb,EACPzB,EAAa6B,EAAOC,GACpB9B,EAAa6B,EAAOE,GACpB/B,EAAa6B,EAAOG,GACpBhC,EAAa6B,EAAOI,KAEnB5C,GAAQ,EACdF,EAAWF,GAAS,GAAKsC,GAAK,EAAIA,EAAI,IAAMA,EAAI,IAAM,GAEtDpC,EAAWF,GAAS,GAAK,QAItB,CAEN,GAAIuD,aACHxD,EAAY,GAAIwD,cAAapD,QAG7B,KADAJ,KACKC,GAAS,EAAGA,GAASG,KAAQH,GACjCD,EAAUC,IAAU,CAItB,KAAKoB,EAAK,EAAGA,EAAKN,EAAIM,IASrB,IARAE,EAAKF,EAAKF,GACVO,EAAW,EAALH,EACNC,EAAUE,EAAMwB,EAChBf,MAAcT,GAAOH,EAAKJ,GAAS,KAAOJ,EAAK,EAAIM,KAAS,EACxDc,IACHH,EAAKN,EAAM,EAAIH,EACfU,EAAMV,EAAKJ,GAASO,EAAM,GAEtBN,EAAK,EAAGA,EAAKN,EAAIM,IAAMgC,IAAU,EAarC,OAZA9B,EAAKF,EAAKF,GACVO,EAAW,EAALH,EACNrB,GAASuB,GAAWC,GAAO,GAC3BS,MAAaT,GAAOH,EAAKJ,GAAS,KAAOJ,EAAK,EAAIM,IAC9Cc,IACHJ,EAAKL,EAAM,EAAIH,EACfS,EAAMT,EAAKJ,GAASO,EAAM,GAE3BW,EAAIpB,EAAaoC,IACjBf,EAAIrB,EAAaoC,GAAS,GAC1Bd,EAAItB,EAAaoC,GAAS,GACtB9C,IAAWiC,EAAIvB,EAAaoC,GAAS,IACjClB,EAASC,GAChB,IAAK,GACJnC,EAAUC,KAAemC,EAAIiB,GAC7BrD,EAAUC,GAAS,IAAMoC,EAAIgB,GAC7BrD,EAAUC,GAAS,IAAMqC,EAAIe,GACzB/C,IAAWN,EAAUC,GAAS,IAAMsC,EAAIc,GAC5C,MACD,KAAK,GACJxB,EAAIC,EAAKX,GACTnB,EAAUC,KAAemC,EAAIP,EAC7B7B,EAAUC,GAAS,IAAMoC,EAAIR,EAC7B7B,EAAUC,GAAS,IAAMqC,EAAIT,EACzBvB,IAAWN,EAAUC,GAAS,IAAMsC,EAAIV,GAC5CA,EAAIE,EAAMZ,GACVnB,EAAUC,GAAS,IAAMmC,EAAIP,EAC7B7B,EAAUC,GAAS,IAAMoC,EAAIR,EAC7B7B,EAAUC,GAAS,IAAMqC,EAAIT,EACzBvB,IAAWN,EAAUC,GAAS,IAAMsC,EAAIV,EAC5C,MACD,KAAK,GACJA,EAAIX,GAASc,EACbhC,EAAUC,KAAemC,EAAIP,EAC7B7B,EAAUC,GAAS,IAAMoC,EAAIR,EAC7B7B,EAAUC,GAAS,IAAMqC,EAAIT,EACzBvB,IAAWN,EAAUC,GAAS,IAAMsC,EAAIV,GAC5CA,EAAIX,GAASe,EACbhC,IAAUiD,EACVlD,EAAUC,KAAemC,EAAIP,EAC7B7B,EAAUC,GAAS,IAAMoC,EAAIR,EAC7B7B,EAAUC,GAAS,IAAMqC,EAAIT,EACzBvB,IAAWN,EAAUC,GAAS,IAAMsC,EAAIV,EAC5C,MACD,SACCA,EAAIC,EAAKE,EACThC,EAAUC,KAAemC,EAAIP,EAC7B7B,EAAUC,GAAS,IAAMoC,EAAIR,EAC7B7B,EAAUC,GAAS,IAAMqC,EAAIT,EACzBvB,IAAWN,EAAUC,GAAS,IAAMsC,EAAIV,GAC5CA,EAAIE,EAAMC,EACVhC,EAAUC,GAAS,IAAMmC,EAAIP,EAC7B7B,EAAUC,GAAS,IAAMoC,EAAIR,EAC7B7B,EAAUC,GAAS,IAAMqC,EAAIT,EACzBvB,IAAWN,EAAUC,GAAS,IAAMsC,EAAIV,GAC5CA,EAAIC,EAAKG,EACThC,IAAUiD,EACVlD,EAAUC,KAAemC,EAAIP,EAC7B7B,EAAUC,GAAS,IAAMoC,EAAIR,EAC7B7B,EAAUC,GAAS,IAAMqC,EAAIT,EACzBvB,IAAWN,EAAUC,GAAS,IAAMsC,EAAIV,GAC5CA,EAAIE,EAAME,EACVjC,EAAUC,GAAS,IAAMmC,EAAIP,EAC7B7B,EAAUC,GAAS,IAAMoC,EAAIR,EAC7B7B,EAAUC,GAAS,IAAMqC,EAAIT,EACzBvB,IAAWN,EAAUC,GAAS,IAAMsC,EAAIV,GAMhDpC,IACAS,EAAYH,EAAaC,GAI1B,GADAF,EAAO2D,aAAavD,EAAW,EAAG,GACZ,gBAAXpL,GAAqB,CAC/B,GAAe,QAAXA,GAA+B,SAAXA,EAAmB,CAC1C,GAAI4O,GASJ,OAPCA,IADGlE,GAAkBD,EAAM7I,IACrB6I,EAEA,GAAInK,OAEXsO,GAAI/T,MAAQiQ,EACZ8D,GAAI7T,OAASgQ,EACb6D,GAAIhN,IAAMgJ,EAAUjJ,UAAU,SAAW3B,EAAQ,GAC1C4O,GACD,GAAe,YAAX5O,GAAmC,aAAXA,EAClC,MAAO4K,GAAUjJ,UAAU,SAAW3B,EAAOuE,MAAM,KAAK,GAAI,GAG9D,MAAOqG,GRiwByB9Q,EAAuB,EAAI0Q,CAC5D,IAAIK,GAA4B,kBAAXgE,SAAoD,gBAApBA,QAAOC,SAAwB,SAAUtH,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAXqH,SAAyBrH,EAAIuH,cAAgBF,QAAUrH,IAAQqH,OAAOnV,UAAY,eAAkB8N,KAgVhQ,SAAUzP,EAAQ+B,EAAqBzB,GAE7C,YSl+CAA,GAAAQ,EAAAiB,EAAA,qBAAAkV,IAQO,IAAMA,GAAK,WAId,QAASC,GAAMC,EAAIvQ,EAAOwQ,GACtB,MAAOlM,MAAKmM,IAAIF,EAAIjM,KAAKoM,IAAI1Q,EAAOwQ,IAGxC,QAASG,GAAYlR,GACjB,OACImR,EAAGnR,EACHoR,eAAgB,SAAS1P,GAErB2P,EAAKtX,KAAKoX,EAAEE,GACZtX,KAAKoX,EAAEC,eAAe1P,IAE1B4P,QAAS,WAELD,EAAKtX,KAAKoX,EAAEE,GACZtX,KAAKoX,EAAEG,YAKnB,QAAStR,GAAQ0B,GACb,MAAOwP,GAAYK,EAAQC,YAAY9P,IAG3C,QAAS+P,GAAWhV,EAAOE,GACvB,GAAI8F,GAAO4O,EAAGK,aAOd,IAAIL,EAAGM,aAAa,sBAAwBN,EAAGM,aAAa,4BAA6B,CACrF,GAAIC,GAAc,GAAIL,GAAQ,IAAK,IAAKF,EAAGQ,KAAMR,EAAGS,MACpD,KAEIF,EAAYG,OAAO,WAAatP,EAAO4O,EAAGS,QAC5C,MAAOrT,IACTmT,EAAYN,UAGZvX,KAAKoX,EAAEnR,SAASjG,KAAKoX,EAAEnR,QAAQsR,UAC/BvX,KAAKoX,EAAEa,cAAcjY,KAAKoX,EAAEa,aAAaV,UAC7CvX,KAAK0C,MAAQA,EACb1C,KAAK4C,OAASA,EACd5C,KAAKoX,EAAEnR,QAAU,GAAIuR,GAAQ9U,EAAOE,EAAQ0U,EAAGQ,KAAMpP,GACrD1I,KAAKoX,EAAEa,aAAe,GAAIT,GAAQ9U,EAAOE,EAAQ0U,EAAGQ,KAAMpP,GAC1D1I,KAAKoX,EAAEc,aAAelY,KAAKoX,EAAEc,cAAgB,GAAIV,GAAQ,EAAG,EAAGF,EAAGQ,KAAMpP,GACxE1I,KAAKoX,EAAEe,cAAgBnY,KAAKoX,EAAEe,eAAiB,GAAIC,GAAO,KAAM,oMAapEpY,KAASgG,iBAActD,EAMnB,QAAK0U,GAAEnR,EAAQ+R,EAAOpV,GAUtB,MATIwV,QAAOC,eAAPpS,EAA0BqS,EAA1B5V,OAAA1C,KAAA0C,OAAAuD,EAAAmR,EAAAxU,QAAA5C,KAAA4C,QADJ8U,EAAAnX,KAAAP,KAAA0C,GAAAuD,EAAAmR,EAAA1U,MAAAE,GAAAqD,EAAAmR,EAAAxU,QAKHqD,EAAAmR,EAAAmB,MTu+CGvY,KAAKoX,EAAEnR,QAAQ+R,OAAO,WSr+C1BI,EAAAC,mBAAkBC,aAGPtY,KAGX,QAASwY,KAGDC,MAFJzY,MAAC0Y,UAAaH,MACdvY,KAAKoX,EAAEa,cAAaD,WAChBS,KAGP,QAAAD,GAAAC,EAAAE,EAAAD,EAAAE,ITu+CIF,GAAa1Y,KAAKoX,EAAEnR,SAASsS,MSr+ClCvY,KAAS6Y,eAAcb,OAAA,WACnBc,EAAKnJ,SAAWmB,GAAawH,aAE7BtY,KAAAoX,EAAOa,aAAPc,SAAAH,GAAA5Y,KAAAoX,EAAAnR,SAGJ,QAAS+S,GAATF,GAGI7S,MAFA6S,GAAI7S,WAAU6K,aAAY9Q,KAAOiG,GACjC6S,EAAK1B,WAAUmB,YAAfO,GACA7S,KAGA,QAAA+S,KACH,GAAA/S,GAAA,GAAAuR,GAAAxX,KAAAoX,EAAAnR,QAAAvD,MAAA1C,KAAAoX,EAAAnR,QAAArD,OAAA0U,EAAAQ,KAAAR,EAAAK,cT2+CG,OAJA3X,MAAKoX,EAAEnR,QAAQsS,MSr+CnBtS,EAAA+R,OAAA,WTu+CQI,EAAOC,mBAAmBC,aAEvBnB,EAAYlR,GS/9ClB,QAFDgT,KAGA,GAAArE,GAAOsE,KAAP9B,EAAAnR,QAAAvD,MACHyW,EAAAnZ,KAAAoX,EAAAnR,QAAArD,OTu+COsW,EAAQ,GAAIE,YAAWxE,EAAIuE,EAAI,ESl+C/B7B,OAHRtX,MAASqZ,UAATrB,OAAoB,WAChBV,EAAOgC,WAAA,EAAW,EAAA1E,EAAAuE,EAAA7B,EAAAQ,KAAAR,EAAAK,cAAAuB,KAEd5B,EAGA,QAAA+B,GAAAE,GACH,MAND,YAYJ,MTk+CQjC,GAAKtX,KAAKoX,EAAEE,GSl+CXkC,QAAgBC,KAAzBlS,YTmjDA,QAASwE,GAAS2N,GACd,GAAI/N,GAAM+N,EAAK,GACX9N,EAAW8N,EAAK,GAChB7N,EAAc6N,EAAK,GACnB5N,EAAa4N,EAAK,EAwEtB,OAvEApC,GAAGvL,SAAWuL,EAAGvL,UAAY,GAAIqM,GAAO,KAAM,4qCAgE9CI,EAAajY,KAAKP,KAAMsX,EAAGvL,UACvBJ,IAAKmL,GAAO,EAAGnL,EAAK,GACpBC,SAAUkL,GAAO,EAAGlL,EAAW,EAAG,GAClCC,YAAaiL,GAAO,EAAGjL,EAAc,EAAG,GACxCC,WAAYgL,GAAO,EAAGhL,EAAa,EAAG,KAGnC9L,KAWX,QShgDI0L,GAAAgO,GTigDA,GAAIpO,GAAaoO,EAAK,GSl9CtBlB,EAAajY,EAAK,GACd+K,EAAYwL,EAAM,GAClBvL,IAAUuL,ET4jDd,OS3jDItL,mCAAsBA,EAAaE,iCAAvB,GAAA0M,GAAA,wOAehBuB,EAAA,irDAmFAnB,EAAAjY,KAAAP,KAAAsX,EAAA5L,iCACAJ,WAASsO,OAA6B,MAClCrO,SAAOsO,WAAH,GACA/Y,WAAOC,OAAmB,QAEtBC,cAAc0K,iCACdzE,cAAUvE,MAH0C,KAAA8V,EAAxDjY,KAAAP,KAAAsX,EAAA5L,iCAMHoO,OAAA,EAAArO,EAAAzL,KAAA4C,UTg9CE5C,KS9nCPwX,WAAAuC,GACIzC,MAAG0C,QACH1C,YACHtX,KAHDia,MT88CAja,KAAKka,KSz8CL1C,WAEIuC,EAAAI,KAAI5S,SAAUxC,EAAVsQ,GACA,MAAAC,GAAIrP,SAEJrD,eAASqD,MACTmU,aAASnU,KAAQmU,IACjB1R,aAAOzC,EAAQyC,GAAf,GAGJ1I,MAAAka,EAAA,KACAla,KAAAqa,GAAI3X,IAEA,QAAArC,GAAKuC,IAALzB,EAAcyB,IAAdvC,EAAA,CAGAiX,MAAGgD,UAAYhD,GAAGiD,QAAYla,EAAA,GAC9BiX,GAAGkD,QAAWlD,GAAGiD,QAAjBla,EAAgC,IAAK+Z,EACxC3Y,EAAAgZ,EAAAza,KAAAqa,GAAAha,EAAA,IT48CDL,MAAKqa,GAAGha,IAAMoa,EAAM,GAAOhZ,CSx8C3B,IAAAiZ,IAAA1a,KAAAia,GAAA5Z,EAAA,GAAAL,KAAAia,GAAA5Z,KAAAL,KAAA2a,GAAAta,EAAA,GAAAL,KAAA2a,GAAAta,KAAAL,KAAAia,GAAA5Z,GAAAL,KAAAia,GAAA5Z,EAAA,KAAAL,KAAA2a,GAAAta,GAAAL,KAAA2a,GAAAta,EAAA,GAEAiX,MAAGsD,QAAgBtD,EAAGuD,IAAgBC,SAAtC,IAAArZ,EAGIzB,KAAAqa,GAAAlZ,EAAA,GAAM,CT68Cd,KAAK,GAAId,GAAIc,EAAI,EAAGd,GAAK,IAAKA,ESz8C1BL,KAAAqa,GAAAha,GAAAL,KAAAqa,GAAAha,GAAAL,KAAAqa,GAAAha,EAAA,GAAAL,KAAAka,EAAA7Z,GAlyBR,GACIiX,GADA3X,MAmbC,WTmiDD,QAASob,MSh9CT,QAAAnB,GAAAtC,GAgBA,WTq8C0C,KAAlCA,EAAGuC,4BS58CPmB,sBAAwB1D,EAAA,8BT88ChBrW,YAAY,EACZD,cAAc,EACdiG,UAAU,EACVT,MAAO,GAAIuU,KS18Cd3C,6BAIL6C,WAAeA,GACfC,qCAAmCF,EAAnChb,MAAAmb,EAAA5a,KAAAP,KAAAW,GAIA2W,QAAG8D,KACH,GAAIC,GAAIC,EAAkChE,KAAGiE,KTi9C7C,QSh9CqDC,IAAjDH,EAAMzV,QAAA,6BACTyV,EAAAjO,KAAA,4BT+8CMiO,ESz8CV,IT88CG,GAAI/D,GAAKvP,SAASE,cAAc,UAAU+B,WAAW,sBS58CzDoO,MAAO7W,IAGC,GAAA+V,IAAoC,IAApCA,EAAKqB,yBAAwBhY,QAAO,6BArHxC,SAAuB2W,GAEtB,IAAAA,EAAAM,aAAA,qBACD,OAAOyD,CAIP,IAAAP,GAAAxD,EAAAmE,oBACInE,EAAcrP,iBACpBqP,GAAAgD,YAAYhD,EAAAiD,WAAAmB,GT88CVpE,EAAGqE,cAAcrE,EAAGiD,WAAYjD,EAAGsE,mBAAoBtE,EAAGuE,SS58C9DvE,EAAAqE,cAAArE,EAAAiD,WAAAjD,EAAAwE,mBAAAxE,EAAAuE,SACIvE,EAAAqE,cAAUI,aAAHzE,EAA4B1R,eAAQ0R,EAAA0E,eAC3C1E,EAAAqE,cAAArE,EAAAiD,WAAAjD,EAAA2E,eAAA3E,EAAA0E,eACH1E,EAAAkD,WAAAlD,EAAAiD,WAAA,EAAAjD,EAAAQ,KAAA,MAAAR,EAAAQ,KAAAR,EAAAK,cAAA,MT88CGL,EAAGsD,gBAAgBtD,EAAGuD,YAAaC,GS58CvCxD,EAAA4E,qBAAA5E,EAAAuD,YAAAvD,EAAA6E,kBAAA7E,EAAAiD,WAAAmB,EAAA,EAGI,IAAIU,kBAA4BC,cAAsB9a,KACtD8a,IAAsB9a,eACtB8a,4BAAsB9a,GACzB+V,EAAAqE,cAAArE,EAAAiD,WAAAjD,EAAAsE,mBAAAtE,EAAAgF,QA/HLhF,EAAAqE,cAAArE,EAAAiD,WAAAjD,EAAAwE,mBAAAxE,EAAAgF,QT8kDQhF,EAAGqE,cAAcrE,EAAGiD,WAAYjD,EAAGiF,eAAgBjF,EAAG0E,eS58CtD9X,gBAASoT,EAAAiD,WAAWjD,EAAA2E,eAAA3E,EAAA0E,eACpB9X,aAAS6D,aAASE,EAAcqP,EAAAQ,KAApC,MAAAR,EAAAQ,KAAAR,EAAAS,MAAA,GAAAxB,cAAAiG,GAGE,IAAAhB,GAAUlE,EAAAmF,gBACRnF,IAAAoF,aAAApF,EAAAqF,eACHC,EAAAtF,EAAAoF,aAAApF,EAAAuF,gBACGvF,GAAJwF,aAASC,EAAA,+HAWTzF,EAAAwF,aAAAF,EAAA,2ITw9CItF,EAAG0F,cAAcD,GS58CrBzF,EAAOpT,cAAP0Y,GA9BJtF,EAAA2F,aAAAzB,EAAAuB,GAgCAzF,EAAA2F,aAAAzB,EAAAoB,GT88CQtF,EAAG8D,YAAYI,ES18Cf,IAAA0B,GAAOpc,EAAOS,cACjB+V,GAAA6F,WAAA7F,EAAA8F,aAAAF,GT88CG5F,EAAG+F,WAAW/F,EAAG8F,aAAc,GAAI7G,eAAc,EAAG,IAAKe,EAAGgG,aS58ChEhG,EAAAiG,wBAAuB,GACnBjG,EAAAkG,oBAAO,EAAiBjP,IAAjBwJ,OAA+B1I,EAAQ,IAGlD,IAAAoO,GAASC,eAAoBza,ETs9CzB,OSr9CAqU,GAAAqG,WAAarG,GACbA,EAAGwF,WAAH,EAAgBrE,KAChBnB,EAAG0F,cAAcvE,WAAjBmF,GACAtG,EAAAuG,WAAQC,WAAmBrF,GACvBnB,EAAAgC,WAAM,QAAAhC,EAAAQ,KAAuBiG,gBAAiBtF,GTi9C9B,MAAbgF,EAAM,IAA2B,MAAbA,EAAM,ISh6CzBnG,GAAA,CACI,GAAA6D,GAAAkB,sBAAA9a,UAAAqW,aACIN,EAAc0G,sBAAczH,UAA5BwF,sBACAM,uBAAA9a,UAAAqW,eACJyE,sBAAA9a,UAAAwa,6BAIIzE,oBACA,GAAApT,GAAA6D,SAAAE,cAAA,SACJ,KACIqP,eAAG2G,sBAAyB1H,oBAA5B,EAAA2H,uBAAA,IACA,MAAAxZ,GACJ4S,EAAA,KAEI,IAAAA,EACJ,0CAsBX,OApBepT,GAAAkT,GACJE,KACI6G,eAAA,EApBRlY,QAAA,KAsBHgS,aAAM,KACHX,cAAG8G,MAIVla,EAAA+B,QAAAoT,EAAApT,GACD/B,EAAA8B,KAAAqT,EAAArT,GACA9B,EAAAgC,OAAAmT,EAAAnT,GACHhC,EAtCD2U,QAAAQ,EAAAR,GTo/CA3U,EAAO8U,SAAWK,EAAKL,GS58CvB9U,EAAA+U,cAAAI,EAAAJ,GAGI/U,EAAAwH,gCAA2B2N,EAAA3N,GACvBxH,EAAA6H,SAAKsS,EAAS7c,GAEjB0C,ETi9CT,IAAIkU,GAAS,WS58CTA,QAAO7W,GAAU+W,GACb,wBAAI9Q,OAAJjG,UAAAgN,SAAAhO,KAAA8O,GAGAxL,WAAOA,GACPya,MAAuCC,mBAAvCD,OAAQA,UAAU9W,SAAa8W,QAG3BhH,WAAA5O,EAAqB8V,GACxB,GAAA/F,GAAAnB,EAAAoF,aAAAhU,EAGD,IAFA4O,EAAG6F,aAAW7F,EAAG8F,GACjB9F,EAAG+F,cAAcD,IACb9F,EAAGmH,mBAAkBhG,EAAMnB,EAAAoH,gBAC3BpH,KAAGmH,kBAAoBD,mBAAvB/F,EAEAnB,OAAG+F,GA+BX,QAAAjF,GAAA6C,EAAAC,GAUA,GTo8CIlb,KAAK2e,gBAAkB,KS58C3B5E,KAAOI,kBAAoB,KACvBna,KAAAwb,QAAcnG,EAAdoH,gBADJxB,KAAA2D,EAGA1D,KAA4BF,EACxBE,EAAanB,yBAAbmB,EACA5D,EAAA2F,aAAalD,KAAAyB,QAAbkC,EAAApG,EAAAqF,cAAA1B,IACH3D,EAAA2F,aAAAjd,KAAAwb,QAAAkC,EAAApG,EAAAuF,gBAAA3B,IT88CG5D,EAAG8D,YAAYpb,KAAKwb,US58CxBlE,EAAYgE,oBAAZtb,KAAAwb,QAAAlE,EAAAiE,aACQ,KAAR,eAAAjE,EAAAuH,kBAAA7e,KAAAwb,SAvCQ,GAAAoD,GAAKD,8MAgBTrH,EAAsBwH,8IA4HtBxH,OAjGAc,GAAA7W,UAAAgW,QAAA,WACAD,EAAAyH,cAAiB1e,KAARmb,SACTxb,KAAIya,QAAO,MAGXrC,EAAA7W,UAAaoX,SAAA,SAAbA,GT88CArB,EAAGqG,WAAW3d,KAAKwb,QS58CnB,KAAId,QACC/B,GT68CD,GAAKA,EAASnX,eAAeb,GAA7B,CS18CJ,GAAAqd,GAAmBtD,qBAAmB1a,KAAOK,QAAUoB,EAC1D,WAAAuc,EAAA,CT48CO,GAAIxX,GAAQmS,EAAShY,ES18CrBQ,IAAI6d,EAAZxY,GT48CY,OAAQA,EAAMzB,QS18C1B,OACoB1E,aAAa2d,EAAA,GAAAzH,cAAA/P,GAChB,MAChB,QACJ8Q,EAAA2H,WAAAjB,EAAA,GAAAzH,cAAA/P,GACkBjF,MACCwD,QAChBuS,EAAA4H,WAAAlB,EAAA,GAAAzH,cAAA/P,GACA,MT48CgB,KAAK,GS18CrB8Q,EAAA2G,WAAAD,EAAA,GAAAzH,cAAA/P,GACA,MACA,QACA8Q,EAAA6H,iBAAAnB,GAAA,KAAAzH,cAAA/P,GACA,MACA,SACA8Q,EAAsB8H,iBAAApB,GAAA,KAAAzH,cAAA/P,GACH6Y,MT48CH,SS18CR,KAAgB,qCAAA1e,EAAA,eAAA6F,EAAAzB,WAEb,KAAAua,EAAA9Y,GAGV,kCAAA7F,EAAA,uBAAA6F,GAAA,aAAA+H,UAFO8Q,GAAAjB,UAAAJ,EAAAxX,KAMJ6O,MAAKkK,OAvBbnH,EAAA7W,UAAA8c,SAAA,SAAAA,GTu+CQ/G,EAAGqG,WAAW3d,KAAKwb,QSz8CvBhE,QAAW7W,KAAA0d,GACH5G,EAAcjW,eAASmG,IACvB1B,YAAUqR,EAAIE,mBAAJxX,KAA8B2X,WAA5C0G,EAAA1d,GADJ,OAAAX,OAOIoY,EAAA7W,UAAA+W,SAAA,SAAAzU,EAAAC,EAAAwa,EAAAkB,GACA,GACAjB,GAAa7b,EAAb+c,aAAAnI,EAAAoI,SACA5b,OAFA0D,KAEK5E,GAALkB,EAAAya,EAAA,IAAAA,EAAA,KACA1a,MAHA2D,KAGK4S,GAALvW,EAAA0a,EAAA,IAAAA,EAAA,KACAD,MAJA9W,KAIKkB,GAAL4V,EAAAC,EAAA,IAAAA,EAAA,KT28CAiB,MS/8CAhY,KT+8CSgY,GAAwBA,EAASjB,EAAS,IAAMA,EAAS,GAAK,ESz8CrDhE,MAAfD,iBACAqB,eAAiBpB,kBAEpBjD,EAAGqE,aAAcrE,aAAjBA,EAAgCA,cAChCA,EAAGqE,aAAcrE,aAAjB,GAAmC2E,eAAnCpY,EAAsDmY,MAAtDsC,EAAAxa,EAAAwa,EAAAkB,IAAAlI,EAAAqI,aACwBnF,MAApB9X,mBACP4U,EAAAmH,eAAAnH,EAAAkH,eT28COlH,EAAG6F,WAAW7F,EAAG8F,aAAc9F,EAAGmH,gBSz8ClCld,aAAU8V,eAAiB,GAAAd,eAAkB,kBAAAe,EAAAqI,cAEnC,MAAd3f,KAAK4C,kBACF0X,qBAAeC,EAAYqF,kBAA9B5f,KAAAwb,QAAA,UACGhB,0BAAHxa,KAAgC2e,kBT48CF,MAA1B3e,KAAK6f,oBSz8CLte,uBAAR+V,EAAkCsI,kBAAgBhd,KAAQgG,QAAM,aAC5D0O,EAAK5U,wBAAL1C,KAAA6f,oBAEAvI,EAAAqG,WAAcrG,KAAGQ,SACjBR,EAAA6F,WAAY7F,EAAGK,aAAfL,EAAAwI,cACAxI,EAAGgD,oBAAeC,KAAlBoE,gBAAA,EAAArH,EAAAS,OAAA,OACAT,EAAGkD,WAAWlD,EAAGiD,aAAjBjD,EAAgCA,gBANpCA,EAAAkG,oBAAAxd,KAAA6f,kBAAA,EAAAvI,EAAAS,OAAA,OTk9CIT,EAAGuG,WAAWvG,EAAGyI,eAAgB,EAAG,ISv8CpC3H,EAAAC,iBAAA,WT48CA,MS98CJf,GAAAwH,cAAAxH,EAAAwH,eAAA,GAAA1G,GT88CWd,EAAGwH,eSv8CPxE,IA0CH0F,GAAAze,UAAA0e,YAAA,SAAAV,GAWArb,IAVAoT,MAAGsD,eAdPyE,EAAA,ET09CIa,EAAM/e,EAAI,ESl8CV+C,EAAOtB,EAAP,GAAgBqD,CAChB,GAAIxF,GAAIyD,KAAO8F,CAEfhK,MAAA2a,GAAAwF,GAAAZ,EACHW,EAAAC,EAEO5e,IAIJ+V,MAAGgD,WAAeC,WAClBjD,GAAGkD,QAAH0F,GAAiB3F,KACjBlF,GAAAkK,EAAOvf,KAAP2a,GAAA0E,IAAAlG,CAGJ3B,UAAQjW,QAAU6e,GAAlB/K,EAA4BrV,KAAAia,GAASoG,KAAO/K,SAAAtV,KAAAqa,GAAAgF,IAAAhK,SAAArV,KAAAqa,GAAA6F,KAAA/G,KAAA,EAGxC,IAAA3B,GAAI8I,WAOH,QAAA9I,GAAA9U,EAAAE,EAAAwX,EAAA1R,GACDjI,KAAE+V,KACF6J,QAAA/I,EAAYpT,gBAZhBlE,KAAA0C,QTw9CI1C,KAAK4C,OAASA,ESz8ClB4U,KAAQjW,OAAUwX,EACd/Y,KAAIugB,KAAJ7X,EAEA8X,cAAWlJ,EAAXiD,WAAAva,KAAA0H,IACA4P,EAAAqE,cAAArE,EAAAiD,WAAAjD,EAAAsE,mBAAAtE,EAAAgF,QACAiE,gBAAa7d,EAAb6X,WAAAjD,EAAAwE,mBAAAxE,EAAAgF,QACAkE,gBAAclJ,EAAK5U,WAAnB4U,EAAAiF,eAAAjF,EAAA0E,eACA1E,EAAAqE,cAAArE,EAAAiD,WAAAjD,EAAA2E,eAAA3E,EAAA0E,eACAuE,GAAa3d,GAAb0U,EAAAkD,WAAAlD,EAAAiD,WAAA,EAAAva,KAAAoa,OAAA1X,EAAAE,EAAA,EAAA5C,KAAAoa,OAAApa,KAAA0I,KAAA,MTohDJ,QAAS+X,GAAUxa,GACD,MAAV/B,IUh1EAwc,EAAgB3Y,SAAAE,cAAA,WAExB0Y,EAAW7N,QAAgBpQ,MAC3Bke,EAASC,OAAIC,EAAJle,MVk1EL,IAAInC,GAAIyD,EAAO8F,WAAW,KU/0E1B2W,OADAA,aAAR,IAAAzc,EAAAxB,MAAAwB,EAAAtB,QACaA,EDkyBL4U,EAAIuJ,YAAa3H,SAAWkH,GAC5B,GAAI7f,GAAIggB,GAAUjJ,GAAlB,IAAAF,EAAAQ,KAAAR,EAAAK,cAEAL,OADArR,GAAI2C,eAASkY,GACVxH,GAmBHiH,YAAanG,eAAb,SAAAzS,GACA6Y,WAAA7Y,EAAoByS,OAApBzS,EAAAqZ,WACAhhB,KAAKoa,OAASmG,EAAd3d,QAAA+E,EAAAsZ,YAbJ3J,EAAAgD,YAAAhD,EAAAiD,WAAAva,KAAA0H,ITy9CI4P,EAAGkD,WAAWlD,EAAGiD,WAAY,EAAGva,KAAKoa,OAAQpa,KAAKoa,OAAQpa,KAAK0I,KAAMf,IAGzE6P,EAAQjW,UAAU2f,cAAgB,SAAUxe,EAAOE,EAAQgG,GSz8C/D5I,KAAA0C,QACIiX,cT28CI3Z,KAAKoa,OAAS9C,EAAGQ,KACjB9X,KAAK0I,KAAO4O,EAAGK,cACfL,EAAGgD,YAAYhD,EAAGiD,WAAYva,KAAK0H,IACnC4P,EAAGkD,WAAWlD,EAAGiD,WAAY,EAAGjD,EAAGQ,KAAMpV,EAAOE,EAAQ,EAAG0U,EAAGQ,KAAM9X,KAAK0I,KAAM,GAAI0Q,YAAWxQ,KSv8CtG4O,EAAO7X,UAAP4X,QAAA,WT28CQD,EAAG6J,cAAcnhB,KAAK0H,IACtB1H,KAAK0H,GAAK,MAGd8P,EAAQjW,UAAUgX,IAAM,SAAU6I,GAC9B9J,EAAG0C,cAAc1C,EAAG+J,UAAYD,GAAQ,IACxC9J,EAAGgD,YAAYhD,EAAGiD,WAAYva,KAAK0H,KAGvC8P,EAAQjW,UAAU+f,MAAQ,SAAUF,GAChC9J,EAAG0C,cAAc1C,EAAG+J,UAAYD,GAAQ,IACxC9J,EAAGgD,YAAYhD,EAAGiD,WAAY,OUx0E7BgH,EAAQhgB,UAAAigB,aAAA,SAAA9e,EAAAE,EAAAwX,EAAA1R,GACT+Y,GAAkC,GAAlCA,UAAkC1c,OAAA,CV60E9B,GAAIkB,GAAUsB,UAAU,EU50E3Bka,GAAQxb,EAAAvD,MV80ELE,EAASqD,EAAQrD,OU50EnB8e,IAAqBtH,OACrBuH,EAAN1b,EAAAyC,KAGyBhG,GAAA1C,KAAA0C,OAAAE,GAAA5C,KAAA4C,QAAAwX,GAAApa,KAAAoa,QAAA1R,GAAA1I,KAAA0I,OACVxB,KADUxE,QACL8D,KADK5D,SVi1EjB5C,KAAKoa,OAASA,EU/0EVlT,KAAKya,KAAMza,EAHvBoQ,EAAAgD,YAAAhD,EAAAiD,WAAAva,KAAA0H,IVq1EQ4P,EAAGkD,WAAWlD,EAAGiD,WAAY,EAAGva,KAAKoa,OAAQ1X,EAAOE,EAAQ,EAAG5C,KAAKoa,OAAQpa,KAAK0I,KAAM,QU70EjE8O,EAAfoK,UAAe5J,OAAA,SAAA6J,GVs1E1B,GUr1EEH,cAAc5gB,eACfgN,EAAI2N,oBAAAnE,EAAAsD,gBAAiBzM,gBAAmBwT,aACxC3T,EAFekO,qBAApB5E,EAAAuD,YAAAvD,EAAA6E,kBAAA7E,EAAAiD,WAAAva,KAAA0H,GAAA,GVq1EQ4P,EAAGwK,uBAAuBxK,EAAGuD,eAAiBvD,EAAGyK,qBUj1ElDL,gBAAcE,yBApBtBtK,GAAAiH,SAAA,IAAAve,KAAA0C,MAAA1C,KAAA4C,QAyBEof,IAIT1K,EAAAsD,gBAAAtD,EAAAuD,YAAA,MVo1EQ,IAAI3W,GAAS,IAqDb,OAxCAsT,GAAQjW,UAAU0gB,gBAAkB,SAAUJ,GU30EjD,MALGA,GAAapB,EAAU1R,OACnB/O,KAAIkiB,OAAQC,OVk1EZniB,KAAK0I,KAAO4O,EAAGK,cUh1EfyK,cAAcxN,EAAI2F,WAAU2H,KAA5Bxa,IACH4P,EAAAkD,WAAAlD,EAAAiD,WAAA,EAAAjD,EAAAQ,KAAAR,EAAAQ,KAAAR,EAAAK,cAAAzT,GACJlE,MAGJwX,EAAAjW,UAAA6e,QAAA,SAAAC,GVk1EWrgB,KAAKuY,MUh1ED8J,qBAAT/J,UACCgK,IAAMhC,GAAAtgB,KAAc0C,MAAA1C,KAAY4C,OAAA,EAC5B2f,EAAQhb,GAAZ6R,YAAAkH,GACIkC,EAAQD,EAAMxd,MVk1EV6D,EAAOnI,EAAEqgB,gBAAgB9gB,KAAK0C,MAAO1C,KAAK4C,OUh1ElD0U,GAAAgC,WAAA,IAAAtZ,KAAA0C,MAAA1C,KAAA4C,OAAA0U,EAAAQ,KAAAR,EAAAK,cAAAoJ,EACIyB,QAASniB,GAAG,EAAAA,EAAAigB,EAAAjgB,IACZuI,EAAO0Z,KAAGG,GAAMnc,EAAhBjG,EVm1EAI,GAAE+V,aAAa5N,EAAM,EAAG,GUh1E5ByX,EAAA5W,IAAAvF,EAAAsF,aAGQgO,EAAAjW,UAAUkhB,SAAMnc,SAATka,GACV,GAFDD,EAGIA,GAAAC,EAAO8B,GACV9B,EAAA9Y,GAAA1H,KAAA0H,GACJ1H,KAAA0H,GAAA6Y,EVk1EGA,EAAOC,EAAM9d,MUh1EjB8d,EAAA9d,MAAA1C,KAAA0C,MACI8f,WAAYjC,EACZA,EAAO+B,EAAGG,OACbjC,EAAA5d,OAAA5C,KAAA4C,OACJ5C,KAAA4C,OAAA2d,EACJA,EAAAC,EAAApG,OVk1EWoG,EAAMpG,OAASpa,KAAKoa,OUh1EhCpa,KAAAoa,OAAAmG,GVo1Ee/I,KU70EXmC,EAAA,oNAUsB,OAAtBha,OAOI,SAAM+iB,EAAUC,EAAhBziB,GAEA,YA+CJ,SAAI0U,GAAQlS,GAQZwf,OAPI/I,GAAI9J,EAAIzM,WADZ,MAEIlC,EAAI2O,EAAIzG,aAFZ,IAAAga,EAAAlgB,MAAAkgB,EAAAhgB,QVu1EIge,EAASC,EAAIC,gBAAgB8B,EAAGlgB,MAAOkgB,EAAGhgB,QAE1CgS,EAAI+L,EAAKje,MUn1Ebwf,EAAAvB,EAAa/d,OAEbvC,EAAa,EAAAA,EAAKwiB,EAAAxiB,IVs1Ed,IAAK,GAAI0O,GAAI,EAAGA,EAAIoK,EAAGpK,IAAK,CUn1EzBmT,GAAPA,GAAAC,EAAAxB,EAAAtgB,EAAA0O,EVs1EQqT,GAAMxB,EAAQhM,EAAI,EAAIvU,EAAG0O,EAAGmT,GAIpCrB,EAAIrK,aAAaoK,EAAQ,EAAG,GAGhC,QAASyB,GAAYC,EAAIQ,EAASpJ,GAC9B,GAAI4I,GAAoB,kBAAPA,GAAmB,CUl1ExC,GAASF,GAAW7C,UACRlQ,EAAI3M,EAAZqC,MVs1EI,IAAa,GAATyd,EUl1EDK,MAAQtD,GAAfkD,MAAqBP,OVu1EjB,IAAa,GAATM,EACA,MAAIO,OAAM/D,QAAQ8D,GACPR,EAAGG,MAAMnc,OAAQwc,GAEjBR,EAAGG,MAAMK,EAKxB,IAAa,GAATN,EACA,MAAOF,GAAGG,MAAMK,GAAWxc,OAAQoT,IAU/C,QAASsJ,GAAqBC,EAASva,GAQnC,IAAK,GALDwa,GAAQ5c,OAAO6c,KAAKF,EAAQ7W,MAAM,KAAK,IAGvCgX,EAAK,GAAIC,aAAYH,EAAMne,QAC3Bue,EAAK,GAAIlK,YAAWgK,GACf/iB,EAAI,EAAGA,EAAI6iB,EAAMne,OAAQ1E,IAC9BijB,EAAGjjB,GAAK6iB,EAAMK,WAAWljB,EAG7B,OAAO,IAAImjB,OAAMJ,IACb1a,KAAMA,IAId,QAASsZ,GAAYyB,GACjB,MAAO,UAAUnc,GACb,GAAIob,GAAM,GAAIC,gBAEV/a,EAAMN,EAAQM,IACdgB,EAAOtB,EAAQsB,KACf8a,EAAO,IAEI,SAAXD,GAAoB7a,IACpBhB,GAAO2Z,EAAMlT,UAAUzF,GAA2B,GAArBhB,EAAIhC,QAAQ,KAAa,IAAM,KAGhE,IAAInE,GAAI,GAAIwH,SAAQ,SAAUC,EAASC,GACnCuZ,EAAIiB,iBAAiB,OAAQ,WACzB,GACIC,IADclB,EAAImB,kBAAkB,gBACV,QAApBnB,EAAIoB,cAA8C,IAApBpB,EAAIoB,aAAqBpB,EAAIqB,SAAWrB,EAAIsB,aAEpF9a,GAAQ0a,KAGZlB,EAAIiB,iBAAiB,QAAS,SAAUxd,GACpC,MAAOgD,GAAOhD,MAkBtB,OAdAuc,GAAIuB,KAAKR,EAAQ7b,GAAK,GAEP,QAAX6b,IACI7a,GAAQA,EAAKmE,OACb2W,EAAO9a,GAEP8a,EAAOtV,KAAKC,UAAUzF,GACtB8Z,EAAIwB,iBAAiB,eAAgB,sBAIzC5c,EAAQoB,OAAMga,EAAIoB,aAAexc,EAAQoB,MAE7Cga,EAAIyB,KAAKT,GACFjiB,GAYf,QAAS0gB,GAAM9S,EAAKkQ,EAAGsD,GAGnB,GAAIjO,GAAIvF,EAAI3M,MAERhC,GADI2O,EAAIzM,OACJyM,EAAIzG,MAERsZ,IAOJ,OALAA,GAAM,GAAKxhB,EAAE,GAAKmiB,EAAIjO,EAAI2K,IAC1B2C,EAAM,GAAKxhB,EAAE,GAAKmiB,EAAIjO,EAAI2K,GAAK,GAC/B2C,EAAM,GAAKxhB,EAAE,GAAKmiB,EAAIjO,EAAI2K,GAAK,GAC/B2C,EAAM,GAAKxhB,EAAE,GAAKmiB,EAAIjO,EAAI2K,GAAK,GAExB2C,EAWX,QAASE,GAAM/S,EAAKkQ,EAAGsD,EAAGX,GACtB,GAAItN,GAAIvF,EAAI3M,MAERhC,GADI2O,EAAIzM,OACJyM,EAAIzG,KAEZlI,GAAE,GAAKmiB,EAAIjO,EAAI2K,IAAM2C,EAAM,GAC3BxhB,EAAE,GAAKmiB,EAAIjO,EAAI2K,GAAK,GAAK2C,EAAM,GAC/BxhB,EAAE,GAAKmiB,EAAIjO,EAAI2K,GAAK,GAAK2C,EAAM,GAC/BxhB,EAAE,GAAKmiB,EAAIjO,EAAI2K,GAAK,GAAK2C,EAAM,GU3hF3BhiB,EAAAQ,EAAAiB,EAAA,qBAAAyiB,KVo1EyBziB,EAAuB,EAAI+e,EUh1E5B9X,EAAM,EAAAyZ,EACbhU,EAAgB,EAAA2U,CAChC,IAAAqB,GAAA,mBAAAC,GAAAC,EAAAlkB,GAAA,GAAAmkB,MAAAC,GAAA,EAAAC,GAAA,EAAAC,MAAAnd,EAAA,YAAAod,GAAAC,EAAAN,EAAA7N,OAAAC,cAAA8N,GAAAG,EAAAC,EAAAC,QAAAC,QAAAP,EAAApX,KAAAwX,EAAApe,QAAAnG,GAAAmkB,EAAAzf,SAAA1E,GAAAokB,GAAA,UAAAO,GAAAN,GAAA,EAAAC,EAAAK,EAAA,aAAAP,GAAAI,EAAA,QAAAA,EAAA,oBAAAH,EAAA,KAAAC,IAAA,MAAAH,GAAA,gBAAAD,EAAAlkB,GAAA,GAAA0iB,MAAA/D,QAAAuF,GAAA,MAAAA,EAAA,IAAA7N,OAAAC,WAAA7V,QAAAyjB,GAAA,MAAAD,GAAAC,EAAAlkB,EAAA,UAAA0B,WAAA,4DAEDwf,GACImB,iBACI,GAAAjB,GAAMwD,iBAAkBpB,OAAkBrc,KAAlBqc,UAAJ,GAApBtc,UAAA,GAAAjB,OAAA0X,SAAAyD,MVm1ER,KAAKA,EAAQ,QU/0ER,IAAAC,GALD,MAAAD,EAAA,GAAAA,EAAAyD,UAAA,GAAAzD,EVu1EAE,IUx0EC,OAR6BD,GAAAtV,MAASjD,KAAOhD,QAAhB,SAAAgf,GAAA,GAA9BC,GAAAD,EAAA/Y,MAAA,KARJiZ,EAAAhB,EAAAe,EAAA,GV61EQle,EAAMme,EAAiB,GUl1E/B7e,EAAA6e,EAAA,EAEI5B,OAAWvc,GAAOV,KAClBmb,GAIIe,mBAAIwB,GACP,GAAAtC,GAAAra,UAAAxC,OAAA,OAAAyC,KAAAD,UAAA,GAAAA,UAAA,OVq1EDma,EAAc5gB,OAAOwkB,KAAK3D,GAAO7T,IAAI,SAAU5G,GUl1E/CI,SAAJ,IAAsBwc,mBAAexc,EAAQoB,IAA3B,MVo1EfsF,KAAK,IUj1ER,OAAOvM,GAAPmgB,EAAAF,EAAA,KAIR0C,GVo1EIljB,IAAK8gB,EAAY,OACjBhV,KAAMgV,EAAY","file":"pic-tune.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"picTune\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"picTune\"] = factory();\n\telse\n\t\troot[\"picTune\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"picTune\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"picTune\"] = factory();\n\telse\n\t\troot[\"picTune\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__main_css__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__main_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__main_css__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__scale_js__ = __webpack_require__(6);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__glfx_js__ = __webpack_require__(7);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__utils__ = __webpack_require__(8);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\n\n\n// 裁剪框的一对边框所占像素\nvar BORDER_PIX = 4;\n\n/**\r\n * 绑定事件\r\n * @param  {Object} editorObj 编辑器对象 \r\n * @return 无\r\n */\nfunction bindEvents(editorObj) {\n    var wrapper = editorObj.wrapper;\n    var source = editorObj.source;\n    var picture = editorObj.picture;\n    var showImage = editorObj.showImage;\n    var canvas = editorObj.canvas;\n    var crop = editorObj.crop;\n\n    var isMove = false,\n        isResize = false,\n        maxPos = {\n        left: 0,\n        top: 0,\n        width: 0,\n        height: 0\n    },\n        curPoint = \"\",\n        moveTimer = 0;\n\n    var movePoints = crop.getElementsByTagName('div');\n    var pointDirection = ['lt', 'rt', 'lb', 'rb'];\n\n    crop.onmousedown = function (e) {\n        var toElement = e.toElement;\n\n        maxPos.left = source.clientWidth - crop.offsetWidth;\n        maxPos.top = source.clientHeight - crop.offsetHeight;\n        maxPos.width = source.clientWidth, maxPos.height = source.clientHeight;\n        isMove = true;\n\n        for (var i = 0, len = movePoints.length; i < len; ++i) {\n            if (movePoints[i] === toElement) {\n                curPoint = pointDirection[i];\n                isMove = false;\n                isResize = true;\n                break;\n            }\n        }\n\n        clearTimeout(moveTimer);\n        moveTimer = setTimeout(moveEnd, 1000);\n    };\n\n    wrapper.onmousemove = function (e) {\n        var cropStyle = crop.style,\n            movementX = e.movementX,\n            movementY = e.movementY,\n            offsetLeft = crop.offsetLeft,\n            offsetTop = crop.offsetTop,\n            newLeft = void 0,\n            newTop = void 0,\n            newWidth = void 0,\n            newHeight = void 0;\n\n        var cropRate = editorObj.cropRate;\n\n        if (isMove) {\n            // 移动\n            newLeft = offsetLeft + movementX;\n            newTop = offsetTop + movementY;\n\n            newLeft = newLeft < 0 ? 0 : newLeft > maxPos.left ? maxPos.left : newLeft;\n            newTop = newTop < 0 ? 0 : newTop > maxPos.top ? maxPos.top : newTop;\n\n            if (newLeft != offsetLeft) cropStyle.left = newLeft + \"px\";\n            if (newTop != offsetTop) cropStyle.top = newTop + \"px\";\n\n            Object(__WEBPACK_IMPORTED_MODULE_3__utils__[\"c\" /* runFunction */])(editorObj.onMovingCrop, editorObj, []);\n        } else if (isResize) {\n            // 修改尺寸\n            var offsetWidth = crop.offsetWidth,\n                offsetHeight = crop.offsetHeight;\n\n            if (cropRate) {\n                var sign = curPoint == 'lt' || curPoint == \"rb\" ? 1 : -1;\n\n                if (cropRate > 1) {\n                    movementX = sign * movementY * cropRate;\n                } else {\n                    movementY = sign * movementX / cropRate;\n                }\n            }\n\n            // 判断左右\n            if (curPoint.indexOf(\"l\") != -1) {\n                newLeft = offsetLeft + movementX;\n                newWidth = offsetWidth - movementX;\n\n                if (newLeft < 0) {\n                    newWidth = newWidth + newLeft;\n                    newLeft = 0;\n\n                    if (cropRate) {\n                        newHeight = (newWidth - BORDER_PIX) / cropRate + BORDER_PIX;\n                    }\n                }\n            } else {\n                newWidth = offsetWidth + movementX;\n\n                if (newWidth + offsetLeft > maxPos.width) {\n                    newWidth = maxPos.width - offsetLeft;\n\n                    if (cropRate) {\n                        newHeight = (newWidth - BORDER_PIX) / cropRate + BORDER_PIX;\n                    }\n                }\n            }\n\n            // 判断上下\n            if (curPoint.indexOf(\"t\") != -1 && !newHeight) {\n                newTop = offsetTop + movementY;\n                newHeight = offsetHeight - movementY;\n\n                if (newTop < 0) {\n                    newHeight = newHeight + newTop;\n                    newTop = 0;\n\n                    if (cropRate) {\n                        newWidth = (newHeight - BORDER_PIX) * cropRate + BORDER_PIX;\n                    }\n                }\n            } else if (!newHeight) {\n                newHeight = offsetHeight + movementY;\n\n                if (newHeight + offsetTop > maxPos.height) {\n                    newHeight = maxPos.height - offsetTop;\n\n                    if (cropRate) {\n                        newWidth = (newHeight - BORDER_PIX) * cropRate + BORDER_PIX;\n                    }\n                }\n            }\n\n            if (isNaN(newLeft)) newLeft = offsetLeft;\n            if (isNaN(newTop)) newTop = offsetTop;\n\n            if (cropRate) {\n                if (newLeft + newWidth < maxPos.width) {\n                    newHeight = (newWidth - BORDER_PIX) / cropRate + BORDER_PIX;\n                } else if (newTop + newHeight < maxPos.height) {\n                    newWidth = (newHeight - BORDER_PIX) * cropRate + BORDER_PIX;\n                }\n            }\n\n            if (newLeft != offsetLeft) cropStyle.left = newLeft + \"px\";\n            if (newTop != offsetTop) cropStyle.top = newTop + \"px\";\n            if (newWidth != offsetWidth) cropStyle.width = newWidth + \"px\";\n            if (newHeight != offsetHeight) cropStyle.height = newHeight + \"px\";\n\n            Object(__WEBPACK_IMPORTED_MODULE_3__utils__[\"c\" /* runFunction */])(editorObj.onMovingCrop, editorObj, []);\n        }\n\n        clearTimeout(moveTimer);\n        moveTimer = setTimeout(moveEnd, 1000);\n    };\n\n    wrapper.onmouseup = moveEnd;\n\n    function moveEnd() {\n        isMove = false;\n        isResize = false;\n\n        clearTimeout(moveTimer);\n    }\n\n    picture.onload = function (e) {\n        adjustSize();\n\n        crop.style.display = \"none\";\n\n        canvas.draw(canvas.texture(this)).update();\n    };\n\n    picture.error = function (e) {\n        console.log(e);\n    };\n\n    window.onresize = function (e) {\n        adjustSize();\n    };\n\n    function adjustSize() {\n        var pWidth = picture.width,\n            pHeight = picture.height,\n            pRate = parseFloat((pWidth / pHeight).toFixed(2));\n\n        var sStyle = source.style,\n            cStyle = crop.style;\n\n        sStyle.width = pWidth + BORDER_PIX + \"px\";\n        sStyle.height = pHeight + BORDER_PIX + \"px\";\n\n        var sWidth = source.clientWidth - BORDER_PIX,\n            sHeight = source.clientHeight - BORDER_PIX,\n            sRate = parseFloat((sWidth / sHeight).toFixed(2));\n\n        // 如果外层宽高比例与图片不一致，则需要校正\n        if (pRate != sRate) {\n            if (sRate > pRate) {\n                sStyle.width = sHeight * pRate + BORDER_PIX + \"px\";\n            } else {\n                sStyle.height = sWidth / pRate + BORDER_PIX + \"px\";\n            }\n        }\n\n        if (cStyle.display == 'block') {\n            var cropRate = editorObj.cropRate;\n\n            cStyle.left = cStyle.top = 0;\n            cStyle.width = cStyle.height = \"100%\";\n\n            if (cropRate && pRate != cropRate) {\n                if (pRate > cropRate) {\n                    cStyle.width = crop.clientHeight * cropRate + BORDER_PIX + 'px';\n                } else {\n                    cStyle.height = crop.clientWidth / cropRate + BORDER_PIX + 'px';\n                }\n            }\n\n            Object(__WEBPACK_IMPORTED_MODULE_3__utils__[\"c\" /* runFunction */])(editorObj.onMovingCrop, editorObj, []);\n        }\n    }\n}\n\nvar PicTune = function () {\n    function PicTune() {\n        var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        _classCallCheck(this, PicTune);\n\n        Object.assign(this, {\n            id: '',\n            element: '',\n            width: '',\n            height: '400px',\n            url: '',\n            output: '',\n            file: {},\n            onMovingCrop: function onMovingCrop() {}\n        }, options);\n\n        var wrapper = this.element || document.getElementById(this.id);\n        var source = document.createElement('div');\n        var picture = document.createElement('img');\n        var showImage = document.createElement('img');\n        var canvas = __WEBPACK_IMPORTED_MODULE_2__glfx_js__[\"a\" /* fx */].canvas();\n        var crop = document.createElement('div');\n        var originImage = new Image();\n\n        this.wrapper = wrapper;\n        this.source = source;\n        this.picture = picture;\n        this.showImage = showImage;\n        this.canvas = canvas;\n        this.crop = crop;\n        this.originImage = originImage;\n\n        wrapper.className = 'image-editor-wrapper';\n\n        source.className = 'image-editor-source';\n\n        picture.className = 'image-editor-picture';\n\n        showImage.className = 'image-editor-show';\n        showImage.style.display = 'none';\n\n        canvas.className = 'image-editor-canvas';\n        canvas.innerText = '你的浏览器不支持HTML5.';\n\n        crop.style.display = \"none\";\n\n        crop.className = 'image-editor-crop';\n        crop.innerHTML = '<div class=\"editor-crop-left editor-crop-top\"></div>' + '<div class=\"editor-crop-right editor-crop-top\"></div>' + '<div class=\"editor-crop-left editor-crop-bottom\"></div>' + '<div class=\"editor-crop-right editor-crop-bottom\"></div>';\n\n        source.appendChild(picture);\n        source.appendChild(canvas);\n        source.appendChild(showImage);\n        source.appendChild(crop);\n\n        wrapper.appendChild(source);\n\n        if (this.width) wrapper.style.width = this.width;\n        if (this.height) {\n            wrapper.style.height = this.height;\n            wrapper.style['line-height'] = this.height;\n        }\n        if (options.url) this.loadAsUrl(options.url);\n\n        bindEvents(this);\n    }\n\n    /**\r\n     * 加载图片http路径\r\n     * @param  {String} url http路径字符串\r\n     * @return {Object}     Promise对象\r\n     */\n\n\n    _createClass(PicTune, [{\n        key: 'loadAsUrl',\n        value: function loadAsUrl(url) {\n            var _this = this;\n\n            return __WEBPACK_IMPORTED_MODULE_3__utils__[\"b\" /* http */].get({\n                url: url,\n                type: 'blob'\n            }).then(function (data) {\n                return _this.loadAsFile(data);\n            });\n        }\n\n        /**\r\n         * 加载图片数据\r\n         * @param  {Object} file 图片的blob数据\r\n         * @return {Object}      Promise对象\r\n         */\n\n    }, {\n        key: 'loadAsFile',\n        value: function loadAsFile(file) {\n            var _this2 = this;\n\n            var fr = new FileReader();\n            var p = new Promise(function (resolve, reject) {\n                fr.onload = function (e) {\n                    _this2.confirm(fr.result);\n                    _this2.file = file;\n\n                    _this2.showImage.style.display = file.type == \"image/gif\" ? 'block' : 'none';\n\n                    resolve();\n                };\n            });\n\n            fr.readAsDataURL(file);\n\n            return p;\n        }\n\n        /**\r\n         * 确认修改\r\n         * @param  {String} dataurl 图片数据路径\r\n         * @return 无\r\n         */\n\n    }, {\n        key: 'confirm',\n        value: function confirm(dataurl) {\n            dataurl = dataurl || this.canvas.toDataURL(this.output || this.file.type);\n\n            this.picture.src = dataurl;\n            this.originImage.src = dataurl;\n            this.showImage.src = dataurl;\n        }\n\n        /**\r\n         * 还原修改\r\n         * @return 无\r\n         */\n\n    }, {\n        key: 'reset',\n        value: function reset() {\n            this.picture.src = this.originImage.src;\n        }\n\n        /**\r\n         * 获取当前图片尺寸\r\n         * @return {Object} 尺寸数据\r\n         */\n\n    }, {\n        key: 'getSize',\n        value: function getSize() {\n            var canvas = this.canvas;\n\n            return {\n                width: canvas.width,\n                height: canvas.height\n            };\n        }\n\n        /**\r\n         * 切换裁切框的显示/隐藏\r\n         * @param  {Boolean} toggle 显示/隐藏\r\n         * @param  {Number}  rate   比例\r\n         * @return {Boolean}        显示/隐藏\r\n         */\n\n    }, {\n        key: 'toggleCrop',\n        value: function toggleCrop(toggle, rate) {\n            var crop = this.crop;\n            var cropRate = this.cropRate = parseFloat((rate || 0).toFixed(2));\n\n            var cStyle = crop.style,\n                isShow = cStyle.display == \"block\";\n\n            if (typeof toggle == \"undefined\") {\n                toggle = !isShow;\n            }\n\n            if (toggle) this.showImage.style.display = 'none';\n\n            cStyle.display = toggle ? \"block\" : \"none\";\n            cStyle.left = cStyle.top = 0;\n            cStyle.width = cStyle.height = \"100%\";\n\n            if (toggle && cropRate) {\n                var cWidth = crop.clientWidth,\n                    cHeight = crop.clientHeight,\n                    curRate = parseFloat((cWidth / cHeight).toFixed(2));\n\n                if (curRate != cropRate) {\n                    if (curRate > cropRate) {\n                        cStyle.width = cHeight * cropRate + BORDER_PIX + 'px';\n                    } else {\n                        cStyle.height = cWidth / cropRate + BORDER_PIX + 'px';\n                    }\n                }\n            }\n\n            return toggle;\n        }\n\n        /**\r\n         * 获取图片的2D canvas\r\n         * @param  {Number} left   左偏移\r\n         * @param  {Number} top    上偏移\r\n         * @param  {Number} width  宽度\r\n         * @param  {Number} height 高度\r\n         * @return {Object}        2D canvas对象\r\n         */\n\n    }, {\n        key: 'get2dCanvas',\n        value: function get2dCanvas() {\n            var left = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n            var top = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n            var width = arguments[2];\n            var height = arguments[3];\n\n            var c = document.createElement('canvas');\n            var picture = this.picture;\n\n            width = width || picture.width;\n            height = height || picture.height;\n\n            c.width = width;\n            c.height = height;\n\n            c.getContext('2d').drawImage(picture, left, top, width, height, 0, 0, width, height);\n\n            return c;\n        }\n        /**\r\n         * 裁切框当前位置\r\n         * @return {Object} 位置信息\r\n         */\n\n    }, {\n        key: 'getCropPosition',\n        value: function getCropPosition() {\n            var crop = this.crop;\n            var rate = this.picture.height / this.canvas.clientHeight;\n\n            if (crop.style.display == 'none') {\n                return {\n                    top: 0,\n                    left: 0,\n                    height: this.picture.height,\n                    width: this.picture.width\n                };\n            } else {\n                return {\n                    top: parseInt(crop.offsetTop * rate),\n                    left: parseInt(crop.offsetLeft * rate),\n                    height: parseInt((crop.offsetHeight - BORDER_PIX) * rate),\n                    width: parseInt((crop.offsetWidth - BORDER_PIX) * rate)\n                };\n            }\n        }\n        /**\r\n         * 确认裁切\r\n         */\n\n    }, {\n        key: 'setCrop',\n        value: function setCrop() {\n            var postion = this.getCropPosition();\n\n            this.confirm(this.get2dCanvas(postion.left, postion.top, postion.width, postion.height).toDataURL(this.output || this.file.type));\n        }\n        /**\r\n         * 旋转\r\n         * @param  {Number}  angle      旋转的角度\r\n         * @param  {Boolean} isTurnOver 旋转以后是否水平翻转\r\n         */\n\n    }, {\n        key: 'rotate',\n        value: function rotate(angle, isTurnOver) {\n            var picture = this.picture;\n\n            this.showImage.style.display = 'none';\n\n            var c = this.get2dCanvas(),\n                c2 = c.getContext('2d'),\n                pW = picture.width,\n                pH = picture.height,\n                cX = 0,\n                cY = 0,\n                type = void 0;\n\n            angle = angle % 360 + (angle < 0 ? 360 : 0);\n\n            if (angle > 0) {\n                var A = angle * Math.PI / 180,\n                    sinA = Math.abs(Math.sin(A).toFixed(2)),\n                    cosA = Math.abs(Math.cos(A).toFixed(2));\n\n                c.width = pH * sinA + pW * cosA;\n                c.height = pH * cosA + pW * sinA;\n\n                if (angle <= 90) {\n                    cX = pH * sinA * cosA;\n                    cY = -(pH * sinA * sinA);\n                } else if (angle > 90 && angle <= 180) {\n                    cX = -(pW * cosA * cosA);\n                    cY = -(pW * cosA * sinA + pH);\n                } else if (angle > 180 && angle <= 270) {\n                    cX = -(pH * cosA * sinA + pW);\n                    cY = -(pH * cosA * cosA);\n                } else {\n                    cX = -(pW * sinA * sinA);\n                    cY = -(pW * sinA * cosA);\n                }\n\n                c2.rotate(A);\n            }\n\n            c2.drawImage(picture, cX, cY);\n\n            if (isTurnOver) Object(__WEBPACK_IMPORTED_MODULE_3__utils__[\"d\" /* turnOver */])(c, isTurnOver);\n\n            this.picture.src = c.toDataURL(this.output || this.file.type);\n            // this.confirm(c.toDataURL(this.output || this.file.type));\n        }\n        /**\r\n         * 基础参数调节\r\n         * @param  {Number} brightness 亮度 -1~1\r\n         * @param  {Number} contrast   对比度 -1~1\r\n         * @param  {Number} saturation 色彩饱和度 -1~1\r\n         * @param  {Number} radius     清晰度 -10~10\r\n         */\n\n    }, {\n        key: 'base',\n        value: function base() {\n            var brightness = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n            var contrast = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n            var saturation = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n            var radius = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n            var canvas = this.canvas;\n\n            this.showImage.style.display = 'none';\n\n            canvas.draw(canvas.texture(this.originImage)).brightnesscontrastSaturationBur([brightness, contrast, saturation, radius]).update();\n        }\n        /**\r\n         * 色彩调节\r\n         * @param  {Number} hue         色相\r\n         * @param  {Number} greenRed    绿红\r\n         * @param  {Number} purpleGreen 紫绿\r\n         * @param  {Number} yellowBlue  黄蓝\r\n         */\n\n    }, {\n        key: 'huaColor',\n        value: function huaColor() {\n            var hue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n            var greenRed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n            var purpleGreen = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n            var yellowBlue = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n            var canvas = this.canvas;\n\n            this.showImage.style.display = 'none';\n\n            canvas.draw(canvas.texture(this.originImage)).hueColor([hue, greenRed, purpleGreen, yellowBlue]).update();\n        }\n        /**\r\n         * 输出图像\r\n         * @param  {Number}  width  宽度\r\n         * @param  {Number}  height 高度\r\n         * @param  {Boolean} isBlob 是否转为二进制数据\r\n         * @return {Object}         图像数据\r\n         */\n\n    }, {\n        key: 'getData',\n        value: function getData(width, height, isBlob) {\n            var picture = this.picture;\n            var postion = this.getCropPosition();\n\n            var type = this.output || this.file.type,\n                c = this.get2dCanvas(postion.left, postion.top, postion.width, postion.height),\n                data = null;\n\n            width = width || picture.width;\n            height = height || picture.height;\n\n            if (width != postion.width || height != postion.height) {\n                data = Object(__WEBPACK_IMPORTED_MODULE_1__scale_js__[\"a\" /* scale */])({\n                    width: parseInt(width),\n                    height: parseInt(height)\n                }, c).toDataURL(type);\n            } else {\n                data = c.toDataURL(type);\n            }\n\n            if (isBlob) data = Object(__WEBPACK_IMPORTED_MODULE_3__utils__[\"a\" /* convertDataurlToBlob */])(data, type);\n\n            return data;\n        }\n        /**\r\n         * 下载图像到本地\r\n         * @param  {Number}  width  宽度\r\n         * @param  {Number}  height 高度\r\n         */\n\n    }, {\n        key: 'download',\n        value: function download(width, height) {\n            var originImage = this.originImage;\n\n            var aLink = document.createElement('a'),\n                evt = document.createEvent('MouseEvents'),\n                type = (this.output || this.file.type).split(\"/\")[1] || 'jpg';\n\n            width = width || originImage.width;\n            height = height || originImage.height;\n\n            aLink.href = this.getData(width, height);\n            aLink.download = width + 'x' + height + '.' + type;\n\n            evt.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0);\n\n            aLink.dispatchEvent(evt);\n        }\n        /**\r\n         * 上传图片\r\n         * @param  {Object} params 上传参数\r\n         * @return {Object}        Promise对象\r\n         */\n\n    }, {\n        key: 'upload',\n        value: function upload(params) {\n            var formData = new FormData(),\n                formKey = params.formKey || 'fileToUpload',\n                options = {\n                url: params.url,\n                type: 'json',\n                data: formData\n            };\n\n            if (params.isOrigin) {\n                formData.append(formKey, this.file);\n            } else {\n                formData.append(formKey, this.getData(params.width, params.height, true));\n            }\n\n            return __WEBPACK_IMPORTED_MODULE_3__utils__[\"b\" /* http */].post(options);\n        }\n    }]);\n\n    return PicTune;\n}();\n\n/* istanbul ignore if */\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (PicTune);\nif (typeof window !== 'undefined' && window.Vue) {\n    window.PicTune = PicTune;\n}\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(2);\nif(typeof content === 'string') content = [[module.i, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar update = __webpack_require__(4)(\"6abb4a33\", content, true, {});\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\nexports = module.exports = __webpack_require__(3)(false);\n// imports\n\n\n// module\nexports.push([module.i, \".image-editor-wrapper{user-select:none;position:relative;text-align:center;width:100%;min-height:400px;line-height:400px;overflow:hidden;background-color:#fff}.image-editor-source{position:relative;display:inline-block;max-width:90%;max-height:80%;vertical-align:middle}.image-editor-picture{position:absolute;left:2px;top:2px;visibility:hidden}.image-editor-canvas,.image-editor-show{position:absolute;left:2px;top:2px;width:calc(100% - 4px);height:calc(100% - 4px)}.image-editor-crop{position:absolute;left:0;top:0;width:100%;height:100%;cursor:move}.image-editor-crop:before{position:absolute;content:\\\" \\\";left:-1px;top:-1px;width:100%;height:100%;border:1px solid #ff8181}.image-editor-crop:after{display:block;margin:1px;content:\\\" \\\";width:calc(100% - 4px);height:calc(100% - 4px);border:1px solid #ff8181}.image-editor-crop div{position:absolute;width:10px;height:10px;border-radius:10px;border:2px solid #f2060d;background-color:#e6b9b9}.editor-crop-left{left:-6px}.editor-crop-right{right:-6px}.editor-crop-top{top:-6px}.editor-crop-bottom{bottom:-6px}.editor-crop-left.editor-crop-top{cursor:nw-resize}.editor-crop-left.editor-crop-bottom{cursor:sw-resize}.editor-crop-right.editor-crop-top{cursor:ne-resize}.editor-crop-right.editor-crop-bottom{cursor:se-resize}\", \"\"]);\n\n// exports\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\n/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\nvar listToStyles = __webpack_require__(5)\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nmodule.exports = function (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports) {\n\n/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nmodule.exports = function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = scale;\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/**\r\n * High-quality scale function for canvas or image element\r\n * @param {Number|Object} scale\r\n * @param {Canvas|Image} input\r\n * @param {Canvas|String} [output]\r\n *   if Canvas or undefined, export by canvas\r\n *   if export == 'png', export by Image png\r\n *   if export == 'jpeg', export by Image jpeg\r\n *   if export == 'png-src', export by base64 png string\r\n *   if export == 'jpeg-src', export by base64 jpeg string\r\n * @param {Boolean} [inputRemovable]\r\n *   if not true, original canvas is kept\r\n *   if true, original canvas is not kept\r\n * @return {Canvas|String|Image|Boolean}\r\n *   if error, return false\r\n */\nfunction scale(scale, input, output, inputRemovable) {\n\tif (!input) {\n\t\tinput = scale.input;\n\t\toutput = scale.output;\n\t\tinputRemovable = scale.inputRemovable;\n\t\tif (scale.scale) scale = scale.scale;\n\t}\n\n\tvar HAS_ALPHA = true;\n\tvar canvas, ctx;\n\tif (input.src) {\n\t\tcanvas = document.createElement('canvas');\n\t\tif (input.naturalWidth != null) {\n\t\t\tcanvas.width = input.naturalWidth;\n\t\t\tcanvas.height = input.naturalHeight;\n\t\t} else if (input.runtimeStyle != null) {\n\t\t\tvar runtimeStyle = input.runtimeStyle,\n\t\t\t    mw = runtimeStyle.width,\n\t\t\t    mh = runtimeStyle.height;\n\t\t\truntimeStyle.width = 'auto';\n\t\t\truntimeStyle.height = 'auto';\n\t\t\tcanvas.width = input.width;\n\t\t\tcanvas.height = input.height;\n\t\t\truntimeStyle.width = mw;\n\t\t\truntimeStyle.height = mh;\n\t\t} else {\n\t\t\tvar mw = input.width,\n\t\t\t    mh = input.height;\n\t\t\tif (input.removeAttribute) {\n\t\t\t\tinput.removeAttribute('width');\n\t\t\t\tinput.removeAttribute('height');\n\t\t\t}\n\t\t\tcanvas.width = input.width;\n\t\t\tcanvas.height = input.height;\n\t\t\tinput.width = mw;\n\t\t\tinput.height = mh;\n\t\t}\n\t} else {\n\t\tcanvas = input;\n\t}\n\tctx = canvas.getContext('2d');\n\tif (input.src) ctx.drawImage(input, 0, 0);\n\tvar sw = canvas.width,\n\t    sh = canvas.height,\n\t    dw,\n\t    dh,\n\t    sourceBuffer = ctx.getImageData(0, 0, sw, sh).data;\n\n\tif (!sw || !sh) return false;\n\tif (input.src || inputRemovable) {\n\t\tcanvas.clearRect(0, 0, sw, sh);\n\t}\n\tif ((typeof scale === 'undefined' ? 'undefined' : _typeof(scale)) === 'object') {\n\t\tif (scale.width) {\n\t\t\tdw = scale.width + 0.5 | 0;\n\t\t\tdh = scale.height + 0.5 | 0;\n\t\t} else {\n\t\t\tdw = sw * scale.scaleX + 0.5 | 0;\n\t\t\tdh = sh * scale.scaleY + 0.5 | 0;\n\t\t}\n\t} else {\n\t\tdw = scale * sw + 0.5 | 0;\n\t\tdh = scale * sh + 0.5 | 0;\n\t}\n\tvar dw4 = dw << 2,\n\t    sw4 = sw << 2,\n\t    sx,\n\t    sy,\n\t    sindex = 0,\n\t    dx,\n\t    dy,\n\t    dyindex,\n\t    dindex = 0,\n\t    idx,\n\t    idy,\n\t    isx,\n\t    isy,\n\t    w,\n\t    wx,\n\t    nwx,\n\t    wy,\n\t    nwy,\n\t    crossX,\n\t    crossY,\n\t    dwh4 = dw4 * dh,\n\t    tmpBuffer,\n\t    r,\n\t    g,\n\t    b,\n\t    a,\n\t    dsy,\n\t    dsx,\n\t    newCanvas,\n\t    newCtx,\n\t    imageData,\n\t    byteBuffer,\n\t    TIMES = 255.99 / 255,\n\t    row0,\n\t    row1,\n\t    row2,\n\t    row3,\n\t    col0,\n\t    col1,\n\t    col2,\n\t    col3,\n\t    scaleX = dw / sw,\n\t    scaleY = dh / sh,\n\t    scaleXY = scaleX * scaleY;\n\n\tfunction setNewCanvas() {\n\t\t// CREATE downscale canvas\n\t\tif ((typeof output === 'undefined' ? 'undefined' : _typeof(output)) === 'object') {\n\t\t\tnewCanvas = output;\n\t\t} else if (input.src || inputRemovable) {\n\t\t\tnewCanvas = canvas;\n\t\t} else {\n\t\t\tnewCanvas = document.createElement('canvas');\n\t\t}\n\t\tnewCanvas.width = dw;\n\t\tnewCanvas.height = dh;\n\t\tnewCtx = newCanvas.getContext('2d');\n\t}\n\tfunction getImageData(tmpBuffer) {\n\t\tif (!tmpBuffer) {\n\t\t\treturn newCtx.getImageData(0, 0, dw, dh);\n\t\t} else {\n\t\t\tvar imageData = newCtx.getImageData(0, 0, dw, dh),\n\t\t\t    byteBuffer = imageData.data,\n\t\t\t    dindex;\n\t\t\tfor (dindex = 0; dindex < dwh4; dindex += 4) {\n\t\t\t\tbyteBuffer[dindex] = tmpBuffer[dindex] * TIMES | 0;\n\t\t\t\tbyteBuffer[dindex + 1] = tmpBuffer[dindex + 1] * TIMES | 0;\n\t\t\t\tbyteBuffer[dindex + 2] = tmpBuffer[dindex + 2] * TIMES | 0;\n\t\t\t\tbyteBuffer[dindex + 3] = HAS_ALPHA ? tmpBuffer[dindex + 3] * TIMES | 0 : 255;\n\t\t\t}\n\t\t\t// delete tmpBuffer\n\t\t\treturn imageData;\n\t\t}\n\t}\n\n\tif (scaleX > 1 || scaleY > 1) {\n\t\t// UPSCALE by bicubic\n\t\tvar bicubic = function bicubic(t, a, b, c, d) {\n\t\t\treturn 0.5 * (c - a + (2 * a - 5 * b + 4 * c - d + (3 * (b - c) + d - a) * t) * t) * t + b;\n\t\t};\n\n\t\tsetNewCanvas();\n\t\timageData = getImageData();\n\t\tbyteBuffer = imageData.data;\n\t\tfor (dy = 0; dy < dh; dy++) {\n\t\t\tsy = dy / scaleY;\n\t\t\tisy = sy | 0;\n\t\t\tdsy = sy - isy;\n\t\t\trow1 = isy * sw4;\n\t\t\trow0 = isy < 1 ? row1 : row1 - sw4;\n\t\t\tif (isy < sh - 2) {\n\t\t\t\trow2 = row1 + sw4;\n\t\t\t\trow3 = (isy + 2) * sw4;\n\t\t\t} else {\n\t\t\t\trow2 = row3 = isy > sh - 2 ? row1 : row1 + sw4;\n\t\t\t}\n\n\t\t\tfor (dx = 0; dx < dw; dx++, dindex += 4) {\n\t\t\t\tsx = dx / scaleX;\n\t\t\t\tisx = sx | 0;\n\t\t\t\tdsx = sx - isx;\n\t\t\t\tcol1 = isx << 2;\n\t\t\t\tcol0 = isx < 1 ? col1 : col1 - 4;\n\t\t\t\tif (isx < sw - 2) {\n\t\t\t\t\tcol2 = col1 + 4;\n\t\t\t\t\tcol3 = col1 + 8;\n\t\t\t\t} else {\n\t\t\t\t\tcol2 = col3 = isx > sw - 2 ? col1 : col1 + 4;\n\t\t\t\t}\n\n\t\t\t\t// RED\n\t\t\t\tr = bicubic(dsy, bicubic(dsx, sourceBuffer[row0 + col0], sourceBuffer[row0 + col1], sourceBuffer[row0 + col2], sourceBuffer[row0 + col3]), bicubic(dsx, sourceBuffer[row1 + col0], sourceBuffer[row1 + col1], sourceBuffer[row1 + col2], sourceBuffer[row1 + col3]), bicubic(dsx, sourceBuffer[row2 + col0], sourceBuffer[row2 + col1], sourceBuffer[row2 + col2], sourceBuffer[row2 + col3]), bicubic(dsx, sourceBuffer[row3 + col0], sourceBuffer[row3 + col1], sourceBuffer[row3 + col2], sourceBuffer[row3 + col3])) * TIMES | 0;\n\n\t\t\t\t// GREEN\n\t\t\t\t++col0, ++col1, ++col2, ++col3;\n\t\t\t\tg = bicubic(dsy, bicubic(dsx, sourceBuffer[row0 + col0], sourceBuffer[row0 + col1], sourceBuffer[row0 + col2], sourceBuffer[row0 + col3]), bicubic(dsx, sourceBuffer[row1 + col0], sourceBuffer[row1 + col1], sourceBuffer[row1 + col2], sourceBuffer[row1 + col3]), bicubic(dsx, sourceBuffer[row2 + col0], sourceBuffer[row2 + col1], sourceBuffer[row2 + col2], sourceBuffer[row2 + col3]), bicubic(dsx, sourceBuffer[row3 + col0], sourceBuffer[row3 + col1], sourceBuffer[row3 + col2], sourceBuffer[row3 + col3])) * TIMES | 0;\n\n\t\t\t\t// BLUE\n\t\t\t\t++col0, ++col1, ++col2, ++col3;\n\t\t\t\tb = bicubic(dsy, bicubic(dsx, sourceBuffer[row0 + col0], sourceBuffer[row0 + col1], sourceBuffer[row0 + col2], sourceBuffer[row0 + col3]), bicubic(dsx, sourceBuffer[row1 + col0], sourceBuffer[row1 + col1], sourceBuffer[row1 + col2], sourceBuffer[row1 + col3]), bicubic(dsx, sourceBuffer[row2 + col0], sourceBuffer[row2 + col1], sourceBuffer[row2 + col2], sourceBuffer[row2 + col3]), bicubic(dsx, sourceBuffer[row3 + col0], sourceBuffer[row3 + col1], sourceBuffer[row3 + col2], sourceBuffer[row3 + col3])) * TIMES | 0;\n\n\t\t\t\tbyteBuffer[dindex] = r >= 0 ? r < 256 ? r : 255 : 0;\n\t\t\t\tbyteBuffer[dindex + 1] = g >= 0 ? g < 256 ? g : 255 : 0;\n\t\t\t\tbyteBuffer[dindex + 2] = b >= 0 ? b < 256 ? b : 255 : 0;\n\n\t\t\t\tif (HAS_ALPHA) {\n\t\t\t\t\t// ALPHA\n\t\t\t\t\t++col0, ++col1, ++col2, ++col3;\n\t\t\t\t\ta = bicubic(dsy, bicubic(dsx, sourceBuffer[row0 + col0], sourceBuffer[row0 + col1], sourceBuffer[row0 + col2], sourceBuffer[row0 + col3]), bicubic(dsx, sourceBuffer[row1 + col0], sourceBuffer[row1 + col1], sourceBuffer[row1 + col2], sourceBuffer[row1 + col3]), bicubic(dsx, sourceBuffer[row2 + col0], sourceBuffer[row2 + col1], sourceBuffer[row2 + col2], sourceBuffer[row2 + col3]), bicubic(dsx, sourceBuffer[row3 + col0], sourceBuffer[row3 + col1], sourceBuffer[row3 + col2], sourceBuffer[row3 + col3])) * TIMES | 0;\n\t\t\t\t\tbyteBuffer[dindex + 3] = a >= 0 ? a < 256 ? a : 255 : 0;\n\t\t\t\t} else {\n\t\t\t\t\tbyteBuffer[dindex + 3] = 255;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// DOWNSCALE\n\t\tif (Float32Array) {\n\t\t\ttmpBuffer = new Float32Array(dwh4);\n\t\t} else {\n\t\t\ttmpBuffer = [];\n\t\t\tfor (dindex = 0; dindex < dwh4; ++dindex) {\n\t\t\t\ttmpBuffer[dindex] = 0;\n\t\t\t}\n\t\t}\n\t\t// CREATE float buffer\n\t\tfor (sy = 0; sy < sh; sy++) {\n\t\t\tdy = sy * scaleY;\n\t\t\tidy = dy | 0;\n\t\t\tdyindex = idy * dw4;\n\t\t\tcrossY = !!((idy - (dy + scaleY | 0)) * (sh - 1 - sy)) << 1;\n\t\t\tif (crossY) {\n\t\t\t\twy = idy + 1 - dy;\n\t\t\t\tnwy = dy + scaleY - idy - 1;\n\t\t\t}\n\t\t\tfor (sx = 0; sx < sw; sx++, sindex += 4) {\n\t\t\t\tdx = sx * scaleX;\n\t\t\t\tidx = dx | 0;\n\t\t\t\tdindex = dyindex + (idx << 2);\n\t\t\t\tcrossX = !!((idx - (dx + scaleX | 0)) * (sw - 1 - sx));\n\t\t\t\tif (crossX) {\n\t\t\t\t\twx = idx + 1 - dx;\n\t\t\t\t\tnwx = dx + scaleX - idx - 1;\n\t\t\t\t}\n\t\t\t\tr = sourceBuffer[sindex];\n\t\t\t\tg = sourceBuffer[sindex + 1];\n\t\t\t\tb = sourceBuffer[sindex + 2];\n\t\t\t\tif (HAS_ALPHA) a = sourceBuffer[sindex + 3];\n\t\t\t\tswitch (crossX + crossY) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\ttmpBuffer[dindex] += r * scaleXY;\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * scaleXY;\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * scaleXY;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * scaleXY;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tw = wx * scaleY;\n\t\t\t\t\t\ttmpBuffer[dindex] += r * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w;\n\t\t\t\t\t\tw = nwx * scaleY;\n\t\t\t\t\t\ttmpBuffer[dindex + 4] += r * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 5] += g * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 6] += b * w;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 7] += a * w;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tw = scaleX * wy;\n\t\t\t\t\t\ttmpBuffer[dindex] += r * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w;\n\t\t\t\t\t\tw = scaleX * nwy;\n\t\t\t\t\t\tdindex += dw4;\n\t\t\t\t\t\ttmpBuffer[dindex] += r * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tw = wx * wy;\n\t\t\t\t\t\ttmpBuffer[dindex] += r * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w;\n\t\t\t\t\t\tw = nwx * wy;\n\t\t\t\t\t\ttmpBuffer[dindex + 4] += r * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 5] += g * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 6] += b * w;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 7] += a * w;\n\t\t\t\t\t\tw = wx * nwy;\n\t\t\t\t\t\tdindex += dw4;\n\t\t\t\t\t\ttmpBuffer[dindex] += r * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w;\n\t\t\t\t\t\tw = nwx * nwy;\n\t\t\t\t\t\ttmpBuffer[dindex + 4] += r * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 5] += g * w;\n\t\t\t\t\t\ttmpBuffer[dindex + 6] += b * w;\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 7] += a * w;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// delete sourceBuffer\n\t\tsetNewCanvas();\n\t\timageData = getImageData(tmpBuffer);\n\t}\n\n\tnewCtx.putImageData(imageData, 0, 0);\n\tif (typeof output === 'string') {\n\t\tif (output === 'png' || output === 'jpeg') {\n\t\t\tvar img;\n\t\t\tif (inputRemovable && input.src) {\n\t\t\t\timg = input;\n\t\t\t} else {\n\t\t\t\timg = new Image();\n\t\t\t}\n\t\t\timg.width = dw;\n\t\t\timg.height = dh;\n\t\t\timg.src = newCanvas.toDataURL('image/' + output, 1);\n\t\t\treturn img;\n\t\t} else if (output === 'png-src' || output === 'jpeg-src') {\n\t\t\treturn newCanvas.toDataURL('image/' + output.split('-')[0], 1);\n\t\t}\n\t}\n\treturn newCanvas;\n} // scale function end\n\n/***/ }),\n/* 7 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return fx; });\n/*\r\n * glfx.js\r\n * http://evanw.github.com/glfx.js/\r\n *\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n */\n\nvar fx = function () {\n    var exports = {};\n    var gl;\n\n    function clamp(lo, value, hi) {\n        return Math.max(lo, Math.min(value, hi));\n    }\n\n    function wrapTexture(texture) {\n        return {\n            _: texture,\n            loadContentsOf: function loadContentsOf(element) {\n                // 确保我们使用正确的全局WebGL上下文\n                gl = this._.gl;\n                this._.loadContentsOf(element);\n            },\n            destroy: function destroy() {\n                // 确保我们使用正确的全局WebGL上下文\n                gl = this._.gl;\n                this._.destroy();\n            }\n        };\n    }\n\n    function texture(element) {\n        return wrapTexture(Texture.fromElement(element));\n    }\n\n    function initialize(width, height) {\n        var type = gl.UNSIGNED_BYTE;\n\n        // 去到浮点缓冲textures，如果我们可以，它会使散景滤镜看起来好多了。 请注意，在Windows上，当启用线性滤镜时，ANGLE不允许您呈现为浮点textures。\n        // Go for floating point buffer textures if we can, it'll make the bokeh\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\n        // render to a floating-point texture when linear filtering is enabled.\n        // See http://crbug.com/172278 for more information.\n        if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\n            var testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\n            try {\n                // 只有使用gl.FLOAT，如果我们可以渲染到它\n                testTexture.drawTo(function () {\n                    type = gl.FLOAT;\n                });\n            } catch (e) {}\n            testTexture.destroy();\n        }\n\n        if (this._.texture) this._.texture.destroy();\n        if (this._.spareTexture) this._.spareTexture.destroy();\n        this.width = width;\n        this.height = height;\n        this._.texture = new Texture(width, height, gl.RGBA, type);\n        this._.spareTexture = new Texture(width, height, gl.RGBA, type);\n        this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\n        this._.flippedShader = this._.flippedShader || new Shader(null, '\\\r\n\t        uniform sampler2D texture;\\\r\n\t        varying vec2 texCoord;\\\r\n\t        void main() {\\\r\n\t            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\r\n\t        }\\\r\n\t    ');\n        this._.isInitialized = true;\n    }\n\n    /*\r\n      在画布上绘制texture，可选择宽度和高度进行缩放。如果没有给出宽度和高度，则原始texture宽度和高度使用。\r\n    */\n    function draw(texture, width, height) {\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\n        }\n\n        texture._.use();\n        this._.texture.drawTo(function () {\n            Shader.getDefaultShader().drawRect();\n        });\n\n        return this;\n    }\n\n    function update() {\n        this._.texture.use();\n        this._.flippedShader.drawRect();\n        return this;\n    }\n\n    function simpleShader(shader, uniforms, textureIn, textureOut) {\n        (textureIn || this._.texture).use();\n        this._.spareTexture.drawTo(function () {\n            shader.uniforms(uniforms).drawRect();\n        });\n        this._.spareTexture.swapWith(textureOut || this._.texture);\n    }\n\n    function replace(node) {\n        node.parentNode.insertBefore(this, node);\n        node.parentNode.removeChild(node);\n        return this;\n    }\n\n    function contents() {\n        var texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\n        this._.texture.use();\n        texture.drawTo(function () {\n            Shader.getDefaultShader().drawRect();\n        });\n        return wrapTexture(texture);\n    }\n\n    /*\r\n       获取一个Uint8的像素值数组: [r, g, b, a, r, g, b, a, ...]\r\n       数组的长度是 width * height * 4.\r\n    */\n    function getPixelArray() {\n        var w = this._.texture.width;\n        var h = this._.texture.height;\n        var array = new Uint8Array(w * h * 4);\n        this._.texture.drawTo(function () {\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\n        });\n        return array;\n    }\n\n    function wrap(func) {\n        return function () {\n            // 确保我们使用正确的全局WebGL上下文\n            gl = this._.gl;\n\n            // 现在上下文已经切换，我们可以调用包装函数\n            return func.apply(this, arguments);\n        };\n    }\n\n    // from javax.media.jai.PerspectiveTransform\n\n    function getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\n        var dx1 = x1 - x2;\n        var dy1 = y1 - y2;\n        var dx2 = x3 - x2;\n        var dy2 = y3 - y2;\n        var dx3 = x0 - x1 + x2 - x3;\n        var dy3 = y0 - y1 + y2 - y3;\n        var det = dx1 * dy2 - dx2 * dy1;\n        var a = (dx3 * dy2 - dx2 * dy3) / det;\n        var b = (dx1 * dy3 - dx3 * dy1) / det;\n        return [x1 - x0 + a * x1, y1 - y0 + a * y1, a, x3 - x0 + b * x3, y3 - y0 + b * y3, b, x0, y0, 1];\n    }\n\n    function getInverse(m) {\n        var a = m[0],\n            b = m[1],\n            c = m[2];\n        var d = m[3],\n            e = m[4],\n            f = m[5];\n        var g = m[6],\n            h = m[7],\n            i = m[8];\n        var det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n        return [(e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det, (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det, (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det];\n    }\n\n    function multiply(a, b) {\n        return [a[0] * b[0] + a[1] * b[3] + a[2] * b[6], a[0] * b[1] + a[1] * b[4] + a[2] * b[7], a[0] * b[2] + a[1] * b[5] + a[2] * b[8], a[3] * b[0] + a[4] * b[3] + a[5] * b[6], a[3] * b[1] + a[4] * b[4] + a[5] * b[7], a[3] * b[2] + a[4] * b[5] + a[5] * b[8], a[6] * b[0] + a[7] * b[3] + a[8] * b[6], a[6] * b[1] + a[7] * b[4] + a[8] * b[7], a[6] * b[2] + a[7] * b[5] + a[8] * b[8]];\n    }\n\n    function warpShader(uniforms, warp) {\n        return new Shader(null, uniforms + '\\\r\n\t    uniform sampler2D texture;\\\r\n\t    uniform vec2 texSize;\\\r\n\t    varying vec2 texCoord;\\\r\n\t    void main() {\\\r\n\t        vec2 coord = texCoord * texSize;\\\r\n\t        ' + warp + '\\\r\n\t        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n\t        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n\t        if (coord != clampedCoord) {\\\r\n\t            /* fade to transparent if we are outside the image */\\\r\n\t            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n\t        }\\\r\n\t    }');\n    }\n    /**\r\n     * @filter           Hue / Saturation\r\n     * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n     *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n     *                   values. Hue changing works by rotating the color vector around the grayscale\r\n     *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n     *                   Saturation is implemented by scaling all color channel values either toward\r\n     *                   or away from the average color channel value.\r\n     * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n     *                   and 1 is 180 degree rotation in the positive direction)\r\n     * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     */\n    function hueColor(args) {\n        var hue = args[0],\n            greenRed = args[1],\n            purpleGreen = args[2],\n            yellowBlue = args[3];\n        gl.hueColor = gl.hueColor || new Shader(null, '\\\r\n\t        uniform sampler2D texture;\\\r\n\t        uniform float hue;\\\r\n\t        uniform float greenRed;\\\r\n\t        uniform float purpleGreen;\\\r\n\t        uniform float yellowBlue;\\\r\n\t        varying vec2 texCoord;\\\r\n\t        void main() {\\\r\n\t            vec4 color = texture2D(texture, texCoord);\\\r\n\t            \\\r\n\t            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n\t            float angle = hue * 3.14159265;\\\r\n\t            float s = sin(angle), c = cos(angle);\\\r\n\t            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n\t            float len = length(color.rgb);\\\r\n\t            color.rgb = vec3(\\\r\n\t                dot(color.rgb, weights.xyz),\\\r\n\t                dot(color.rgb, weights.zxy),\\\r\n\t                dot(color.rgb, weights.yzx)\\\r\n\t            );\\\r\n\t            color.r += greenRed; \\\r\n\t            color.g -= greenRed; \\\r\n\t            color.b -= greenRed; \\\r\n\t            color.r -= purpleGreen; \\\r\n\t            color.g += purpleGreen; \\\r\n\t            color.b -= purpleGreen; \\\r\n\t            color.r -= yellowBlue; \\\r\n\t            color.g -= yellowBlue; \\\r\n\t            color.b += yellowBlue; \\\r\n\t            gl_FragColor = color;\\\r\n\t        }\\\r\n\t    ');\n\n        simpleShader.call(this, gl.hueColor, {\n            hue: clamp(-1, hue, 1),\n            greenRed: clamp(-1, greenRed / 5, 1),\n            purpleGreen: clamp(-1, purpleGreen / 5, 1),\n            yellowBlue: clamp(-1, yellowBlue / 5, 1)\n        });\n\n        return this;\n    }\n\n    /**\r\n     * @filter           Brightness / Contrast/ Saturation / Blur\r\n     * @description      Provides additive brightness and multiplicative contrast control.\r\n     * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n     * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     * @param radius The radius of the pyramid convolved with the image.\r\n     */\n    function brightnesscontrastSaturationBur(args) {\n        var brightness = args[0],\n            contrast = args[1],\n            saturation = args[2],\n            radius = args[3];\n        gl.brightnesscontrastSaturationBur = gl.brightnesscontrastSaturationBur || new Shader(null, '\\\r\n            uniform sampler2D texture;\\\r\n            uniform float brightness;\\\r\n            uniform float contrast;\\\r\n            uniform float saturation;\\\r\n            uniform vec2 delta;\\\r\n            varying vec2 texCoord;\\\r\n            ' + randomShaderFunc + '\\\r\n            void main() {\\\r\n                vec4 color = vec4(0.0);\\\r\n                float total = 0.0;\\\r\n                \\\r\n                /* randomize the lookup values to hide the fixed number of samples */\\\r\n                float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n                \\\r\n                for (float t = -30.0; t <= 30.0; t++) {\\\r\n                    float percent = (t + offset - 0.5) / 30.0;\\\r\n                    float weight = 1.0 - abs(percent);\\\r\n                    vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                    \\\r\n                    /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                    sample.rgb *= sample.a;\\\r\n                    \\\r\n                    color += sample * weight;\\\r\n                    total += weight;\\\r\n                    color.rgb += brightness;\\\r\n                    if (contrast > 0.0) {\\\r\n                        color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n                    } else {\\\r\n                        color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n                    }\\\r\n                    /* saturation adjustment */\\\r\n                    float average = (color.r + color.g + color.b) / 3.0;\\\r\n                    if (saturation > 0.0) {\\\r\n                        color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n                    } else {\\\r\n                        color.rgb += (average - color.rgb) * (-saturation);\\\r\n                    }\\\r\n                }\\\r\n                \\\r\n                gl_FragColor = color / total;\\\r\n                \\\r\n                /* switch back from pre-multiplied alpha */\\\r\n                gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n            }\\\r\n        ');\n\n        simpleShader.call(this, gl.brightnesscontrastSaturationBur, {\n            brightness: clamp(-1, brightness / 10, 1),\n            contrast: clamp(-1, contrast / 100, 1),\n            saturation: clamp(-1, saturation / 50, 1)\n        });\n        simpleShader.call(this, gl.brightnesscontrastSaturationBur, {\n            delta: [radius / this.width, 0]\n        });\n        simpleShader.call(this, gl.brightnesscontrastSaturationBur, {\n            delta: [0, radius / this.height]\n        });\n\n        return this;\n    }\n\n    // From: https://github.com/evanw/OES_texture_float_linear-polyfill\n    (function () {\n        // 上传2x2浮点texture，其中一个像素为2，其他三个像素为0。\n        //仅当从texture的中心采样,样本是（2 + 0 + 0 + 0）/ 4 = 0.5时，才支持线性滤波。\n        // Linear filtering is only supported if a sample taken\n        // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\n        function supportsOESTextureFloatLinear(gl) {\n            // 首先需要浮点 textures\n            if (!gl.getExtension('OES_texture_float')) {\n                return false;\n            }\n\n            // 创建渲染目标\n            var framebuffer = gl.createFramebuffer();\n            var byteTexture = gl.createTexture();\n            gl.bindTexture(gl.TEXTURE_2D, byteTexture);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\n\n            // 创建一个在中心且值为0.5的简单浮点Texture\n            var rgba = [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n            var floatTexture = gl.createTexture();\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\n\n            // 创建测试着色器\n            var program = gl.createProgram();\n            var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n            var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n            gl.shaderSource(vertexShader, '\\\r\n\t\t      attribute vec2 vertex;\\\r\n\t\t      void main() {\\\r\n\t\t        gl_Position = vec4(vertex, 0.0, 1.0);\\\r\n\t\t      }\\\r\n\t\t    ');\n            gl.shaderSource(fragmentShader, '\\\r\n\t\t      uniform sampler2D texture;\\\r\n\t\t      void main() {\\\r\n\t\t        gl_FragColor = texture2D(texture, vec2(0.5));\\\r\n\t\t      }\\\r\n\t\t    ');\n            gl.compileShader(vertexShader);\n            gl.compileShader(fragmentShader);\n            gl.attachShader(program, vertexShader);\n            gl.attachShader(program, fragmentShader);\n            gl.linkProgram(program);\n\n            // 创建一个包含单个点的缓冲区\n            var buffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\n            gl.enableVertexAttribArray(0);\n            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n\n            // 渲染点并读取渲染的像素\n            var pixel = new Uint8Array(4);\n            gl.useProgram(program);\n            gl.viewport(0, 0, 1, 1);\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\n            gl.drawArrays(gl.POINTS, 0, 1);\n            gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\n\n            // 如果线性滤镜起作用了，中心样本将只有0.5的值\n            // The center sample will only have a value of 0.5 if linear filtering works\n            return pixel[0] === 127 || pixel[0] === 128;\n        }\n\n        // 返回的扩展对象的构造函数\n        function OESTextureFloatLinear() {}\n\n        // Cache the extension so it's specific to each context like extensions should be\n        // 缓存extension，它是特定于每个上下文\n        function getOESTextureFloatLinear(gl) {\n            if (gl.$OES_texture_float_linear$ === void 0) {\n                Object.defineProperty(gl, '$OES_texture_float_linear$', {\n                    enumerable: false,\n                    configurable: false,\n                    writable: false,\n                    value: new OESTextureFloatLinear()\n                });\n            }\n            return gl.$OES_texture_float_linear$;\n        }\n\n        // 这将替换实际的getExtension()\n        function getExtension(name) {\n            return name === 'OES_texture_float_linear' ? getOESTextureFloatLinear(this) : oldGetExtension.call(this, name);\n        }\n\n        // 这将替换实际的 getSupportedExtensions()\n        function getSupportedExtensions() {\n            var extensions = oldGetSupportedExtensions.call(this);\n            if (extensions.indexOf('OES_texture_float_linear') === -1) {\n                extensions.push('OES_texture_float_linear');\n            }\n            return extensions;\n        }\n\n        // 获取WebGL上下文\n        try {\n            var gl = document.createElement('canvas').getContext('experimental-webgl');\n        } catch (e) {}\n\n        // 如果浏览器已经支持或没有WebGL，请不要安装polyfill\n        if (!gl || gl.getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\n            return;\n        }\n\n        // 如果线性滤镜适用于浮点textures，请安装polyfill \n        if (supportsOESTextureFloatLinear(gl)) {\n            var oldGetExtension = WebGLRenderingContext.prototype.getExtension;\n            var oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\n            WebGLRenderingContext.prototype.getExtension = getExtension;\n            WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\n        }\n    })();\n\n    exports.canvas = function () {\n        var canvas = document.createElement('canvas');\n        try {\n            gl = canvas.getContext('experimental-webgl', { premultipliedAlpha: false, preserveDrawingBuffer: true });\n        } catch (e) {\n            gl = null;\n        }\n        if (!gl) {\n            throw 'This browser does not support WebGL';\n        }\n        canvas._ = {\n            gl: gl,\n            isInitialized: false,\n            texture: null,\n            spareTexture: null,\n            flippedShader: null\n        };\n\n        // 核心方法\n        canvas.texture = wrap(texture);\n        canvas.draw = wrap(draw);\n        canvas.update = wrap(update);\n        canvas.replace = wrap(replace);\n        canvas.contents = wrap(contents);\n        canvas.getPixelArray = wrap(getPixelArray);\n\n        // 滤镜方法\n        canvas.brightnesscontrastSaturationBur = wrap(brightnesscontrastSaturationBur);\n        canvas.hueColor = wrap(hueColor);\n\n        return canvas;\n    };\n    // exports.splineInterpolate = splineInterpolate;\n\n    var Shader = function () {\n        function isArray(obj) {\n            return Object.prototype.toString.call(obj) == '[object Array]';\n        }\n\n        function isNumber(obj) {\n            return Object.prototype.toString.call(obj) == '[object Number]';\n        }\n\n        function compileSource(type, source) {\n            var shader = gl.createShader(type);\n            gl.shaderSource(shader, source);\n            gl.compileShader(shader);\n            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n                throw 'compile error: ' + gl.getShaderInfoLog(shader);\n            }\n            return shader;\n        }\n\n        var defaultVertexSource = '\\\r\n\t    attribute vec2 vertex;\\\r\n\t    attribute vec2 _texCoord;\\\r\n\t    varying vec2 texCoord;\\\r\n\t    void main() {\\\r\n\t        texCoord = _texCoord;\\\r\n\t        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n\t    }';\n\n        var defaultFragmentSource = '\\\r\n\t    uniform sampler2D texture;\\\r\n\t    varying vec2 texCoord;\\\r\n\t    void main() {\\\r\n\t        gl_FragColor = texture2D(texture, texCoord);\\\r\n\t    }';\n\n        function Shader(vertexSource, fragmentSource) {\n            this.vertexAttribute = null;\n            this.texCoordAttribute = null;\n            this.program = gl.createProgram();\n            vertexSource = vertexSource || defaultVertexSource;\n            fragmentSource = fragmentSource || defaultFragmentSource;\n            fragmentSource = 'precision highp float;' + fragmentSource; // annoying requirement is annoying\n            gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource));\n            gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource));\n            gl.linkProgram(this.program);\n            if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n                throw 'link error: ' + gl.getProgramInfoLog(this.program);\n            }\n        }\n\n        Shader.prototype.destroy = function () {\n            gl.deleteProgram(this.program);\n            this.program = null;\n        };\n\n        Shader.prototype.uniforms = function (uniforms) {\n            gl.useProgram(this.program);\n            for (var name in uniforms) {\n                if (!uniforms.hasOwnProperty(name)) continue;\n                var location = gl.getUniformLocation(this.program, name);\n                if (location === null) continue; // will be null if the uniform isn't used in the shader\n                var value = uniforms[name];\n                if (isArray(value)) {\n                    switch (value.length) {\n                        case 1:\n                            gl.uniform1fv(location, new Float32Array(value));\n                            break;\n                        case 2:\n                            gl.uniform2fv(location, new Float32Array(value));\n                            break;\n                        case 3:\n                            gl.uniform3fv(location, new Float32Array(value));\n                            break;\n                        case 4:\n                            gl.uniform4fv(location, new Float32Array(value));\n                            break;\n                        case 9:\n                            gl.uniformMatrix3fv(location, false, new Float32Array(value));\n                            break;\n                        case 16:\n                            gl.uniformMatrix4fv(location, false, new Float32Array(value));\n                            break;\n                        default:\n                            throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\n                    }\n                } else if (isNumber(value)) {\n                    gl.uniform1f(location, value);\n                } else {\n                    throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\n                }\n            }\n            // 允许链式操作\n            return this;\n        };\n\n        // textures 也是均匀的，但由于某些原因不能由gl.uniform1f指定，即使浮点数表示整数0到7\n        Shader.prototype.textures = function (textures) {\n            gl.useProgram(this.program);\n            for (var name in textures) {\n                if (!textures.hasOwnProperty(name)) continue;\n                gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\n            }\n            // 允许链式操作\n            return this;\n        };\n\n        Shader.prototype.drawRect = function (left, top, right, bottom) {\n            var undefined;\n            var viewport = gl.getParameter(gl.VIEWPORT);\n            top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n            left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n            right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n            bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n            if (gl.vertexBuffer == null) {\n                gl.vertexBuffer = gl.createBuffer();\n            }\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\n            if (gl.texCoordBuffer == null) {\n                gl.texCoordBuffer = gl.createBuffer();\n                gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n            }\n            if (this.vertexAttribute == null) {\n                this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\n                gl.enableVertexAttribArray(this.vertexAttribute);\n            }\n            if (this.texCoordAttribute == null) {\n                this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\n                gl.enableVertexAttribArray(this.texCoordAttribute);\n            }\n            gl.useProgram(this.program);\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n            gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n            gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        };\n\n        Shader.getDefaultShader = function () {\n            gl.defaultShader = gl.defaultShader || new Shader();\n            return gl.defaultShader;\n        };\n\n        return Shader;\n    }();\n\n    function SplineInterpolator(points) {\n        var n = points.length;\n        this.xa = [];\n        this.ya = [];\n        this.u = [];\n        this.y2 = [];\n\n        points.sort(function (a, b) {\n            return a[0] - b[0];\n        });\n        for (var i = 0; i < n; i++) {\n            this.xa.push(points[i][0]);\n            this.ya.push(points[i][1]);\n        }\n\n        this.u[0] = 0;\n        this.y2[0] = 0;\n\n        for (var i = 1; i < n - 1; ++i) {\n            //这是三角算法的分解循环。\n            // y2和u用于分解因子的临时存储。\n            var wx = this.xa[i + 1] - this.xa[i - 1];\n            var sig = (this.xa[i] - this.xa[i - 1]) / wx;\n            var p = sig * this.y2[i - 1] + 2.0;\n\n            this.y2[i] = (sig - 1.0) / p;\n\n            var ddydx = (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) - (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n        }\n\n        this.y2[n - 1] = 0;\n\n        // 这是三对角算法的背取代循环\n        for (var i = n - 2; i >= 0; --i) {\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n        }\n    }\n    SplineInterpolator.prototype.interpolate = function (x) {\n        var n = this.ya.length;\n        var klo = 0;\n        var khi = n - 1;\n\n        // We will find the right place in the table by means of\n        // bisection. This is optimal if sequential calls to this\n        // routine are at random values of x. If sequential calls\n        // are in order, and closely spaced, one would do better\n        // to store previous values of klo and khi.\n        // 我们将通过二分法在表中找到正确的地方。 如果对此例程的顺序调用是随机值x，这是最佳的。 如果顺序调用是有序的，并且紧密间隔，则可以更好地存储klo和khi的先前值。\n        while (khi - klo > 1) {\n            var k = khi + klo >> 1;\n\n            if (this.xa[k] > x) {\n                khi = k;\n            } else {\n                klo = k;\n            }\n        }\n\n        var h = this.xa[khi] - this.xa[klo];\n        var a = (this.xa[khi] - x) / h;\n        var b = (x - this.xa[klo]) / h;\n\n        // 现在评估立方样条多项式Cubic spline polynomial is now evaluated.\n        return a * this.ya[klo] + b * this.ya[khi] + ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n    };\n\n    var Texture = function () {\n        Texture.fromElement = function (element) {\n            var texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\n            texture.loadContentsOf(element);\n            return texture;\n        };\n\n        function Texture(width, height, format, type) {\n            this.gl = gl;\n            this.id = gl.createTexture();\n            this.width = width;\n            this.height = height;\n            this.format = format;\n            this.type = type;\n\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n\n        Texture.prototype.loadContentsOf = function (element) {\n            this.width = element.width || element.videoWidth;\n            this.height = element.height || element.videoHeight;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\n        };\n\n        Texture.prototype.initFromBytes = function (width, height, data) {\n            this.width = width;\n            this.height = height;\n            this.format = gl.RGBA;\n            this.type = gl.UNSIGNED_BYTE;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\n        };\n\n        Texture.prototype.destroy = function () {\n            gl.deleteTexture(this.id);\n            this.id = null;\n        };\n\n        Texture.prototype.use = function (unit) {\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n        };\n\n        Texture.prototype.unuse = function (unit) {\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n            gl.bindTexture(gl.TEXTURE_2D, null);\n        };\n\n        Texture.prototype.ensureFormat = function (width, height, format, type) {\n            // 允许传递现有的texture而不是单个参数\n            if (arguments.length == 1) {\n                var texture = arguments[0];\n                width = texture.width;\n                height = texture.height;\n                format = texture.format;\n                type = texture.type;\n            }\n\n            // 仅在需要时更改格式\n            if (width != this.width || height != this.height || format != this.format || type != this.type) {\n                this.width = width;\n                this.height = height;\n                this.format = format;\n                this.type = type;\n                gl.bindTexture(gl.TEXTURE_2D, this.id);\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n            }\n        };\n\n        Texture.prototype.drawTo = function (callback) {\n            // 开始渲染 texture\n            gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\n            gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n            if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n                throw new Error('incomplete framebuffer');\n            }\n            gl.viewport(0, 0, this.width, this.height);\n\n            // do the drawing\n            callback();\n\n            // 停止渲染 texture\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        };\n\n        var canvas = null;\n\n        function getCanvas(texture) {\n            if (canvas == null) {\n                canvas = document.createElement('canvas');\n            }\n            canvas.width = texture.width;\n            canvas.height = texture.height;\n            var c = canvas.getContext('2d');\n            c.clearRect(0, 0, canvas.width, canvas.height);\n            return c;\n        }\n\n        Texture.prototype.fillUsingCanvas = function (callback) {\n            callback(getCanvas(this));\n            this.format = gl.RGBA;\n            this.type = gl.UNSIGNED_BYTE;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\n            return this;\n        };\n\n        Texture.prototype.toImage = function (image) {\n            this.use();\n            Shader.getDefaultShader().drawRect();\n            var size = this.width * this.height * 4;\n            var pixels = new Uint8Array(size);\n            var c = getCanvas(this);\n            var data = c.createImageData(this.width, this.height);\n            gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n            for (var i = 0; i < size; i++) {\n                data.data[i] = pixels[i];\n            }\n            c.putImageData(data, 0, 0);\n            image.src = canvas.toDataURL();\n        };\n\n        Texture.prototype.swapWith = function (other) {\n            var temp;\n            temp = other.id;\n            other.id = this.id;\n            this.id = temp;\n            temp = other.width;\n            other.width = this.width;\n            this.width = temp;\n            temp = other.height;\n            other.height = this.height;\n            this.height = temp;\n            temp = other.format;\n            other.format = this.format;\n            this.format = temp;\n        };\n\n        return Texture;\n    }();\n\n    // 返回一个 0 到 1的随机数\n    var randomShaderFunc = '\\\r\n\t    float random(vec3 scale, float seed) {\\\r\n\t        /* use the fragment position for a different seed per-pixel */\\\r\n\t        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n\t    }\\\r\n\t';\n\n    return exports;\n}();\n\n/***/ }),\n/* 8 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* unused harmony export Query */\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return http; });\n/* harmony export (immutable) */ __webpack_exports__[\"d\"] = turnOver;\n/* harmony export (immutable) */ __webpack_exports__[\"c\"] = runFunction;\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = convertDataurlToBlob;\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar Query = {\n    parse: function parse() {\n        var search = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.search;\n\n        if (!search) return {};\n\n        var queryString = search[0] === '?' ? search.substring(1) : search;\n        var query = {};\n\n        queryString.split('&').forEach(function (queryStr) {\n            var _queryStr$split = queryStr.split('='),\n                _queryStr$split2 = _slicedToArray(_queryStr$split, 2),\n                key = _queryStr$split2[0],\n                value = _queryStr$split2[1];\n\n            if (key) query[key] = value;\n        });\n\n        return query;\n    },\n    stringify: function stringify(query) {\n        var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '?';\n\n        var queryString = Object.keys(query).map(function (key) {\n            return key + '=' + encodeURIComponent(query[key] || '');\n        }).join('&');\n\n        return queryString ? prefix + queryString : '';\n    }\n};\n\nvar http = {\n    get: ajaxFactory('GET'),\n    post: ajaxFactory('POST')\n\n    /**\r\n     * [turnOver   图片翻转]\r\n     * @param  {[type]} oGC  [画布2d context]\r\n     * @param  {[type]} obj [翻转的img对象]\r\n     * @param  {[type]} iNow [翻转标志，4水平翻转，5垂直翻转]\r\n     * @return {[type]} [description]\r\n     */\n};function turnOver(oC) {\n    var oGC = oC.getContext('2d'),\n        oImg = oGC.getImageData(0, 0, oC.width, oC.height),\n        newImg = oGC.createImageData(oC.width, oC.height);\n\n    var w = oImg.width,\n        h = oImg.height;\n\n    for (var i = 0; i < w; i++) {\n\n        for (var j = 0; j < h; j++) {\n            var color = getXY(oImg, i, j);\n\n            setXY(newImg, w - 1 - i, j, color);\n        }\n    }\n\n    oGC.putImageData(newImg, 0, 0);\n}\n\nfunction runFunction(fn, thisObj, args) {\n    if (fn && typeof fn === \"function\") {\n        var argus = arguments,\n            argsl = argus.length;\n\n        //如果函数的参数列表存在1个参数\n        if (argsl == 1) {\n            return fn.apply(window);\n        }\n\n        //如果函数的参数列表存在2个参数\n        if (argsl == 2) {\n            if (Array.isArray(thisObj)) {\n                return fn.apply(window, thisObj);\n            } else {\n                return fn.apply(thisObj);\n            }\n        }\n\n        //如果函数的参数列表存在3个参数\n        if (argsl == 3) {\n            return fn.apply(thisObj || window, args);\n        }\n    }\n}\n\n/**\r\n * 将以base64的图片url数据转换为Blob\r\n * @param  {String} urlData  用url方式表示的base64图片数据\r\n * @return {Object} 图片的Blob对象\r\n */\nfunction convertDataurlToBlob(urlData, type) {\n\n    //去掉url的头，并转换为byte\n    var bytes = window.atob(urlData.split(',')[1]);\n\n    //处理异常,将ascii码小于0的转换为大于0\n    var ab = new ArrayBuffer(bytes.length);\n    var ia = new Uint8Array(ab);\n    for (var i = 0; i < bytes.length; i++) {\n        ia[i] = bytes.charCodeAt(i);\n    }\n\n    return new Blob([ab], {\n        type: type\n    });\n}\n\nfunction ajaxFactory(method) {\n    return function (options) {\n        var req = new XMLHttpRequest();\n\n        var url = options.url,\n            data = options.data,\n            body = null;\n\n        if (method === 'GET' && data) {\n            url += Query.stringify(data, url.indexOf('?') == -1 ? '?' : '&');\n        }\n\n        var p = new Promise(function (resolve, reject) {\n            req.addEventListener('load', function () {\n                var contentType = req.getResponseHeader('content-type');\n                var res = req.responseType != 'text' && req.responseType != '' ? req.response : req.responseText;\n\n                resolve(res);\n            });\n\n            req.addEventListener('error', function (error) {\n                return reject(error);\n            });\n        });\n\n        req.open(method, url, true);\n\n        if (method !== 'GET') {\n            if (data && data.append) {\n                body = data;\n            } else {\n                body = JSON.stringify(data);\n                req.setRequestHeader('Content-Type', 'application/json');\n            }\n        }\n\n        if (options.type) req.responseType = options.type;\n\n        req.send(body);\n        return p;\n    };\n}\n\n/**\r\n * [getXY   获取图像点的颜色值]\r\n * @param  {[type]} obj  [图形对象]\r\n * @param  {[type]} x [x坐标]\r\n * @param  {[type]} y [y坐标]\r\n * @param  {[type]} color [颜色数组分别代表rgba]\r\n * @return {[type]} color [颜色数组分别代表rgba]\r\n */\nfunction getXY(obj, x, y) {\n    //针对一行一列进行操作\n\n    var w = obj.width,\n        h = obj.height,\n        d = obj.data;\n\n    var color = [];\n\n    color[0] = d[4 * (y * w + x)];\n    color[1] = d[4 * (y * w + x) + 1];\n    color[2] = d[4 * (y * w + x) + 2];\n    color[3] = d[4 * (y * w + x) + 3];\n\n    return color;\n}\n\n/**\r\n * [setXY   设置图像点的颜色值]\r\n * @param  {[type]} obj  [图形对象]\r\n * @param  {[type]} x [x坐标]\r\n * @param  {[type]} y [y坐标]\r\n * @param  {[type]} color [颜色数组分别代表rgba]\r\n * @return {[type]}          [description]\r\n */\nfunction setXY(obj, x, y, color) {\n    var w = obj.width,\n        h = obj.height,\n        d = obj.data;\n\n    d[4 * (y * w + x)] = color[0];\n    d[4 * (y * w + x) + 1] = color[1];\n    d[4 * (y * w + x) + 2] = color[2];\n    d[4 * (y * w + x) + 3] = color[3];\n}\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// pic-tune.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap eddeb352e4db65974b62","import './main.css';\r\nimport { scale } from './scale.js';\r\nimport { fx } from './glfx.js';\r\nimport { http, turnOver, runFunction, convertDataurlToBlob } from './utils';\r\n\r\n// 裁剪框的一对边框所占像素\r\nconst BORDER_PIX = 4;\r\n\r\n/**\r\n * 绑定事件\r\n * @param  {Object} editorObj 编辑器对象 \r\n * @return 无\r\n */\r\nfunction bindEvents( editorObj ) {\r\n    const wrapper = editorObj.wrapper;\r\n    const source = editorObj.source;\r\n    const picture = editorObj.picture;\r\n    const showImage = editorObj.showImage;\r\n    const canvas = editorObj.canvas;\r\n    const crop = editorObj.crop;\r\n\r\n    let isMove = false,\r\n        isResize = false,\r\n        maxPos = {\r\n            left: 0,\r\n            top: 0,\r\n            width: 0,\r\n            height: 0\r\n        },\r\n        curPoint = \"\",\r\n        moveTimer = 0;\r\n\r\n    const movePoints = crop.getElementsByTagName('div');\r\n    const pointDirection = ['lt', 'rt', 'lb', 'rb'];\r\n\r\n    crop.onmousedown = function (e) {\r\n        let toElement = e.toElement;\r\n\r\n        maxPos.left = source.clientWidth - (crop.offsetWidth);\r\n        maxPos.top = source.clientHeight - (crop.offsetHeight);\r\n        maxPos.width = source.clientWidth,\r\n        maxPos.height = source.clientHeight;\r\n        isMove = true;\r\n\r\n        for ( let i = 0, len = movePoints.length; i < len; ++i ) {\r\n            if ( movePoints[i] === toElement ) {\r\n                curPoint = pointDirection[i];\r\n                isMove = false;\r\n                isResize = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        clearTimeout(moveTimer);\r\n        moveTimer = setTimeout(moveEnd, 1000);\r\n    }\r\n\r\n    wrapper.onmousemove = function (e) {\r\n        let cropStyle = crop.style,\r\n            movementX = e.movementX,\r\n            movementY = e.movementY,\r\n            offsetLeft = crop.offsetLeft,\r\n            offsetTop = crop.offsetTop,\r\n            newLeft, newTop, newWidth, newHeight;\r\n\r\n        const cropRate = editorObj.cropRate;\r\n\r\n        if ( isMove ) {// 移动\r\n            newLeft = offsetLeft + movementX;\r\n            newTop = offsetTop + movementY;\r\n\r\n            newLeft = newLeft < 0 ? 0 : (newLeft > maxPos.left ? maxPos.left : newLeft);\r\n            newTop = newTop < 0 ? 0 : (newTop > maxPos.top ? maxPos.top : newTop);\r\n\r\n            if ( newLeft != offsetLeft ) cropStyle.left = newLeft + \"px\";\r\n            if ( newTop != offsetTop ) cropStyle.top = newTop + \"px\";\r\n\r\n            runFunction(editorObj.onMovingCrop, editorObj, []);\r\n        } else if ( isResize ) {// 修改尺寸\r\n            let offsetWidth = crop.offsetWidth,\r\n                offsetHeight = crop.offsetHeight;\r\n\r\n            if ( cropRate ) {\r\n                let sign = (curPoint == 'lt' || curPoint == \"rb\") ? 1 : -1;\r\n\r\n                if ( cropRate > 1 ) {\r\n                    movementX = sign * movementY * cropRate;\r\n                } else {\r\n                    movementY = sign * movementX / cropRate;\r\n                }\r\n            }\r\n\r\n            // 判断左右\r\n            if ( curPoint.indexOf(\"l\") != -1 ) {\r\n                newLeft = offsetLeft + movementX;\r\n                newWidth = offsetWidth - movementX;\r\n\r\n                if ( newLeft < 0 ) {\r\n                    newWidth = newWidth + newLeft;\r\n                    newLeft = 0;\r\n\r\n                    if ( cropRate ) {\r\n                        newHeight = (newWidth - BORDER_PIX) / cropRate + BORDER_PIX;\r\n                    }\r\n                }\r\n\r\n            } else {\r\n                newWidth = offsetWidth + movementX;\r\n\r\n                if ( newWidth + offsetLeft > maxPos.width ) {\r\n                    newWidth = maxPos.width - offsetLeft;\r\n\r\n                    if ( cropRate ) {\r\n                        newHeight = (newWidth - BORDER_PIX) / cropRate + BORDER_PIX;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // 判断上下\r\n            if ( curPoint.indexOf(\"t\") != -1 && !newHeight ) {\r\n                newTop = offsetTop + movementY;\r\n                newHeight = offsetHeight - movementY;\r\n\r\n                if ( newTop < 0 ) {\r\n                    newHeight = newHeight + newTop;\r\n                    newTop = 0;\r\n\r\n                    if ( cropRate ) {\r\n                        newWidth = (newHeight - BORDER_PIX) * cropRate + BORDER_PIX;\r\n                    }\r\n                }\r\n            } else if ( !newHeight ) {\r\n                newHeight = offsetHeight + movementY;\r\n\r\n                if ( newHeight + offsetTop > maxPos.height ) {\r\n                    newHeight = maxPos.height - offsetTop;\r\n\r\n                    if ( cropRate ) {\r\n                        newWidth = (newHeight - BORDER_PIX) * cropRate + BORDER_PIX;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if ( isNaN(newLeft) ) newLeft =  offsetLeft;\r\n            if ( isNaN(newTop) ) newTop = offsetTop;\r\n\r\n            if ( cropRate ) {\r\n                if ( newLeft + newWidth < maxPos.width ) {\r\n                    newHeight = (newWidth - BORDER_PIX) / cropRate + BORDER_PIX;\r\n                } else if ( newTop + newHeight < maxPos.height ) {\r\n                    newWidth = (newHeight - BORDER_PIX) * cropRate + BORDER_PIX;\r\n                }\r\n            }\r\n\r\n            if ( newLeft != offsetLeft ) cropStyle.left = newLeft + \"px\";\r\n            if ( newTop != offsetTop ) cropStyle.top = newTop + \"px\";\r\n            if ( newWidth != offsetWidth ) cropStyle.width = newWidth + \"px\";\r\n            if ( newHeight != offsetHeight ) cropStyle.height = newHeight + \"px\";\r\n\r\n            runFunction(editorObj.onMovingCrop, editorObj, []);\r\n        }\r\n\r\n        clearTimeout(moveTimer);\r\n        moveTimer = setTimeout(moveEnd, 1000);\r\n    }\r\n\r\n    wrapper.onmouseup = moveEnd;\r\n\r\n    function moveEnd() {\r\n        isMove = false;\r\n        isResize = false;\r\n\r\n        clearTimeout(moveTimer);\r\n    }\r\n\r\n    picture.onload = function ( e ) {\r\n        adjustSize();\r\n\r\n        crop.style.display = \"none\";\r\n\r\n        canvas.draw(canvas.texture(this)).update();\r\n    }\r\n\r\n    picture.error = function ( e ) {\r\n        console.log(e);\r\n    }\r\n\r\n    window.onresize = function ( e ) {\r\n        adjustSize ();\r\n    }\r\n\r\n    function adjustSize () {\r\n        let pWidth = picture.width,\r\n            pHeight = picture.height,\r\n            pRate = parseFloat((pWidth / pHeight).toFixed(2));\r\n\r\n        let sStyle = source.style,\r\n            cStyle = crop.style;\r\n\r\n        sStyle.width = pWidth + BORDER_PIX + \"px\";\r\n        sStyle.height = pHeight + BORDER_PIX + \"px\";\r\n\r\n        let sWidth = source.clientWidth - BORDER_PIX,\r\n            sHeight = source.clientHeight - BORDER_PIX,\r\n            sRate = parseFloat((sWidth / sHeight).toFixed(2));\r\n\r\n        // 如果外层宽高比例与图片不一致，则需要校正\r\n        if ( pRate != sRate ) {\r\n            if ( sRate > pRate ) {\r\n                sStyle.width = sHeight * pRate + BORDER_PIX + \"px\";\r\n            } else {\r\n                sStyle.height = sWidth / pRate + BORDER_PIX + \"px\";\r\n            }\r\n        }\r\n\r\n        if ( cStyle.display == 'block' ) {\r\n            const cropRate = editorObj.cropRate;\r\n\r\n            cStyle.left = cStyle.top = 0;\r\n            cStyle.width = cStyle.height = \"100%\";\r\n\r\n            if ( cropRate && pRate != cropRate ) {\r\n                if ( pRate > cropRate ) {\r\n                    cStyle.width = crop.clientHeight * cropRate + BORDER_PIX + 'px';\r\n                } else {\r\n                    cStyle.height = crop.clientWidth / cropRate + BORDER_PIX + 'px';\r\n                }\r\n            }\r\n\r\n            runFunction(editorObj.onMovingCrop, editorObj, []);\r\n        }\r\n    }\r\n}\r\n\r\nexport default class PicTune {\r\n    constructor(options = {}) {\r\n        Object.assign(this, {\r\n            id: '',\r\n            element: '',\r\n            width: '',\r\n            height: '400px',\r\n            url: '',\r\n            output: '',\r\n            file: {},\r\n            onMovingCrop () {},\r\n        }, options);\r\n\r\n        const wrapper = this.element || document.getElementById(this.id);\r\n        const source = document.createElement('div');\r\n        const picture = document.createElement('img');\r\n        const showImage = document.createElement('img');\r\n        const canvas = fx.canvas();\r\n        const crop = document.createElement('div');\r\n        const originImage = new Image();\r\n\r\n        this.wrapper = wrapper;\r\n        this.source = source;\r\n        this.picture = picture;\r\n        this.showImage = showImage;\r\n        this.canvas = canvas;\r\n        this.crop = crop;\r\n        this.originImage = originImage;\r\n\r\n        wrapper.className = 'image-editor-wrapper';\r\n\r\n        source.className = 'image-editor-source';\r\n\r\n        picture.className = 'image-editor-picture';\r\n\r\n        showImage.className = 'image-editor-show';\r\n        showImage.style.display = 'none';\r\n\r\n        canvas.className = 'image-editor-canvas';\r\n        canvas.innerText = '你的浏览器不支持HTML5.';\r\n\r\n        crop.style.display = \"none\";\r\n\r\n        crop.className = 'image-editor-crop';\r\n        crop.innerHTML = \r\n            '<div class=\"editor-crop-left editor-crop-top\"></div>' +\r\n            '<div class=\"editor-crop-right editor-crop-top\"></div>' +\r\n            '<div class=\"editor-crop-left editor-crop-bottom\"></div>' +\r\n            '<div class=\"editor-crop-right editor-crop-bottom\"></div>';\r\n\r\n        source.appendChild(picture);\r\n        source.appendChild(canvas);\r\n        source.appendChild(showImage);\r\n        source.appendChild(crop);\r\n\r\n        wrapper.appendChild(source);\r\n\r\n        if ( this.width ) wrapper.style.width = this.width;\r\n        if ( this.height ) {\r\n            wrapper.style.height = this.height;\r\n            wrapper.style['line-height'] = this.height;\r\n        }\r\n        if ( options.url ) this.loadAsUrl( options.url );\r\n\r\n        bindEvents(this);\r\n    }\r\n\r\n    /**\r\n     * 加载图片http路径\r\n     * @param  {String} url http路径字符串\r\n     * @return {Object}     Promise对象\r\n     */\r\n    loadAsUrl ( url ) {\r\n        return http.get({\r\n                url: url,\r\n                type: 'blob'\r\n            })\r\n            .then(data => this.loadAsFile(data));\r\n\r\n    }\r\n\r\n    /**\r\n     * 加载图片数据\r\n     * @param  {Object} file 图片的blob数据\r\n     * @return {Object}      Promise对象\r\n     */\r\n    loadAsFile ( file ) {\r\n        const fr = new FileReader();\r\n        const p = new Promise((resolve, reject) => {\r\n            fr.onload = ( e ) => {\r\n                this.confirm(fr.result);\r\n                this.file = file;\r\n\r\n                this.showImage.style.display = file.type == \"image/gif\" ? 'block' : 'none';\r\n\r\n                resolve();\r\n            };\r\n\r\n        });\r\n\r\n        fr.readAsDataURL(file);\r\n\r\n        return p;\r\n    }\r\n\r\n    /**\r\n     * 确认修改\r\n     * @param  {String} dataurl 图片数据路径\r\n     * @return 无\r\n     */\r\n    confirm ( dataurl ) {\r\n        dataurl = dataurl || this.canvas.toDataURL(this.output || this.file.type);\r\n\r\n        this.picture.src = dataurl;\r\n        this.originImage.src = dataurl;\r\n        this.showImage.src = dataurl;\r\n    }\r\n\r\n    /**\r\n     * 还原修改\r\n     * @return 无\r\n     */\r\n    reset () {\r\n        this.picture.src = this.originImage.src;\r\n    }\r\n\r\n    /**\r\n     * 获取当前图片尺寸\r\n     * @return {Object} 尺寸数据\r\n     */\r\n    getSize () {\r\n        const canvas = this.canvas;\r\n\r\n        return {\r\n            width: canvas.width,\r\n            height: canvas.height\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 切换裁切框的显示/隐藏\r\n     * @param  {Boolean} toggle 显示/隐藏\r\n     * @param  {Number}  rate   比例\r\n     * @return {Boolean}        显示/隐藏\r\n     */\r\n    toggleCrop ( toggle, rate ) {\r\n        const crop = this.crop;\r\n        const cropRate = this.cropRate = parseFloat((rate || 0).toFixed(2));\r\n\r\n        let cStyle = crop.style,\r\n            isShow = cStyle.display == \"block\";\r\n\r\n        if ( typeof toggle == \"undefined\" ) {\r\n            toggle = !isShow;\r\n        }\r\n\r\n        if ( toggle ) this.showImage.style.display = 'none';\r\n\r\n        cStyle.display = toggle ? \"block\" : \"none\";\r\n        cStyle.left = cStyle.top = 0;\r\n        cStyle.width = cStyle.height = \"100%\";\r\n\r\n        if ( toggle && cropRate ) {\r\n            let cWidth = crop.clientWidth,\r\n                cHeight = crop.clientHeight,\r\n                curRate = parseFloat((cWidth / cHeight).toFixed(2));\r\n\r\n            if ( curRate != cropRate ) {\r\n                if ( curRate > cropRate ) {\r\n                    cStyle.width = cHeight * cropRate + BORDER_PIX + 'px';\r\n                } else {\r\n                    cStyle.height = cWidth / cropRate + BORDER_PIX + 'px';\r\n                }\r\n            }\r\n        }\r\n\r\n        return toggle;\r\n    }\r\n\r\n    /**\r\n     * 获取图片的2D canvas\r\n     * @param  {Number} left   左偏移\r\n     * @param  {Number} top    上偏移\r\n     * @param  {Number} width  宽度\r\n     * @param  {Number} height 高度\r\n     * @return {Object}        2D canvas对象\r\n     */\r\n    get2dCanvas(left = 0, top = 0, width, height) {\r\n        const c = document.createElement('canvas');\r\n        const picture = this.picture;\r\n\r\n        width = width || picture.width;\r\n        height = height || picture.height;\r\n\r\n        c.width = width;\r\n        c.height = height;\r\n\r\n        c.getContext('2d').drawImage(picture, left, top, width, height, 0, 0, width, height);\r\n\r\n        return c;\r\n    }\r\n    /**\r\n     * 裁切框当前位置\r\n     * @return {Object} 位置信息\r\n     */\r\n    getCropPosition () {\r\n        const crop = this.crop;\r\n        const rate = this.picture.height / this.canvas.clientHeight;\r\n\r\n        if ( crop.style.display == 'none' ) {\r\n            return {\r\n                top: 0,\r\n                left: 0,\r\n                height: this.picture.height,\r\n                width: this.picture.width\r\n            }\r\n        } else {\r\n            return {\r\n                top: parseInt(crop.offsetTop * rate),\r\n                left: parseInt(crop.offsetLeft * rate),\r\n                height: parseInt((crop.offsetHeight - BORDER_PIX) * rate),\r\n                width: parseInt((crop.offsetWidth - BORDER_PIX) * rate)\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * 确认裁切\r\n     */\r\n    setCrop () {\r\n        const postion = this.getCropPosition();\r\n\r\n        this.confirm(this.get2dCanvas(postion.left, postion.top, postion.width, postion.height).toDataURL(this.output || this.file.type));\r\n    }\r\n    /**\r\n     * 旋转\r\n     * @param  {Number}  angle      旋转的角度\r\n     * @param  {Boolean} isTurnOver 旋转以后是否水平翻转\r\n     */\r\n    rotate ( angle, isTurnOver ) {\r\n        const picture = this.picture;\r\n\r\n        this.showImage.style.display = 'none';\r\n\r\n        let c = this.get2dCanvas(),\r\n            c2 = c.getContext('2d'),\r\n            pW = picture.width,\r\n            pH = picture.height,\r\n            cX = 0, \r\n            cY = 0,\r\n            type;\r\n\r\n        angle = angle % 360 + ( angle < 0 ? 360 : 0 );\r\n\r\n        if ( angle > 0 ) {\r\n            let A = angle * Math.PI / 180,\r\n                sinA = Math.abs(Math.sin(A).toFixed(2)),\r\n                cosA = Math.abs(Math.cos(A).toFixed(2));\r\n\r\n            c.width = pH * sinA + pW * cosA;\r\n            c.height = pH * cosA + pW * sinA;\r\n\r\n            if ( angle <= 90 ) {\r\n                cX = pH * sinA * cosA;\r\n                cY = -(pH * sinA * sinA);\r\n            } else if ( angle > 90 && angle <= 180 ) {\r\n                cX = -(pW * cosA * cosA);\r\n                cY = -(pW * cosA * sinA + pH);\r\n            } else if ( angle > 180 && angle <= 270  ) {\r\n                cX = -(pH * cosA * sinA + pW);\r\n                cY = -(pH * cosA * cosA);\r\n            } else {\r\n                cX = -(pW * sinA * sinA);\r\n                cY = -(pW * sinA * cosA);\r\n            }\r\n\r\n\r\n            c2.rotate(A);\r\n        }\r\n\r\n        c2.drawImage(picture, cX, cY);\r\n\r\n        if ( isTurnOver ) turnOver(c, isTurnOver);\r\n\r\n        this.picture.src = c.toDataURL(this.output || this.file.type);\r\n        // this.confirm(c.toDataURL(this.output || this.file.type));\r\n    }\r\n    /**\r\n     * 基础参数调节\r\n     * @param  {Number} brightness 亮度 -1~1\r\n     * @param  {Number} contrast   对比度 -1~1\r\n     * @param  {Number} saturation 色彩饱和度 -1~1\r\n     * @param  {Number} radius     清晰度 -10~10\r\n     */\r\n    base ( brightness = 0, contrast = 0, saturation = 0, radius = 0 ) {\r\n        const canvas = this.canvas;\r\n\r\n        this.showImage.style.display = 'none';\r\n\r\n        canvas.draw(canvas.texture(this.originImage)).brightnesscontrastSaturationBur([brightness, contrast, saturation, radius]).update();\r\n    }\r\n    /**\r\n     * 色彩调节\r\n     * @param  {Number} hue         色相\r\n     * @param  {Number} greenRed    绿红\r\n     * @param  {Number} purpleGreen 紫绿\r\n     * @param  {Number} yellowBlue  黄蓝\r\n     */\r\n    huaColor ( hue = 0, greenRed = 0, purpleGreen = 0, yellowBlue = 0 ) {\r\n        const canvas = this.canvas;\r\n\r\n        this.showImage.style.display = 'none';\r\n\r\n        canvas.draw(canvas.texture(this.originImage)).hueColor([hue, greenRed, purpleGreen, yellowBlue]).update();\r\n    }\r\n    /**\r\n     * 输出图像\r\n     * @param  {Number}  width  宽度\r\n     * @param  {Number}  height 高度\r\n     * @param  {Boolean} isBlob 是否转为二进制数据\r\n     * @return {Object}         图像数据\r\n     */\r\n    getData ( width, height, isBlob ) {\r\n        const picture = this.picture;\r\n        const postion = this.getCropPosition();\r\n\r\n        let type = this.output || this.file.type,\r\n            c = this.get2dCanvas(postion.left, postion.top, postion.width, postion.height),\r\n            data = null;\r\n\r\n        width = width || picture.width;\r\n        height = height || picture.height;\r\n\r\n        if ( width != postion.width || height != postion.height ) {\r\n            data = scale({\r\n                width: parseInt(width),\r\n                height: parseInt(height),\r\n            }, c).toDataURL(type);\r\n        } else {\r\n            data = c.toDataURL(type);\r\n        }\r\n\r\n        if ( isBlob ) data = convertDataurlToBlob(data, type);\r\n\r\n        return data;\r\n    }\r\n    /**\r\n     * 下载图像到本地\r\n     * @param  {Number}  width  宽度\r\n     * @param  {Number}  height 高度\r\n     */\r\n    download ( width, height ) {\r\n        const originImage = this.originImage;\r\n\r\n        let aLink = document.createElement('a'),\r\n            evt = document.createEvent('MouseEvents'),\r\n            type = (this.output || this.file.type).split(\"/\")[1] || 'jpg';\r\n\r\n        width = width || originImage.width;\r\n        height = height || originImage.height;\r\n\r\n        aLink.href = this.getData(width, height);\r\n        aLink.download = `${width}x${height}.${type}`;\r\n\r\n        evt.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0);\r\n\r\n        aLink.dispatchEvent(evt);\r\n    }\r\n    /**\r\n     * 上传图片\r\n     * @param  {Object} params 上传参数\r\n     * @return {Object}        Promise对象\r\n     */\r\n    upload ( params ) {\r\n        let formData = new FormData(),\r\n            formKey = params.formKey || 'fileToUpload',\r\n            options = {\r\n            url: params.url,\r\n            type: 'json',\r\n            data: formData\r\n        };\r\n\r\n        if ( params.isOrigin ) {\r\n            formData.append(formKey, this.file);\r\n        } else {\r\n            formData.append(formKey, this.getData(params.width, params.height, true));\r\n        }\r\n\r\n        return http.post(options);\r\n    }\r\n}\r\n\r\n/* istanbul ignore if */\r\nif (typeof window !== 'undefined' && window.Vue) {\r\n    window.PicTune = PicTune;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/main.js","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../node_modules/_css-loader@0.28.11@css-loader/index.js!./main.css\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar update = require(\"!../node_modules/_vue-style-loader@3.1.2@vue-style-loader/lib/addStylesClient.js\")(\"6abb4a33\", content, true, {});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/main.css\n// module id = 1\n// module chunks = 0","exports = module.exports = require(\"../node_modules/_css-loader@0.28.11@css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".image-editor-wrapper{user-select:none;position:relative;text-align:center;width:100%;min-height:400px;line-height:400px;overflow:hidden;background-color:#fff}.image-editor-source{position:relative;display:inline-block;max-width:90%;max-height:80%;vertical-align:middle}.image-editor-picture{position:absolute;left:2px;top:2px;visibility:hidden}.image-editor-canvas,.image-editor-show{position:absolute;left:2px;top:2px;width:calc(100% - 4px);height:calc(100% - 4px)}.image-editor-crop{position:absolute;left:0;top:0;width:100%;height:100%;cursor:move}.image-editor-crop:before{position:absolute;content:\\\" \\\";left:-1px;top:-1px;width:100%;height:100%;border:1px solid #ff8181}.image-editor-crop:after{display:block;margin:1px;content:\\\" \\\";width:calc(100% - 4px);height:calc(100% - 4px);border:1px solid #ff8181}.image-editor-crop div{position:absolute;width:10px;height:10px;border-radius:10px;border:2px solid #f2060d;background-color:#e6b9b9}.editor-crop-left{left:-6px}.editor-crop-right{right:-6px}.editor-crop-top{top:-6px}.editor-crop-bottom{bottom:-6px}.editor-crop-left.editor-crop-top{cursor:nw-resize}.editor-crop-left.editor-crop-bottom{cursor:sw-resize}.editor-crop-right.editor-crop-top{cursor:ne-resize}.editor-crop-right.editor-crop-bottom{cursor:se-resize}\", \"\"]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_css-loader@0.28.11@css-loader!./src/main.css\n// module id = 2\n// module chunks = 0","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_css-loader@0.28.11@css-loader/lib/css-base.js\n// module id = 3\n// module chunks = 0","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\nvar listToStyles = require('./listToStyles')\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nmodule.exports = function (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-style-loader@3.1.2@vue-style-loader/lib/addStylesClient.js\n// module id = 4\n// module chunks = 0","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nmodule.exports = function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-style-loader@3.1.2@vue-style-loader/lib/listToStyles.js\n// module id = 5\n// module chunks = 0","/**\r\n * High-quality scale function for canvas or image element\r\n * @param {Number|Object} scale\r\n * @param {Canvas|Image} input\r\n * @param {Canvas|String} [output]\r\n *   if Canvas or undefined, export by canvas\r\n *   if export == 'png', export by Image png\r\n *   if export == 'jpeg', export by Image jpeg\r\n *   if export == 'png-src', export by base64 png string\r\n *   if export == 'jpeg-src', export by base64 jpeg string\r\n * @param {Boolean} [inputRemovable]\r\n *   if not true, original canvas is kept\r\n *   if true, original canvas is not kept\r\n * @return {Canvas|String|Image|Boolean}\r\n *   if error, return false\r\n */\r\nexport function scale (scale, input, output, inputRemovable) {\r\n\tif (!input) {\r\n\t\tinput = scale.input\r\n\t\toutput = scale.output\r\n\t\tinputRemovable = scale.inputRemovable\r\n\t\tif (scale.scale) scale = scale.scale\r\n\t}\r\n\r\n\tvar HAS_ALPHA = true\r\n\tvar canvas, ctx\r\n\tif (input.src) {\r\n\t\tcanvas = document.createElement('canvas')\r\n\t\tif (input.naturalWidth != null) {\r\n\t\t\tcanvas.width = input.naturalWidth\r\n\t\t\tcanvas.height = input.naturalHeight\r\n\t\t} else if (input.runtimeStyle != null) {\r\n\t\t\tvar runtimeStyle = input.runtimeStyle\r\n\t\t\t  , mw = runtimeStyle.width, mh = runtimeStyle.height\r\n\t\t\truntimeStyle.width = 'auto'\r\n\t\t\truntimeStyle.height = 'auto'\r\n\t\t\tcanvas.width = input.width\r\n\t\t\tcanvas.height = input.height\r\n\t\t\truntimeStyle.width = mw\r\n\t\t\truntimeStyle.height = mh\r\n\t\t} else {\r\n\t\t\tvar mw = input.width, mh = input.height\r\n\t\t\tif (input.removeAttribute) {\r\n\t\t\t\tinput.removeAttribute('width')\r\n\t\t\t\tinput.removeAttribute('height')\r\n\t\t\t}\r\n\t\t\tcanvas.width = input.width\r\n\t\t\tcanvas.height = input.height\r\n\t\t\tinput.width = mw\r\n\t\t\tinput.height = mh\r\n\t\t}\r\n\t} else {\r\n\t\tcanvas = input\r\n\t}\r\n\tctx = canvas.getContext('2d')\r\n\tif (input.src) ctx.drawImage(input, 0, 0)\r\n\tvar sw = canvas.width, sh = canvas.height\r\n\t\t, dw, dh\r\n\t\t, sourceBuffer = ctx.getImageData(0, 0, sw, sh).data\r\n\r\n\tif (!sw || !sh ) return false\r\n\tif (input.src || inputRemovable) {\r\n\t\tcanvas.clearRect(0, 0, sw, sh)\r\n\t}\r\n\tif (typeof scale === 'object') {\r\n\t\tif (scale.width) {\r\n\t\t\tdw = scale.width + 0.5 | 0\r\n\t\t\tdh = scale.height + 0.5 | 0\r\n\t\t} else {\r\n\t\t\tdw = sw * scale.scaleX + 0.5 | 0\r\n\t\t\tdh = sh * scale.scaleY + 0.5 | 0\r\n\t\t}\r\n\t} else {\r\n\t\tdw = scale * sw + 0.5 | 0\r\n\t\tdh = scale * sh + 0.5 | 0\r\n\t}\r\n\tvar dw4 = dw << 2\r\n\t\t, sw4 = sw << 2\r\n\t\t, sx, sy, sindex = 0\r\n\t\t, dx, dy, dyindex, dindex = 0\r\n\t\t, idx, idy, isx, isy\r\n\t\t, w, wx, nwx, wy, nwy\r\n\t\t, crossX, crossY\r\n\t\t, dwh4 = dw4 * dh\r\n\t\t, tmpBuffer\r\n\t\t, r, g, b, a\r\n\t\t, dsy, dsx\r\n\t\t, newCanvas, newCtx, imageData, byteBuffer\r\n\t\t, TIMES = 255.99 / 255\r\n\t\t, row0, row1, row2, row3\r\n\t\t, col0, col1, col2, col3\r\n\t\t, scaleX = dw / sw\r\n\t\t, scaleY = dh / sh\r\n\t\t, scaleXY = scaleX * scaleY\r\n\r\n\tfunction setNewCanvas() {\r\n\t\t// CREATE downscale canvas\r\n\t\tif (typeof output === 'object') {\r\n\t\t\tnewCanvas = output\r\n\t\t} else if (input.src || inputRemovable) {\r\n\t\t\tnewCanvas = canvas\r\n\t\t} else {\r\n\t\t\tnewCanvas = document.createElement('canvas')\r\n\t\t}\r\n\t\tnewCanvas.width = dw\r\n\t\tnewCanvas.height = dh\r\n\t\tnewCtx = newCanvas.getContext('2d')\r\n\t}\r\n\tfunction getImageData(tmpBuffer) {\r\n\t\tif (!tmpBuffer) {\r\n\t\t\treturn newCtx.getImageData(0, 0, dw, dh)\r\n\t\t} else {\r\n\t\t\tvar imageData = newCtx.getImageData(0, 0, dw, dh)\r\n\t\t\t\t, byteBuffer = imageData.data\r\n\t\t\t\t, dindex\r\n\t\t\tfor (dindex = 0; dindex < dwh4; dindex += 4) {\r\n\t\t\t\tbyteBuffer[dindex    ] = tmpBuffer[dindex    ] * TIMES | 0\r\n\t\t\t\tbyteBuffer[dindex + 1] = tmpBuffer[dindex + 1] * TIMES | 0\r\n\t\t\t\tbyteBuffer[dindex + 2] = tmpBuffer[dindex + 2] * TIMES | 0\r\n\t\t\t\tbyteBuffer[dindex + 3] = HAS_ALPHA ? tmpBuffer[dindex + 3] * TIMES | 0 : 255\r\n\t\t\t}\r\n\t\t\t// delete tmpBuffer\r\n\t\t\treturn imageData\r\n\t\t}\r\n\t}\r\n\r\n\tif (scaleX > 1 || scaleY > 1) {\r\n\t\t// UPSCALE by bicubic\r\n\t\tfunction bicubic (t, a, b, c, d) {\r\n\t\t\treturn 0.5 * (c - a + (2 * a - 5 * b + 4 * c - d + (3 * (b - c) + d - a) * t) * t) * t + b\r\n\t\t}\r\n\t\tsetNewCanvas()\r\n\t\timageData = getImageData()\r\n\t\tbyteBuffer = imageData.data\r\n\t\tfor (dy = 0; dy < dh; dy++) {\r\n\t\t\tsy = dy / scaleY\r\n\t\t\tisy = sy | 0\r\n\t\t\tdsy = sy - isy\r\n\t\t\trow1 = isy * sw4\r\n\t\t\trow0 = isy < 1 ? row1 : row1 - sw4\r\n\t\t\tif (isy < sh - 2) {\r\n\t\t\t\trow2 = row1 + sw4\r\n\t\t\t\trow3 = (isy + 2) * sw4\r\n\t\t\t} else {\r\n\t\t\t\trow2 = row3 = isy > sh - 2 ? row1 : row1 + sw4\r\n\t\t\t}\r\n\r\n\t\t\tfor (dx = 0; dx < dw; dx++, dindex += 4) {\r\n\t\t\t\tsx = dx / scaleX\r\n\t\t\t\tisx = sx | 0\r\n\t\t\t\tdsx = sx - isx\r\n\t\t\t\tcol1 = isx << 2\r\n\t\t\t\tcol0 = isx < 1 ? col1 : col1 - 4\r\n\t\t\t\tif (isx < sw - 2) {\r\n\t\t\t\t\tcol2 = col1 + 4\r\n\t\t\t\t\tcol3 = col1 + 8\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcol2 = col3 = isx > sw - 2 ? col1 : col1 + 4\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// RED\r\n\t\t\t\tr = bicubic(dsy,\r\n\t\t\t\t\t\t\tbicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t) * TIMES | 0\r\n\r\n\t\t\t\t// GREEN\r\n\t\t\t\t++col0, ++col1, ++col2, ++col3\r\n\t\t\t\tg = bicubic(dsy,\r\n\t\t\t\t\t\t\tbicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t) * TIMES | 0\r\n\r\n\t\t\t\t// BLUE\r\n\t\t\t\t++col0, ++col1, ++col2, ++col3\r\n\t\t\t\tb = bicubic(dsy,\r\n\t\t\t\t\t\t\tbicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row0 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row1 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row2 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col0]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col1]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col2]\r\n\t\t\t\t\t\t\t, sourceBuffer[row3 + col3]\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t) * TIMES | 0\r\n\r\n\t\t\t\tbyteBuffer[dindex    ] = r >= 0 ? r < 256 ? r : 255 : 0\r\n\t\t\t\tbyteBuffer[dindex + 1] = g >= 0 ? g < 256 ? g : 255 : 0\r\n\t\t\t\tbyteBuffer[dindex + 2] = b >= 0 ? b < 256 ? b : 255 : 0\r\n\r\n\t\t\t\tif (HAS_ALPHA) {\r\n\t\t\t\t\t// ALPHA\r\n\t\t\t\t\t++col0, ++col1, ++col2, ++col3\r\n\t\t\t\t\ta = bicubic(dsy,\r\n\t\t\t\t\t\t\t\tbicubic(dsx\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row0 + col0]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row0 + col1]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row0 + col2]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row0 + col3]\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row1 + col0]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row1 + col1]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row1 + col2]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row1 + col3]\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row2 + col0]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row2 + col1]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row2 + col2]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row2 + col3]\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t, bicubic(dsx\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row3 + col0]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row3 + col1]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row3 + col2]\r\n\t\t\t\t\t\t\t\t, sourceBuffer[row3 + col3]\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t) * TIMES | 0\r\n\t\t\t\t\tbyteBuffer[dindex + 3] = a >= 0 ? a < 256 ? a : 255 : 0\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbyteBuffer[dindex + 3] = 255\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t// DOWNSCALE\r\n\t\tif (Float32Array) {\r\n\t\t\ttmpBuffer = new Float32Array(dwh4)\r\n\t\t} else {\r\n\t\t\ttmpBuffer = []\r\n\t\t\tfor (dindex = 0; dindex < dwh4; ++dindex) {\r\n\t\t\t\ttmpBuffer[dindex] = 0\r\n\t\t\t}\r\n\t\t}\r\n\t\t// CREATE float buffer\r\n\t\tfor (sy = 0; sy < sh; sy++) {\r\n\t\t\tdy = sy * scaleY\r\n\t\t\tidy = dy | 0\r\n\t\t\tdyindex = idy * dw4\r\n\t\t\tcrossY = (!!((idy - (dy + scaleY | 0)) * (sh - 1 - sy))) << 1\r\n\t\t\tif (crossY) {\r\n\t\t\t\twy = idy + 1 - dy\r\n\t\t\t\tnwy = dy + scaleY - idy - 1\r\n\t\t\t}\r\n\t\t\tfor (sx = 0; sx < sw; sx++, sindex += 4) {\r\n\t\t\t\tdx = sx * scaleX\r\n\t\t\t\tidx = dx | 0\r\n\t\t\t\tdindex = dyindex + (idx << 2)\r\n\t\t\t\tcrossX = !!((idx - (dx + scaleX | 0)) * (sw - 1 - sx))\r\n\t\t\t\tif (crossX) {\r\n\t\t\t\t\twx = idx + 1 - dx\r\n\t\t\t\t\tnwx = dx + scaleX - idx - 1\r\n\t\t\t\t}\r\n\t\t\t\tr = sourceBuffer[sindex    ]\r\n\t\t\t\tg = sourceBuffer[sindex + 1]\r\n\t\t\t\tb = sourceBuffer[sindex + 2]\r\n\t\t\t\tif (HAS_ALPHA) a = sourceBuffer[sindex + 3]\r\n\t\t\t\tswitch (crossX + crossY) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\ttmpBuffer[dindex    ] += r * scaleXY\r\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * scaleXY\r\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * scaleXY\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * scaleXY\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tw = wx * scaleY\r\n\t\t\t\t\t\ttmpBuffer[dindex    ] += r * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w\r\n\t\t\t\t\t\tw = nwx * scaleY\r\n\t\t\t\t\t\ttmpBuffer[dindex + 4] += r * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 5] += g * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 6] += b * w\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 7] += a * w\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tw = scaleX * wy\r\n\t\t\t\t\t\ttmpBuffer[dindex    ] += r * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w\r\n\t\t\t\t\t\tw = scaleX * nwy\r\n\t\t\t\t\t\tdindex += dw4\r\n\t\t\t\t\t\ttmpBuffer[dindex    ] += r * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tw = wx * wy\r\n\t\t\t\t\t\ttmpBuffer[dindex    ] += r * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w\r\n\t\t\t\t\t\tw = nwx * wy\r\n\t\t\t\t\t\ttmpBuffer[dindex + 4] += r * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 5] += g * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 6] += b * w\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 7] += a * w\r\n\t\t\t\t\t\tw = wx * nwy\r\n\t\t\t\t\t\tdindex += dw4\r\n\t\t\t\t\t\ttmpBuffer[dindex    ] += r * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 1] += g * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 2] += b * w\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 3] += a * w\r\n\t\t\t\t\t\tw = nwx * nwy\r\n\t\t\t\t\t\ttmpBuffer[dindex + 4] += r * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 5] += g * w\r\n\t\t\t\t\t\ttmpBuffer[dindex + 6] += b * w\r\n\t\t\t\t\t\tif (HAS_ALPHA) tmpBuffer[dindex + 7] += a * w\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// delete sourceBuffer\r\n\t\tsetNewCanvas()\r\n\t\timageData = getImageData(tmpBuffer)\r\n\t}\r\n\r\n\tnewCtx.putImageData(imageData, 0, 0)\r\n\tif (typeof output === 'string') {\r\n\t\tif (output === 'png' || output === 'jpeg') {\r\n\t\t\tvar img\r\n\t\t\tif (inputRemovable && input.src) {\r\n\t\t\t\timg = input\r\n\t\t\t} else {\r\n\t\t\t\timg = new Image()\r\n\t\t\t}\r\n\t\t\timg.width = dw\r\n\t\t\timg.height = dh\r\n\t\t\timg.src = newCanvas.toDataURL('image/' + output, 1)\r\n\t\t\treturn img\r\n\t\t} else if (output === 'png-src' || output === 'jpeg-src') {\r\n\t\t\treturn newCanvas.toDataURL('image/' + output.split('-')[0], 1)\r\n\t\t}\r\n\t}\r\n\treturn newCanvas\r\n}// scale function end\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/scale.js","/*\r\n * glfx.js\r\n * http://evanw.github.com/glfx.js/\r\n *\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n */\r\n\r\nexport const fx = function() {\r\n    var exports = {};\r\n    var gl;\r\n\r\n    function clamp(lo, value, hi) {\r\n        return Math.max(lo, Math.min(value, hi));\r\n    }\r\n\r\n    function wrapTexture(texture) {\r\n        return {\r\n            _: texture,\r\n            loadContentsOf: function(element) {\r\n                // 确保我们使用正确的全局WebGL上下文\r\n                gl = this._.gl;\r\n                this._.loadContentsOf(element);\r\n            },\r\n            destroy: function() {\r\n                // 确保我们使用正确的全局WebGL上下文\r\n                gl = this._.gl;\r\n                this._.destroy();\r\n            }\r\n        };\r\n    }\r\n\r\n    function texture(element) {\r\n        return wrapTexture(Texture.fromElement(element));\r\n    }\r\n\r\n    function initialize(width, height) {\r\n        var type = gl.UNSIGNED_BYTE;\r\n\r\n        // 去到浮点缓冲textures，如果我们可以，它会使散景滤镜看起来好多了。 请注意，在Windows上，当启用线性滤镜时，ANGLE不允许您呈现为浮点textures。\r\n        // Go for floating point buffer textures if we can, it'll make the bokeh\r\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n        // render to a floating-point texture when linear filtering is enabled.\r\n        // See http://crbug.com/172278 for more information.\r\n        if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\r\n            var testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\r\n            try {\r\n                // 只有使用gl.FLOAT，如果我们可以渲染到它\r\n                testTexture.drawTo(function() { type = gl.FLOAT; });\r\n            } catch (e) {}\r\n            testTexture.destroy();\r\n        }\r\n\r\n        if (this._.texture) this._.texture.destroy();\r\n        if (this._.spareTexture) this._.spareTexture.destroy();\r\n        this.width = width;\r\n        this.height = height;\r\n        this._.texture = new Texture(width, height, gl.RGBA, type);\r\n        this._.spareTexture = new Texture(width, height, gl.RGBA, type);\r\n        this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\r\n        this._.flippedShader = this._.flippedShader || new Shader(null, '\\\r\n\t        uniform sampler2D texture;\\\r\n\t        varying vec2 texCoord;\\\r\n\t        void main() {\\\r\n\t            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\r\n\t        }\\\r\n\t    ');\r\n        this._.isInitialized = true;\r\n    }\r\n\r\n    /*\r\n      在画布上绘制texture，可选择宽度和高度进行缩放。如果没有给出宽度和高度，则原始texture宽度和高度使用。\r\n    */\r\n    function draw(texture, width, height) {\r\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n        }\r\n\r\n        texture._.use();\r\n        this._.texture.drawTo(function() {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    function update() {\r\n        this._.texture.use();\r\n        this._.flippedShader.drawRect();\r\n        return this;\r\n    }\r\n\r\n    function simpleShader(shader, uniforms, textureIn, textureOut) {\r\n        (textureIn || this._.texture).use();\r\n        this._.spareTexture.drawTo(function() {\r\n            shader.uniforms(uniforms).drawRect();\r\n        });\r\n        this._.spareTexture.swapWith(textureOut || this._.texture);\r\n    }\r\n\r\n    function replace(node) {\r\n        node.parentNode.insertBefore(this, node);\r\n        node.parentNode.removeChild(node);\r\n        return this;\r\n    }\r\n\r\n    function contents() {\r\n        var texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        this._.texture.use();\r\n        texture.drawTo(function() {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n        return wrapTexture(texture);\r\n    }\r\n\r\n    /*\r\n       获取一个Uint8的像素值数组: [r, g, b, a, r, g, b, a, ...]\r\n       数组的长度是 width * height * 4.\r\n    */\r\n    function getPixelArray() {\r\n        var w = this._.texture.width;\r\n        var h = this._.texture.height;\r\n        var array = new Uint8Array(w * h * 4);\r\n        this._.texture.drawTo(function() {\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n        });\r\n        return array;\r\n    }\r\n\r\n    function wrap(func) {\r\n        return function() {\r\n            // 确保我们使用正确的全局WebGL上下文\r\n            gl = this._.gl;\r\n\r\n            // 现在上下文已经切换，我们可以调用包装函数\r\n            return func.apply(this, arguments);\r\n        };\r\n    }\r\n\r\n\r\n    // from javax.media.jai.PerspectiveTransform\r\n\r\n    function getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\r\n        var dx1 = x1 - x2;\r\n        var dy1 = y1 - y2;\r\n        var dx2 = x3 - x2;\r\n        var dy2 = y3 - y2;\r\n        var dx3 = x0 - x1 + x2 - x3;\r\n        var dy3 = y0 - y1 + y2 - y3;\r\n        var det = dx1 * dy2 - dx2 * dy1;\r\n        var a = (dx3 * dy2 - dx2 * dy3) / det;\r\n        var b = (dx1 * dy3 - dx3 * dy1) / det;\r\n        return [\r\n            x1 - x0 + a * x1, y1 - y0 + a * y1, a,\r\n            x3 - x0 + b * x3, y3 - y0 + b * y3, b,\r\n            x0, y0, 1\r\n        ];\r\n    }\r\n\r\n    function getInverse(m) {\r\n        var a = m[0],\r\n            b = m[1],\r\n            c = m[2];\r\n        var d = m[3],\r\n            e = m[4],\r\n            f = m[5];\r\n        var g = m[6],\r\n            h = m[7],\r\n            i = m[8];\r\n        var det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n        return [\r\n            (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\r\n            (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\r\n            (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det\r\n        ];\r\n    }\r\n\r\n    function multiply(a, b) {\r\n        return [\r\n            a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\r\n            a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\r\n            a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\r\n            a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\r\n            a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\r\n            a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\r\n            a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\r\n            a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\r\n            a[6] * b[2] + a[7] * b[5] + a[8] * b[8]\r\n        ];\r\n    }\r\n\r\n    function warpShader(uniforms, warp) {\r\n        return new Shader(null, uniforms + '\\\r\n\t    uniform sampler2D texture;\\\r\n\t    uniform vec2 texSize;\\\r\n\t    varying vec2 texCoord;\\\r\n\t    void main() {\\\r\n\t        vec2 coord = texCoord * texSize;\\\r\n\t        ' + warp + '\\\r\n\t        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n\t        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n\t        if (coord != clampedCoord) {\\\r\n\t            /* fade to transparent if we are outside the image */\\\r\n\t            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n\t        }\\\r\n\t    }');\r\n    }\r\n    /**\r\n     * @filter           Hue / Saturation\r\n     * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n     *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n     *                   values. Hue changing works by rotating the color vector around the grayscale\r\n     *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n     *                   Saturation is implemented by scaling all color channel values either toward\r\n     *                   or away from the average color channel value.\r\n     * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n     *                   and 1 is 180 degree rotation in the positive direction)\r\n     * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     */\r\n    function hueColor(args) {\r\n        var hue = args[0],\r\n        greenRed = args[1],\r\n        purpleGreen = args[2],\r\n        yellowBlue = args[3];\r\n        gl.hueColor = gl.hueColor || new Shader(null, '\\\r\n\t        uniform sampler2D texture;\\\r\n\t        uniform float hue;\\\r\n\t        uniform float greenRed;\\\r\n\t        uniform float purpleGreen;\\\r\n\t        uniform float yellowBlue;\\\r\n\t        varying vec2 texCoord;\\\r\n\t        void main() {\\\r\n\t            vec4 color = texture2D(texture, texCoord);\\\r\n\t            \\\r\n\t            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n\t            float angle = hue * 3.14159265;\\\r\n\t            float s = sin(angle), c = cos(angle);\\\r\n\t            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n\t            float len = length(color.rgb);\\\r\n\t            color.rgb = vec3(\\\r\n\t                dot(color.rgb, weights.xyz),\\\r\n\t                dot(color.rgb, weights.zxy),\\\r\n\t                dot(color.rgb, weights.yzx)\\\r\n\t            );\\\r\n\t            color.r += greenRed; \\\r\n\t            color.g -= greenRed; \\\r\n\t            color.b -= greenRed; \\\r\n\t            color.r -= purpleGreen; \\\r\n\t            color.g += purpleGreen; \\\r\n\t            color.b -= purpleGreen; \\\r\n\t            color.r -= yellowBlue; \\\r\n\t            color.g -= yellowBlue; \\\r\n\t            color.b += yellowBlue; \\\r\n\t            gl_FragColor = color;\\\r\n\t        }\\\r\n\t    ');\r\n\r\n        simpleShader.call(this, gl.hueColor, {\r\n            hue: clamp(-1, hue, 1),\r\n            greenRed: clamp(-1, greenRed/5, 1),\r\n            purpleGreen: clamp(-1, purpleGreen/5, 1),\r\n            yellowBlue: clamp(-1, yellowBlue/5, 1)               \r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter           Brightness / Contrast/ Saturation / Blur\r\n     * @description      Provides additive brightness and multiplicative contrast control.\r\n     * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n     * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     * @param radius The radius of the pyramid convolved with the image.\r\n     */\r\n    function brightnesscontrastSaturationBur(args) {\r\n        var brightness = args[0],\r\n        contrast = args[1],\r\n        saturation = args[2],\r\n        radius = args[3];\r\n        gl.brightnesscontrastSaturationBur = gl.brightnesscontrastSaturationBur || new Shader(null, '\\\r\n            uniform sampler2D texture;\\\r\n            uniform float brightness;\\\r\n            uniform float contrast;\\\r\n            uniform float saturation;\\\r\n            uniform vec2 delta;\\\r\n            varying vec2 texCoord;\\\r\n            ' + randomShaderFunc + '\\\r\n            void main() {\\\r\n                vec4 color = vec4(0.0);\\\r\n                float total = 0.0;\\\r\n                \\\r\n                /* randomize the lookup values to hide the fixed number of samples */\\\r\n                float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n                \\\r\n                for (float t = -30.0; t <= 30.0; t++) {\\\r\n                    float percent = (t + offset - 0.5) / 30.0;\\\r\n                    float weight = 1.0 - abs(percent);\\\r\n                    vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                    \\\r\n                    /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                    sample.rgb *= sample.a;\\\r\n                    \\\r\n                    color += sample * weight;\\\r\n                    total += weight;\\\r\n                    color.rgb += brightness;\\\r\n                    if (contrast > 0.0) {\\\r\n                        color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n                    } else {\\\r\n                        color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n                    }\\\r\n                    /* saturation adjustment */\\\r\n                    float average = (color.r + color.g + color.b) / 3.0;\\\r\n                    if (saturation > 0.0) {\\\r\n                        color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n                    } else {\\\r\n                        color.rgb += (average - color.rgb) * (-saturation);\\\r\n                    }\\\r\n                }\\\r\n                \\\r\n                gl_FragColor = color / total;\\\r\n                \\\r\n                /* switch back from pre-multiplied alpha */\\\r\n                gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n            }\\\r\n        ');\r\n\r\n        simpleShader.call(this, gl.brightnesscontrastSaturationBur, {\r\n            brightness: clamp(-1, brightness / 10, 1),\r\n            contrast: clamp(-1, contrast / 100, 1),\r\n            saturation: clamp(-1, saturation / 50, 1),\r\n        });\r\n        simpleShader.call(this, gl.brightnesscontrastSaturationBur, {\r\n            delta: [radius / this.width, 0]\r\n        });\r\n        simpleShader.call(this, gl.brightnesscontrastSaturationBur, {\r\n            delta: [0, radius / this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n\r\n    // From: https://github.com/evanw/OES_texture_float_linear-polyfill\r\n    (function() {\r\n        // 上传2x2浮点texture，其中一个像素为2，其他三个像素为0。\r\n        //仅当从texture的中心采样,样本是（2 + 0 + 0 + 0）/ 4 = 0.5时，才支持线性滤波。\r\n        // Linear filtering is only supported if a sample taken\r\n        // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\r\n        function supportsOESTextureFloatLinear(gl) {\r\n            // 首先需要浮点 textures\r\n            if (!gl.getExtension('OES_texture_float')) {\r\n                return false;\r\n            }\r\n\r\n            // 创建渲染目标\r\n            var framebuffer = gl.createFramebuffer();\r\n            var byteTexture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, byteTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\r\n\r\n            // 创建一个在中心且值为0.5的简单浮点Texture\r\n            var rgba = [\r\n                2, 0, 0, 0,\r\n                0, 0, 0, 0,\r\n                0, 0, 0, 0,\r\n                0, 0, 0, 0\r\n            ];\r\n            var floatTexture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\r\n\r\n            // 创建测试着色器\r\n            var program = gl.createProgram();\r\n            var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n            var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n            gl.shaderSource(vertexShader, '\\\r\n\t\t      attribute vec2 vertex;\\\r\n\t\t      void main() {\\\r\n\t\t        gl_Position = vec4(vertex, 0.0, 1.0);\\\r\n\t\t      }\\\r\n\t\t    ');\r\n            gl.shaderSource(fragmentShader, '\\\r\n\t\t      uniform sampler2D texture;\\\r\n\t\t      void main() {\\\r\n\t\t        gl_FragColor = texture2D(texture, vec2(0.5));\\\r\n\t\t      }\\\r\n\t\t    ');\r\n            gl.compileShader(vertexShader);\r\n            gl.compileShader(fragmentShader);\r\n            gl.attachShader(program, vertexShader);\r\n            gl.attachShader(program, fragmentShader);\r\n            gl.linkProgram(program);\r\n\r\n            // 创建一个包含单个点的缓冲区\r\n            var buffer = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\r\n            gl.enableVertexAttribArray(0);\r\n            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n            // 渲染点并读取渲染的像素\r\n            var pixel = new Uint8Array(4);\r\n            gl.useProgram(program);\r\n            gl.viewport(0, 0, 1, 1);\r\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n            gl.drawArrays(gl.POINTS, 0, 1);\r\n            gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\r\n\r\n            // 如果线性滤镜起作用了，中心样本将只有0.5的值\r\n            // The center sample will only have a value of 0.5 if linear filtering works\r\n            return pixel[0] === 127 || pixel[0] === 128;\r\n        }\r\n\r\n        // 返回的扩展对象的构造函数\r\n        function OESTextureFloatLinear() {}\r\n\r\n        // Cache the extension so it's specific to each context like extensions should be\r\n        // 缓存extension，它是特定于每个上下文\r\n        function getOESTextureFloatLinear(gl) {\r\n            if (gl.$OES_texture_float_linear$ === void 0) {\r\n                Object.defineProperty(gl, '$OES_texture_float_linear$', {\r\n                    enumerable: false,\r\n                    configurable: false,\r\n                    writable: false,\r\n                    value: new OESTextureFloatLinear()\r\n                });\r\n            }\r\n            return gl.$OES_texture_float_linear$;\r\n        }\r\n\r\n        // 这将替换实际的getExtension()\r\n        function getExtension(name) {\r\n            return name === 'OES_texture_float_linear' ? getOESTextureFloatLinear(this) : oldGetExtension.call(this, name);\r\n        }\r\n\r\n        // 这将替换实际的 getSupportedExtensions()\r\n        function getSupportedExtensions() {\r\n            var extensions = oldGetSupportedExtensions.call(this);\r\n            if (extensions.indexOf('OES_texture_float_linear') === -1) {\r\n                extensions.push('OES_texture_float_linear');\r\n            }\r\n            return extensions;\r\n        }\r\n\r\n        // 获取WebGL上下文\r\n        try {\r\n            var gl = document.createElement('canvas').getContext('experimental-webgl');\r\n        } catch (e) {}\r\n\r\n        // 如果浏览器已经支持或没有WebGL，请不要安装polyfill\r\n        if (!gl || gl.getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\r\n            return;\r\n        }\r\n\r\n        // 如果线性滤镜适用于浮点textures，请安装polyfill \r\n        if (supportsOESTextureFloatLinear(gl)) {\r\n            var oldGetExtension = WebGLRenderingContext.prototype.getExtension;\r\n            var oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\r\n            WebGLRenderingContext.prototype.getExtension = getExtension;\r\n            WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\r\n        }\r\n    }());\r\n\r\n    exports.canvas = function() {\r\n        var canvas = document.createElement('canvas');\r\n        try {\r\n            gl = canvas.getContext('experimental-webgl', { premultipliedAlpha: false,preserveDrawingBuffer:true});\r\n        } catch (e) {\r\n            gl = null;\r\n        }\r\n        if (!gl) {\r\n            throw 'This browser does not support WebGL';\r\n        }\r\n        canvas._ = {\r\n            gl: gl,\r\n            isInitialized: false,\r\n            texture: null,\r\n            spareTexture: null,\r\n            flippedShader: null\r\n        };\r\n\r\n        // 核心方法\r\n        canvas.texture = wrap(texture);\r\n        canvas.draw = wrap(draw);\r\n        canvas.update = wrap(update);\r\n        canvas.replace = wrap(replace);\r\n        canvas.contents = wrap(contents);\r\n        canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n        // 滤镜方法\r\n        canvas.brightnesscontrastSaturationBur = wrap(brightnesscontrastSaturationBur);\r\n        canvas.hueColor = wrap(hueColor);\r\n\r\n        return canvas;\r\n    };\r\n    // exports.splineInterpolate = splineInterpolate;\r\n\r\n    var Shader = (function() {\r\n        function isArray(obj) {\r\n            return Object.prototype.toString.call(obj) == '[object Array]';\r\n        }\r\n\r\n        function isNumber(obj) {\r\n            return Object.prototype.toString.call(obj) == '[object Number]';\r\n        }\r\n\r\n        function compileSource(type, source) {\r\n            var shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source);\r\n            gl.compileShader(shader);\r\n            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n                throw 'compile error: ' + gl.getShaderInfoLog(shader);\r\n            }\r\n            return shader;\r\n        }\r\n\r\n        var defaultVertexSource = '\\\r\n\t    attribute vec2 vertex;\\\r\n\t    attribute vec2 _texCoord;\\\r\n\t    varying vec2 texCoord;\\\r\n\t    void main() {\\\r\n\t        texCoord = _texCoord;\\\r\n\t        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n\t    }';\r\n\r\n        var defaultFragmentSource = '\\\r\n\t    uniform sampler2D texture;\\\r\n\t    varying vec2 texCoord;\\\r\n\t    void main() {\\\r\n\t        gl_FragColor = texture2D(texture, texCoord);\\\r\n\t    }';\r\n\r\n        function Shader(vertexSource, fragmentSource) {\r\n            this.vertexAttribute = null;\r\n            this.texCoordAttribute = null;\r\n            this.program = gl.createProgram();\r\n            vertexSource = vertexSource || defaultVertexSource;\r\n            fragmentSource = fragmentSource || defaultFragmentSource;\r\n            fragmentSource = 'precision highp float;' + fragmentSource; // annoying requirement is annoying\r\n            gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource));\r\n            gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource));\r\n            gl.linkProgram(this.program);\r\n            if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n                throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n            }\r\n        }\r\n\r\n        Shader.prototype.destroy = function() {\r\n            gl.deleteProgram(this.program);\r\n            this.program = null;\r\n        };\r\n\r\n        Shader.prototype.uniforms = function(uniforms) {\r\n            gl.useProgram(this.program);\r\n            for (var name in uniforms) {\r\n                if (!uniforms.hasOwnProperty(name)) continue;\r\n                var location = gl.getUniformLocation(this.program, name);\r\n                if (location === null) continue; // will be null if the uniform isn't used in the shader\r\n                var value = uniforms[name];\r\n                if (isArray(value)) {\r\n                    switch (value.length) {\r\n                        case 1:\r\n                            gl.uniform1fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 2:\r\n                            gl.uniform2fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 3:\r\n                            gl.uniform3fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 4:\r\n                            gl.uniform4fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 9:\r\n                            gl.uniformMatrix3fv(location, false, new Float32Array(value));\r\n                            break;\r\n                        case 16:\r\n                            gl.uniformMatrix4fv(location, false, new Float32Array(value));\r\n                            break;\r\n                        default:\r\n                            throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                    }\r\n                } else if (isNumber(value)) {\r\n                    gl.uniform1f(location, value);\r\n                } else {\r\n                    throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n                }\r\n            }\r\n            // 允许链式操作\r\n            return this;\r\n        };\r\n\r\n        // textures 也是均匀的，但由于某些原因不能由gl.uniform1f指定，即使浮点数表示整数0到7\r\n        Shader.prototype.textures = function(textures) {\r\n            gl.useProgram(this.program);\r\n            for (var name in textures) {\r\n                if (!textures.hasOwnProperty(name)) continue;\r\n                gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\r\n            }\r\n            // 允许链式操作\r\n            return this;\r\n        };\r\n\r\n        Shader.prototype.drawRect = function(left, top, right, bottom) {\r\n            var undefined;\r\n            var viewport = gl.getParameter(gl.VIEWPORT);\r\n            top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n            left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n            right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n            bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n            if (gl.vertexBuffer == null) {\r\n                gl.vertexBuffer = gl.createBuffer();\r\n            }\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\r\n            if (gl.texCoordBuffer == null) {\r\n                gl.texCoordBuffer = gl.createBuffer();\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\r\n            }\r\n            if (this.vertexAttribute == null) {\r\n                this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n                gl.enableVertexAttribArray(this.vertexAttribute);\r\n            }\r\n            if (this.texCoordAttribute == null) {\r\n                this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n                gl.enableVertexAttribArray(this.texCoordAttribute);\r\n            }\r\n            gl.useProgram(this.program);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n            gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        };\r\n\r\n        Shader.getDefaultShader = function() {\r\n            gl.defaultShader = gl.defaultShader || new Shader();\r\n            return gl.defaultShader;\r\n        };\r\n\r\n        return Shader;\r\n    })();\r\n\r\n    function SplineInterpolator(points) {\r\n        var n = points.length;\r\n        this.xa = [];\r\n        this.ya = [];\r\n        this.u = [];\r\n        this.y2 = [];\r\n\r\n        points.sort(function(a, b) {\r\n            return a[0] - b[0];\r\n        });\r\n        for (var i = 0; i < n; i++) {\r\n            this.xa.push(points[i][0]);\r\n            this.ya.push(points[i][1]);\r\n        }\r\n\r\n        this.u[0] = 0;\r\n        this.y2[0] = 0;\r\n\r\n        for (var i = 1; i < n - 1; ++i) {\r\n            //这是三角算法的分解循环。\r\n            // y2和u用于分解因子的临时存储。\r\n            var wx = this.xa[i + 1] - this.xa[i - 1];\r\n            var sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n            var p = sig * this.y2[i - 1] + 2.0;\r\n\r\n            this.y2[i] = (sig - 1.0) / p;\r\n\r\n            var ddydx =\r\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n        }\r\n\r\n        this.y2[n - 1] = 0;\r\n\r\n        // 这是三对角算法的背取代循环\r\n        for (var i = n - 2; i >= 0; --i) {\r\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n        }\r\n    }\r\n    SplineInterpolator.prototype.interpolate = function(x) {\r\n        var n = this.ya.length;\r\n        var klo = 0;\r\n        var khi = n - 1;\r\n\r\n        // We will find the right place in the table by means of\r\n        // bisection. This is optimal if sequential calls to this\r\n        // routine are at random values of x. If sequential calls\r\n        // are in order, and closely spaced, one would do better\r\n        // to store previous values of klo and khi.\r\n        // 我们将通过二分法在表中找到正确的地方。 如果对此例程的顺序调用是随机值x，这是最佳的。 如果顺序调用是有序的，并且紧密间隔，则可以更好地存储klo和khi的先前值。\r\n        while (khi - klo > 1) {\r\n            var k = (khi + klo) >> 1;\r\n\r\n            if (this.xa[k] > x) {\r\n                khi = k;\r\n            } else {\r\n                klo = k;\r\n            }\r\n        }\r\n\r\n        var h = this.xa[khi] - this.xa[klo];\r\n        var a = (this.xa[khi] - x) / h;\r\n        var b = (x - this.xa[klo]) / h;\r\n\r\n        // 现在评估立方样条多项式Cubic spline polynomial is now evaluated.\r\n        return a * this.ya[klo] + b * this.ya[khi] +\r\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n    };\r\n\r\n    var Texture = (function() {\r\n        Texture.fromElement = function(element) {\r\n            var texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n            texture.loadContentsOf(element);\r\n            return texture;\r\n        };\r\n\r\n        function Texture(width, height, format, type) {\r\n            this.gl = gl;\r\n            this.id = gl.createTexture();\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n\r\n        Texture.prototype.loadContentsOf = function(element) {\r\n            this.width = element.width || element.videoWidth;\r\n            this.height = element.height || element.videoHeight;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n        };\r\n\r\n        Texture.prototype.initFromBytes = function(width, height, data) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = gl.RGBA;\r\n            this.type = gl.UNSIGNED_BYTE;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n        };\r\n\r\n        Texture.prototype.destroy = function() {\r\n            gl.deleteTexture(this.id);\r\n            this.id = null;\r\n        };\r\n\r\n        Texture.prototype.use = function(unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        };\r\n\r\n        Texture.prototype.unuse = function(unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n            gl.bindTexture(gl.TEXTURE_2D, null);\r\n        };\r\n\r\n        Texture.prototype.ensureFormat = function(width, height, format, type) {\r\n            // 允许传递现有的texture而不是单个参数\r\n            if (arguments.length == 1) {\r\n                var texture = arguments[0];\r\n                width = texture.width;\r\n                height = texture.height;\r\n                format = texture.format;\r\n                type = texture.type;\r\n            }\r\n\r\n            // 仅在需要时更改格式\r\n            if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n                this.width = width;\r\n                this.height = height;\r\n                this.format = format;\r\n                this.type = type;\r\n                gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n            }\r\n        };\r\n\r\n        Texture.prototype.drawTo = function(callback) {\r\n            // 开始渲染 texture\r\n            gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n            if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n                throw new Error('incomplete framebuffer');\r\n            }\r\n            gl.viewport(0, 0, this.width, this.height);\r\n\r\n            // do the drawing\r\n            callback();\r\n\r\n            // 停止渲染 texture\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        };\r\n\r\n        var canvas = null;\r\n\r\n        function getCanvas(texture) {\r\n            if (canvas == null) {\r\n                canvas = document.createElement('canvas');\r\n            }\r\n            canvas.width = texture.width;\r\n            canvas.height = texture.height;\r\n            var c = canvas.getContext('2d');\r\n            c.clearRect(0, 0, canvas.width, canvas.height);\r\n            return c;\r\n        }\r\n\r\n        Texture.prototype.fillUsingCanvas = function(callback) {\r\n            callback(getCanvas(this));\r\n            this.format = gl.RGBA;\r\n            this.type = gl.UNSIGNED_BYTE;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\r\n            return this;\r\n        };\r\n\r\n        Texture.prototype.toImage = function(image) {\r\n            this.use();\r\n            Shader.getDefaultShader().drawRect();\r\n            var size = this.width * this.height * 4;\r\n            var pixels = new Uint8Array(size);\r\n            var c = getCanvas(this);\r\n            var data = c.createImageData(this.width, this.height);\r\n            gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n            for (var i = 0; i < size; i++) {\r\n                data.data[i] = pixels[i];\r\n            }\r\n            c.putImageData(data, 0, 0);\r\n            image.src = canvas.toDataURL();\r\n        };\r\n\r\n        Texture.prototype.swapWith = function(other) {\r\n            var temp;\r\n            temp = other.id;\r\n            other.id = this.id;\r\n            this.id = temp;\r\n            temp = other.width;\r\n            other.width = this.width;\r\n            this.width = temp;\r\n            temp = other.height;\r\n            other.height = this.height;\r\n            this.height = temp;\r\n            temp = other.format;\r\n            other.format = this.format;\r\n            this.format = temp;\r\n        };\r\n\r\n        return Texture;\r\n    })();\r\n\r\n    // 返回一个 0 到 1的随机数\r\n    var randomShaderFunc = '\\\r\n\t    float random(vec3 scale, float seed) {\\\r\n\t        /* use the fragment position for a different seed per-pixel */\\\r\n\t        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n\t    }\\\r\n\t';\r\n\r\n    return exports;\r\n\r\n}();\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/glfx.js","export const Query = {\r\n    parse ( search = window.location.search ) {\r\n        if (!search) return {};\r\n\r\n        const queryString = search[0] === '?' ? search.substring(1) : search;\r\n        const query = {};\r\n\r\n        queryString.split('&')\r\n            .forEach(queryStr => {\r\n                const [key, value] = queryStr.split('=');\r\n                if (key) query[key] = value;\r\n            });\r\n\r\n        return query;\r\n    },\r\n    stringify ( query, prefix = '?' ) {\r\n        const queryString = Object.keys(query)\r\n            .map(key => `${key}=${encodeURIComponent(query[key] || '')}`)\r\n            .join('&');\r\n\r\n        return queryString ? prefix + queryString : ''\r\n    }\r\n}\r\n\r\nexport const http = {\r\n    get: ajaxFactory('GET'),\r\n    post: ajaxFactory('POST')\r\n}\r\n\r\n/**\r\n * [turnOver   图片翻转]\r\n * @param  {[type]} oGC  [画布2d context]\r\n * @param  {[type]} obj [翻转的img对象]\r\n * @param  {[type]} iNow [翻转标志，4水平翻转，5垂直翻转]\r\n * @return {[type]} [description]\r\n */\r\nexport function turnOver ( oC ) {\r\n    let oGC = oC.getContext('2d'),\r\n        oImg = oGC.getImageData(0, 0, oC.width, oC.height),\r\n        newImg = oGC.createImageData(oC.width, oC.height);\r\n\r\n    let w = oImg.width,\r\n        h = oImg.height;\r\n\r\n    for (let i = 0; i < w; i++) {\r\n\r\n        for (let j = 0; j < h; j++) {\r\n            let color = getXY(oImg, i, j);\r\n\r\n            setXY(newImg, w - 1 - i, j, color);\r\n        }\r\n    }\r\n\r\n    oGC.putImageData(newImg, 0, 0);\r\n}\r\n\r\nexport function runFunction (fn, thisObj, args) {\r\n    if (fn && typeof fn === \"function\") {\r\n        var argus = arguments,\r\n            argsl = argus.length;\r\n\r\n        //如果函数的参数列表存在1个参数\r\n        if (argsl == 1) {\r\n            return fn.apply(window);\r\n        }\r\n\r\n        //如果函数的参数列表存在2个参数\r\n        if (argsl == 2) {\r\n            if (Array.isArray(thisObj)) {\r\n                return fn.apply(window, thisObj);\r\n            } else {\r\n                return fn.apply(thisObj);\r\n            }\r\n        }\r\n\r\n        //如果函数的参数列表存在3个参数\r\n        if (argsl == 3) {\r\n            return fn.apply(thisObj || window, args);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * 将以base64的图片url数据转换为Blob\r\n * @param  {String} urlData  用url方式表示的base64图片数据\r\n * @return {Object} 图片的Blob对象\r\n */\r\nexport function convertDataurlToBlob ( urlData, type ) {\r\n\r\n    //去掉url的头，并转换为byte\r\n    var bytes = window.atob(urlData.split(',')[1]);\r\n\r\n    //处理异常,将ascii码小于0的转换为大于0\r\n    var ab = new ArrayBuffer(bytes.length);\r\n    var ia = new Uint8Array(ab);\r\n    for (var i = 0; i < bytes.length; i++) {\r\n        ia[i] = bytes.charCodeAt(i);\r\n    }\r\n\r\n    return new Blob([ab], {\r\n        type: type\r\n    });\r\n}\r\n\r\nfunction ajaxFactory ( method ) {\r\n    return function ( options ) {\r\n        const req = new XMLHttpRequest();\r\n\r\n        let url = options.url,\r\n            data = options.data,\r\n            body = null;\r\n\r\n        if (method === 'GET' && data) {\r\n            url += Query.stringify(data, url.indexOf('?') == -1 ? '?' : '&');\r\n        }\r\n\r\n        const p = new Promise((resolve, reject) => {\r\n            req.addEventListener('load', () => {\r\n                const contentType = req.getResponseHeader('content-type');\r\n                const res = req.responseType != 'text' && req.responseType != '' ? req.response : req.responseText;\r\n\r\n                resolve(res);\r\n            });\r\n\r\n            req.addEventListener('error', error => reject(error));\r\n        });\r\n\r\n        req.open(method, url, true);\r\n\r\n        if (method !== 'GET') {\r\n            if ( data && data.append ) {\r\n                body = data;\r\n            } else {\r\n                body = JSON.stringify(data);\r\n                req.setRequestHeader('Content-Type', 'application/json');\r\n            }\r\n        }\r\n\r\n        if (options.type) req.responseType = options.type;\r\n\r\n        req.send(body);\r\n        return p;\r\n    }\r\n}\r\n\r\n/**\r\n * [getXY   获取图像点的颜色值]\r\n * @param  {[type]} obj  [图形对象]\r\n * @param  {[type]} x [x坐标]\r\n * @param  {[type]} y [y坐标]\r\n * @param  {[type]} color [颜色数组分别代表rgba]\r\n * @return {[type]} color [颜色数组分别代表rgba]\r\n */\r\nfunction getXY(obj, x, y) { //针对一行一列进行操作\r\n\r\n    let w = obj.width,\r\n        h = obj.height,\r\n        d = obj.data;\r\n\r\n    let color = [];\r\n\r\n    color[0] = d[4 * (y * w + x)];\r\n    color[1] = d[4 * (y * w + x) + 1];\r\n    color[2] = d[4 * (y * w + x) + 2];\r\n    color[3] = d[4 * (y * w + x) + 3];\r\n\r\n    return color;\r\n\r\n}\r\n\r\n/**\r\n * [setXY   设置图像点的颜色值]\r\n * @param  {[type]} obj  [图形对象]\r\n * @param  {[type]} x [x坐标]\r\n * @param  {[type]} y [y坐标]\r\n * @param  {[type]} color [颜色数组分别代表rgba]\r\n * @return {[type]}          [description]\r\n */\r\nfunction setXY(obj, x, y, color) {\r\n    let w = obj.width,\r\n        h = obj.height,\r\n        d = obj.data;\r\n\r\n    d[4 * (y * w + x)] = color[0];\r\n    d[4 * (y * w + x) + 1] = color[1];\r\n    d[4 * (y * w + x) + 2] = color[2];\r\n    d[4 * (y * w + x) + 3] = color[3];\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js"],"sourceRoot":""}